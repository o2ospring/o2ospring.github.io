<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>lua 脚本基本语法 - o2ospring</title><meta name="Description" content="lua 的学习笔记，主要介绍 lua 的基本语法"><meta property="og:title" content="lua 脚本基本语法" />
<meta property="og:description" content="lua 的学习笔记，主要介绍 lua 的基本语法" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://o2ospring.github.io/20211221/" /><meta property="og:image" content="https://o2ospring.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-21T21:33:41+08:00" />
<meta property="article:modified_time" content="2022-04-27T22:58:00+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://o2ospring.github.io/logo.png"/>

<meta name="twitter:title" content="lua 脚本基本语法"/>
<meta name="twitter:description" content="lua 的学习笔记，主要介绍 lua 的基本语法"/>
<meta name="application-name" content="o2ospring">
<meta name="apple-mobile-web-app-title" content="o2ospring"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://o2ospring.github.io/20211221/" /><link rel="prev" href="https://o2ospring.github.io/20210627/" /><link rel="next" href="https://o2ospring.github.io/20220123/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "lua 脚本基本语法",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/o2ospring.github.io\/20211221\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/o2ospring.github.io\/images\/Apple-Devices-Preview.png",
                            "width":  3200 ,
                            "height":  2048 
                        }],"genre": "posts","keywords": "lua, linux 工具\/应用","wordcount":  34389 ,
        "url": "https:\/\/o2ospring.github.io\/20211221\/","datePublished": "2021-12-21T21:33:41+08:00","dateModified": "2022-04-27T22:58:00+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/o2ospring.github.io\/images\/avatar.png",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "o2ospring"
            },"description": "lua 的学习笔记，主要介绍 lua 的基本语法"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="o2ospring"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>o2ospring&#39;s blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="https://github.com/o2ospring" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="o2ospring"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>o2ospring&#39;s blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="https://github.com/o2ospring" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">lua 脚本基本语法</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/o2ospring" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>o2ospring</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/software/"><i class="far fa-folder fa-fw"></i>software</a>&nbsp;<a href="/categories/linux/"><i class="far fa-folder fa-fw"></i>linux</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-12-21">2021-12-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 34389 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 69 分钟&nbsp;<span id="/20211221/" class="leancloud_visitors" data-flag-title="lua 脚本基本语法">
                        <i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#前言">前言</a></li>
        <li><a href="#lua-简介">Lua 简介</a></li>
        <li><a href="#lua-安装">Lua 安装</a></li>
        <li><a href="#lua-语法">Lua 语法</a></li>
        <li><a href="#lua-数据库">Lua 数据库</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h3 id="前言">前言</h3>
<blockquote>
<p>Lua <code>/'luːə/</code> 是一个小巧且速度极快的脚本语言，由标准 C 编写而成，几乎在所有操作系统和平台上都可以编译运行，是作为嵌入式脚本的最佳选择。本人常用它来对文本内容进行批处理。</p>
</blockquote>
<h3 id="lua-简介">Lua 简介</h3>
<details close=""><summary>1、lua 概述、官网、资料</summary>  
<blockquote>
<p>Lua 是一个小巧的脚本语言，标准 C 编写而成，它可以被 C/C++ 代码调用，也可以反过来调用 C/C++ 的函数，几乎在所有操作系统和平台上都可以编译、运行。Lua 并没有提供强大的库，一个完整的 Lua 解释器不过 200KB，但它在所有脚本引擎中速度是最快的，是作为嵌入式脚本的最佳选择。Lua 是巴西里约热内卢天主教大学（Pontifical Catholic University of Rio de Janeiro）里的一个由 Roberto Ierusalimschy、Waldemar Celes 和 Luiz Henrique de Figueiredo 三人所组成的研究小组于 1993 年开发的。<br>
安装 lua 后，其包括三部分：</p>
<ul>
<li><strong>lua（解释器）：</strong><br>
用于运行 lua 脚本文件。例如：<code>lua test.lua</code>命令是运行 test.lua 脚本文件。</li>
<li><strong>luac（编译器）：</strong><br>
用于加密 lua 脚本文件（但可逆向解密，参考<a href="https://blog.csdn.net/liujiayu2/article/details/81940701" target="_blank" rel="noopener noreffer">网文</a>）。例如：<code>lua -o t.lua test.lua</code>命令对 test.lua 脚本文件加密并生成 t.lua 加密文件，使用同样方式运行脚本加密文件即可：<code>lua t.lua</code>。</li>
<li><strong>liblua.a（静态库）：</strong><br>
用于集成到其它程序中，例如编译一个 C 程序，调用 lua 操作 API 运行 lua 脚本。如果需要动态库，则需要修改 Makefile 文件并重新编译，具体请参考<a href="https://www.jianshu.com/p/91fac87bd6d3" target="_blank" rel="noopener noreffer">网文</a>。</li>
</ul>
<p>资料：<a href="http://www.lua.org" target="_blank" rel="noopener noreffer">官网</a>、<a href="https://blog.csdn.net/qq_40506747/article/details/120388764" target="_blank" rel="noopener noreffer">网文教程</a>、<a href="https://www.runoob.com/lua/lua-tutorial.html" target="_blank" rel="noopener noreffer">菜鸟教程</a>、<a href="https://www.runoob.com/manual/lua53doc/contents.html#index" target="_blank" rel="noopener noreffer">Lua 5.3  API 参考手册</a>、<a href="https://www.bookstack.cn/read/lua-5.3/README.md" target="_blank" rel="noopener noreffer">Lua 5.3 参考手册<br>
</a>、<a href="https://www.jianshu.com/u/8fad76e7e05c" target="_blank" rel="noopener noreffer">Lua API</a>、<a href="http://codingnow.com/" target="_blank" rel="noopener noreffer">中国顶级程序员-网游大咖-云风(吴云洋)-博客</a> + <a href="https://github.com/cloudwu" target="_blank" rel="noopener noreffer">他的git仓库</a> + <a href="https://blog.codingnow.com/cloud/HomePage" target="_blank" rel="noopener noreffer">Lua 编程技巧</a></p>
</blockquote>
</details>  
<h3 id="lua-安装">Lua 安装</h3>
<details close=""><summary>1、lua 解释器下载与安装</summary>  
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">wget http://www.lua.org/ftp/lua-5.4.3.tar.gz  <span class="c1">#下载</span>
tar zxf lua-5.4.3.tar.gz                      <span class="c1">#解压</span>
<span class="nb">cd</span> lua-5.4.3                                  <span class="c1">#进入文件夹</span>
make all <span class="nb">test</span>                                 <span class="c1">#编译</span>
sudo make install                             <span class="c1">#安装（安装到 /usr/local/bin/：lua(解释器)、luac(编译器)，及 /usr/local/lib/：liblua.a(静态库)）</span>
lua -v                                        <span class="c1">#查看版本（用于验证是否安装成功）</span>
</code></pre></td></tr></table>
</div>
</div></details>  
<details close=""><summary>2、lua 脚本的编写与运行</summary>  
<blockquote>
<p>● <strong>方法一</strong>：（1）编写脚本文件（但不指出 lua 脚本解析器），（2）在命令窗口运行脚本。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">--（1）--</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;Hello World!&#34;</span><span class="p">)</span>     <span class="c1">--创建 HelloWorld.lua 脚本文件，在其增加此行脚本内容</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">##（2）##</span>
chmod <span class="m">777</span> HelloWorld.lua  <span class="c1">#修改 HelloWorld.lua 文件权限，使其权限为可执行文件</span>
lua ./HelloWorld.lua      <span class="c1">#在命令窗口运行脚本文件，结果为打印出：Hello World!</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>● <strong>方法二</strong>：（1）编写脚本文件（首行指出 lua 脚本解析器），（2）在命令窗口运行脚本。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="cp">#!/usr/local/bin/lua</span>
<span class="c1">---(1)---                 --上行表示指定 lua 脚本解析器执行。★★注意：上行必须使用 \n 来换行，不能是 \r\n 之类的来换行! 否则会提示 ^M 错误★★</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;Hello World!&#34;</span><span class="p">)</span>     <span class="c1">--创建 HelloWorld.lua 脚本文件，在其增加这里三行脚本内容</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">###(2)###</span>
chmod <span class="m">777</span> HelloWorld.lua  <span class="c1">#修改 HelloWorld.lua 文件权限，使其权限为可执行文件</span>
./HelloWorld.lua          <span class="c1">#在命令窗口运行脚本文件，结果为打印出：Hello World!</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>● <strong>说明三</strong>：lua 脚本解析器支持交互式编程</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">lua                       <span class="c1">#在命令窗口运行lua脚本解析器进入交互式编程，</span>
&gt;                         <span class="c1">#进入了交互式编程，这里可以即时编写一行脚本并按回车执行：</span>
&gt; print<span class="o">(</span><span class="s2">&#34;Hello World！&#34;</span><span class="o">)</span>  <span class="c1">#编写一行脚本内容，按回车后，</span>
Hello World！             <span class="c1">#执行脚本（本例为打印信息）。</span>
&gt; 
</code></pre></td></tr></table>
</div>
</div></details>  
<details close=""><summary>3、lua 在 Windows 上安装</summary>  
<blockquote>
<p>● <strong>方法一</strong>：安装现成集成环境（不过 lua 的版本则比较旧）</p>
</blockquote>
<ol>
<li>安装 SciTE 的 IDE 集成环境：<a href="https://github.com/rjpcomputing/luaforwindows/releases" target="_blank" rel="noopener noreffer">网址</a></li>
<li>安装 LuaDist 的集成库（已不维护）：<a href="http://luadist.org/" target="_blank" rel="noopener noreffer">网址</a></li>
<li>安装 LuaRocks 的集成库：<a href="https://luarocks.org/" target="_blank" rel="noopener noreffer">网址</a></li>
</ol>
<ul>
<li><strong>例如</strong>：安装 SciTE 的 IDE 集成环境后，直接在命令窗口运行 lua 脚本文件即可：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">lua.exe .<span class="se">\H</span>elloWorld.lua  <span class="c1">#直接在命令窗口运行lua脚本文件</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>● <strong>方法二</strong>：自己编译自己安装（可以使用 lua 的最新版本）</p>
</blockquote>
<ol>
<li>下载 <a href="https://jmeubank.github.io/tdm-gcc/download" target="_blank" rel="noopener noreffer">TDM-GCC 编译工具</a>，不需要勾选检测是否最新版本，直接点击<code>Creat</code>安装即可（<a href="../img/20200915_10.jpg" rel="">图示</a>），最后在命令窗口输入<code>gcc -v</code>可查看 gcc 版本。</li>
<li>下载 <a href="http://www.lua.org/download.html" target="_blank" rel="noopener noreffer">lua 源代码</a>，解压文件并编译。【<a href="https://joedf.ahkscript.org/LuaBuilds/" target="_blank" rel="noopener noreffer">网上也有已编译好的 lua</a>】</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">gcc -v                  <span class="c1">#查看gcc版本（用于验证TDM-GCC是否安装成功）</span>
<span class="nb">cd</span> lua-5.4.4            <span class="c1">#进入lua文件夹（刚才文件解压的根文件夹）</span>
mingw32-make mingw      <span class="c1">#编译lua源代码（在src\里生成：lua.exe(解释器)、luac.exe(编译器)，liblua.a(静态库)）</span>
<span class="nb">cd</span> src                  <span class="c1">#进入src\目录</span>
lua.exe -v              <span class="c1">#查看lua版本（用于验证lua是否编译成功）</span>
</code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>将 lua 加入环境变量（<a href="../img/20211221_01_03_03.jpg" rel="">图示</a>），但建议直接把<code>lua.exe、luac.exe、liblua.a、lua54.dll</code>剪切到<code>C:\Windows</code>目录下。</li>
</ol>
<p><strong>备注：</strong></p>
<ul>
<li>关于 <a href="http://tdm-gcc.tdragon.net" target="_blank" rel="noopener noreffer">TDM-GCC</a>：是为 windows 系统打造的编译器套件，其衍生自 MinGW 和 <a href="https://sourceforge.net/projects/mingw-w64/files/" target="_blank" rel="noopener noreffer">MinGW-w64</a> 的项目，分为 32 位与 64 位两个版本，32 位版本的编译目标仅兼容 32 位应用程序，64 位版本的编译目标兼容 32 位应用程序与 64 位应用程序，最新的官方二进制版本为 GCC 10.3.0。更多的编译构建工具知识，请移步《<a href="../20200915" rel="">linux-编译-linux 编译构建工具</a>》。</li>
<li>参考：<a href="https://blog.csdn.net/qq_37326058/article/details/85721176#t0" target="_blank" rel="noopener noreffer">TDM-GCC 安装 lua</a>、<a href="https://blog.csdn.net/weixin_39407199/article/details/106098857" target="_blank" rel="noopener noreffer">MinGW 编译 lua</a>、<a href="https://blog.csdn.net/lemon4869/article/details/107403560" target="_blank" rel="noopener noreffer">MinGW 安装文件区别</a></li>
</ul>
</details>  
<h3 id="lua-语法">Lua 语法</h3>
<details close=""><summary>1、lua 概述</summary>  
<blockquote>
<p>lua 由标准 C 编写而成，可以被 C/C++ 代码调用，也可以反过来调用 C/C++ 的函数，基于此我们可以很容易想像出它的语法一定会与 C 语言很相似。其中独立语句可以使用<code>;</code>分号分隔，也可以不用。还有特别说明一下，Lua 的所有变量其实都是字符，例如直接打印一个函数返回值<code>return 100</code>，虽然它是<code>number</code>数据类型，但打印结果还是字符串：100。</p>
</blockquote>
</details>  
<details close=""><summary>2、lua 关键字</summary>  
<blockquote>
<p><strong>一、lua 的关键字：</strong></p>
</blockquote>
<p><strong>说明一</strong>、lua 关键字主要包括：<code>声明、函数、跳转、返回、结束、判断、循环、真假、与或非</code>等语句关键字。下面列出 22 个关键字：</p>
<table>
<thead>
<tr>
<th style="text-align:left">关键字</th>
<th style="text-align:left">关键字</th>
<th style="text-align:left">关键字</th>
<th style="text-align:left">关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">local</td>
<td style="text-align:left">if</td>
<td style="text-align:left">then</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td style="text-align:left">function</td>
<td style="text-align:left">elseif</td>
<td style="text-align:left"></td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">goto</td>
<td style="text-align:left">else</td>
<td style="text-align:left"></td>
<td style="text-align:left">nil</td>
</tr>
<tr>
<td style="text-align:left">break</td>
<td style="text-align:left">for</td>
<td style="text-align:left">in</td>
<td style="text-align:left">or</td>
</tr>
<tr>
<td style="text-align:left">return</td>
<td style="text-align:left">while</td>
<td style="text-align:left">do</td>
<td style="text-align:left">and</td>
</tr>
<tr>
<td style="text-align:left">end</td>
<td style="text-align:left">repeat</td>
<td style="text-align:left">until</td>
<td style="text-align:left">not</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>二、Lua 的数据类型：</strong></p>
</blockquote>
<p><strong>说明二</strong>、Lua 数据类型主要包括：<code>空值、布尔值、数值、字符串、数据、线程、表</code>这些数据类型，它们通过<code>type()</code>函数返回值获得（返回为字符串，由字符串单词指出数据类型）。下面列出 8 个数据类型：</p>
<table>
<thead>
<tr>
<th style="text-align:left"><div style="width:80px">关键字</div></th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&ldquo;nil&rdquo;</td>
<td style="text-align:left">空值（在条件表达式中相当于 false）</td>
</tr>
<tr>
<td style="text-align:left">&ldquo;boolean&rdquo;</td>
<td style="text-align:left">布尔值，包含两个值：true 和 false</td>
</tr>
<tr>
<td style="text-align:left">&ldquo;number&rdquo;</td>
<td style="text-align:left">表示双精度类型的实浮点数</td>
</tr>
<tr>
<td style="text-align:left">&ldquo;string&rdquo;</td>
<td style="text-align:left">字符串由一对双引号或单引号来表示</td>
</tr>
<tr>
<td style="text-align:left">&ldquo;function&rdquo;</td>
<td style="text-align:left">由 C 或 Lua 编写的函数</td>
</tr>
<tr>
<td style="text-align:left">&ldquo;userdata&rdquo;</td>
<td style="text-align:left">表示任意存储在变量中的 C 数据结构</td>
</tr>
<tr>
<td style="text-align:left">&ldquo;thread&rdquo;</td>
<td style="text-align:left">表示执行的独立线路，用于执行协同程序</td>
</tr>
<tr>
<td style="text-align:left">&ldquo;table&rdquo;</td>
<td style="text-align:left">Lua 中的表其实是一个&quot;关联数组&quot;（associative arrays），数组的索引可以是数字、字符串或表类型。在 Lua 里，table 的创建是通过“构造表达式”来完成，最简单构造表达式是<code>{}</code>，用来创建一个空表</td>
</tr>
<tr>
<td style="text-align:left">补充说明</td>
<td style="text-align:left"><code>type()</code>返回都是字符串！</td>
</tr>
</tbody>
</table>
<hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">--类型打印实例--</span>
<span class="n">tb</span> <span class="o">=</span> <span class="p">{}</span>  <span class="n">aaa</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="n">print</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="n">tb</span><span class="p">))</span>                 <span class="c1">--&gt; table</span>
<span class="n">print</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="s2">&#34;Hello world&#34;</span><span class="p">))</span>      <span class="c1">--&gt; string</span>
<span class="n">print</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="mf">10.4</span><span class="o">*</span><span class="mi">3</span><span class="p">))</span>             <span class="c1">--&gt; number</span>
<span class="n">print</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="n">print</span><span class="p">))</span>              <span class="c1">--&gt; function</span>
<span class="n">print</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="n">type</span><span class="p">))</span>               <span class="c1">--&gt; function</span>
<span class="n">print</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span>               <span class="c1">--&gt; boolean</span>
<span class="n">print</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="kc">nil</span><span class="p">))</span>                <span class="c1">--&gt; nil</span>
<span class="n">print</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="n">print</span><span class="p">)))</span>        <span class="c1">--&gt; string !!!</span>
<span class="kr">if</span> <span class="n">type</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;number&#34;</span> <span class="kr">then</span>   <span class="c1">--判断方法</span>
<span class="kr">end</span>
<span class="kr">if</span> <span class="n">type</span><span class="p">(</span><span class="n">aaa</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;nil&#34;</span> <span class="kr">then</span>      <span class="c1">--判断方法</span>
<span class="kr">end</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>三、Lua 的运算符：</strong></p>
</blockquote>
<p><strong>说明三</strong>、Lua 运算符主要包括：<code>算术、关系、逻辑、其它</code>这几类运算符。它们有不同的优先级（强烈建议使用<code>()</code>指定），下面列出 8 级优先级：</p>
<table>
<thead>
<tr>
<th style="text-align:center"><div style="width:48px">优先级</div></th>
<th style="text-align:left"><div style="width:176px">运算符</div></th>
<th style="text-align:left">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">最高</td>
<td style="text-align:left">^</td>
<td style="text-align:left">连续几个^则是优先从右到左组合 x^y^z == x^(y^z)</td>
</tr>
<tr>
<td style="text-align:center">↑</td>
<td style="text-align:left">not　-</td>
<td style="text-align:left">- 为负号</td>
</tr>
<tr>
<td style="text-align:center">│</td>
<td style="text-align:left">*　/　%</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:center">│</td>
<td style="text-align:left">+　-</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:center">│</td>
<td style="text-align:left">..</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:center">│</td>
<td style="text-align:left">&lt;　&gt;　&lt;=　&gt;=　~=　==</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:center">│</td>
<td style="text-align:left">and</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:center">最低</td>
<td style="text-align:left">or</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">--算术运算符--</span>
<span class="o">+</span>             <span class="c1">--加法</span>
<span class="o">-</span>             <span class="c1">--减法</span>
<span class="o">*</span>             <span class="c1">--乘法</span>
<span class="o">/</span>             <span class="c1">--除法</span>
<span class="o">%</span>             <span class="c1">--取余</span>
<span class="o">^</span>             <span class="c1">--乘幂（10^2为100）</span>
<span class="o">-</span>             <span class="c1">--负号（-10）</span>

<span class="c1">--关系运算符--</span>
<span class="o">==</span>            <span class="c1">--等于</span>
<span class="o">~=</span>            <span class="c1">--不等于</span>
<span class="o">&gt;</span>             <span class="c1">--大于</span>
<span class="o">&lt;</span>             <span class="c1">--小于</span>
<span class="o">&gt;=</span>            <span class="c1">--大于等于</span>
<span class="o">&lt;=</span>            <span class="c1">--小于等于</span>

<span class="c1">--逻辑运算符--  （用于条件判断中：if() elseif() while() until()）</span>
<span class="ow">and</span>           <span class="c1">--逻辑与操作符（如：(A and B)） </span>
<span class="ow">or</span>            <span class="c1">--逻辑或操作符（如：(A or  B)） </span>
<span class="ow">not</span>           <span class="c1">--逻辑非操作符（如：not(A and B)） </span>

<span class="c1">--其它运算符--</span>
<span class="o">#</span>             <span class="c1">--返回字符串或数组的长度（如：#&#34;Hello&#34; 返回字符个数 5）（如果存在`nil`的组员，则计算组员个数可能出错！！！）</span>
<span class="p">:</span>             <span class="c1">--表示表员/组员为函数且以隐式方式把表作为入口参数（如：file:read() 表示[表file]的表员是read()函数,并以隐式方式把[表file]作为入口参数,在函数内访问表员i写作 self.i ）</span>
<span class="p">.</span>             <span class="c1">--表示表员/组员 （如：tb.i 表示 表tb的表员i）</span>
<span class="o">..</span>            <span class="c1">--连接两个字符串（如：a=&#34;Hello &#34; b=&#34;World&#34; print(a..b)，结果为：Hello World）</span>
<span class="p">...</span>           <span class="c1">--可变符：select(&#34;#&#34;,...)则返回可变参数的个数</span>
              <span class="c1">--        select(  3,...)则返回从第3开始的所有参数</span>
              <span class="c1">--        (...)表示函数入口的变长参数</span>
              <span class="c1">--        {...}表示由当前函数变长参数构成的数组</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>四、Lua 的注释：</strong></p>
</blockquote>
<p><strong>说明四</strong>、Lua 注释主要包括：<code>行、块</code>两类注释。下面列出 2 种注释演示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">--这是一行注释</span>

<span class="cm">--[[
</span><span class="cm">多行注释
</span><span class="cm">多行注释
</span><span class="cm">--]]</span>
</code></pre></td></tr></table>
</div>
</div></details>  
<details close=""><summary>3、lua 变量</summary>  
<blockquote>
<p><strong>一、Lua 的变量：</strong></p>
</blockquote>
<p><strong>说明一</strong>、Lua 变量有三种类型：全局变量、局部变量（<code>local</code>声明）、表中的域，它们的默认值（没有初始化时）均为<code>nil</code>。下面是展示变量的声明和初始化：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="n">tb</span> <span class="o">=</span> <span class="p">{}</span>     <span class="c1">--这是一个没赋值的全局数组/表</span>
<span class="n">tb.i</span>        <span class="c1">--这是一个表的表员（《指定键名》为&#34;i&#34;的表员）</span>
<span class="n">tb</span><span class="p">[</span><span class="s2">&#34;i&#34;</span><span class="p">]</span>     <span class="c1">--这是一个表的表员（《指定键名》为&#34;i&#34;的表员）</span>
<span class="n">tb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>       <span class="c1">--这是一个数组组员（【没有键名】的第i个组员）</span>
<span class="n">v</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1">--这是一个初始值为1的全局变量</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span><span class="n">v</span>   <span class="c1">--这是多个变量给多个变量赋值，右边的变量值是本行命令之前的缓冲值(固定不会变)，不会受本行命令影响！</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span><span class="n">a</span>   <span class="c1">--同上，结果就是 a 与 b 数值交换</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>     <span class="c1">--等同 a,b = 1,nil</span>
<span class="n">a</span> <span class="o">=</span>         <span class="c1">--等同 a = nil</span>
<span class="n">b</span> <span class="o">=</span> <span class="kc">nil</span>     <span class="c1">--赋空值，相当于删除全局变量（释放内存）</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">f</span><span class="p">()</span>   <span class="c1">--函数多个返回值依次赋值a,b，如果只有一个返回值则 b=nil</span>
<span class="kd">local</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">--这是一个局部变量，局部变量的访问速度比全局变量更快</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>二、Lua 的表/数组：</strong></p>
</blockquote>
<p><strong>说明二</strong>、Lua 表/数组主要分为：一维数组、多维数组。表/数组的元素组成：键(名)=值。关于数组与表区别：数组其实就是一个有序的表。关于我对【表员】和〖组员〗的定义：有或无《键名》的元素都称为【表员】，没有《键名》的元素称为〖组员〗。不建议〖组员〗的数值设置为<code>nil</code>，否则会影响相关函数操作！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----【一维数组】-----</span>
<span class="n">array</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">=</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s2">&#34;b&#34;</span><span class="p">,</span><span class="n">c</span><span class="p">}</span>     <span class="c1">--数组 array, 共用一个组员（组员编号默认从1计起，默认为一维数组）</span>
<span class="n">print</span><span class="p">(</span><span class="n">array.c</span><span class="p">)</span>                  <span class="c1">--打印《指定键名》为 &#34;c&#34;的表员：nil（未赋值）</span>
<span class="n">print</span><span class="p">(</span><span class="n">array.a</span><span class="p">)</span>                  <span class="c1">--打印《指定键名》为 &#34;a&#34;的表员：a</span>
<span class="n">print</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="s2">&#34;b&#34;</span><span class="p">])</span>               <span class="c1">--打印《指定键名》为 &#34;b&#34;的表员：b</span>
<span class="n">print</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>                 <span class="c1">--打印【有序组员】的第一个组员：1</span>
<span class="n">print</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>                 <span class="c1">--打印不存在组员：nil（组员编号默认从1计起）</span>
<span class="n">print</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>                 <span class="c1">--打印不存在组员：nil（组员编号默认从1计起）</span>
<span class="n">print</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="s2">&#34;abc&#34;</span><span class="p">])</span>             <span class="c1">--打印不存在表员：nil</span>

<span class="n">array</span> <span class="o">=</span> <span class="p">{}</span>                      <span class="c1">--数组 array（空数组，需要初始组员编号及数值）</span>
<span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span> <span class="kr">do</span>
	<span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mi">2</span>              <span class="c1">--初始组员编号及数值（本例组员设置为从-2计起）</span>
<span class="kr">end</span>                             <span class="c1">--！！！但不建议设置编号为负数！！！</span>
<span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span> <span class="kr">do</span>
	<span class="n">print</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>             <span class="c1">--打印所有的组员：-4 -2 0 2 4（共5行组员数值）</span>
<span class="kr">end</span>

<span class="c1">-----【多维数组】-----</span>
<span class="n">array</span> <span class="o">=</span> <span class="p">{}</span>                      <span class="c1">--数组 array（空数组，需要初始组员编号及数值）</span>
<span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span> <span class="kr">do</span>
	<span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>               <span class="c1">--数组 array 首先初始一维数组，（必须初始第一维后，再初始此一维中的第二维，否则视为非法语句！）</span>
	<span class="kr">for</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span> <span class="kr">do</span>
		<span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">j</span>       <span class="c1">--数组 array 接着初始二维数组。（必须初始第一维后，再初始此一维中的第二维，否则视为非法语句！）</span>
	<span class="kr">end</span>
<span class="kr">end</span>
<span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span> <span class="kr">do</span>
	<span class="kr">for</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span> <span class="kr">do</span>
		<span class="n">print</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>      <span class="c1">--打印所有的组员：1 2 3 2 4 6 3 6 9（共9行组员数值）</span>
	<span class="kr">end</span>
<span class="kr">end</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>三、lua 的字符串：</strong></p>
</blockquote>
<p><strong>说明三</strong>、字符串语法包括<code>&quot;&quot;</code> <code>''</code> <code>[[]]</code>，其中<code>[[]]</code>中书写的特殊字符不需要转义。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----【字符串】-------</span>
<span class="n">s</span> <span class="o">=</span> <span class="s">[[a\\\&#34;\&#39;[[b]c]]</span>            <span class="c1">--多行字符串：其语法不支持转义符，不支持连续多个“]”字符，但支持单个或隔开的“]”字符。</span>
<span class="n">string1</span> <span class="o">=</span> <span class="s2">&#34;Lua&#34;</span>                 <span class="c1">--单行字符串：&#34;&#34;  （注：&#34;&#34; 与 &#39;&#39; 没本质区别）</span>
<span class="n">string2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#34;</span><span class="s1">runoob.com</span><span class="se">\&#34;</span><span class="s1">&#39;</span>      <span class="c1">--单行字符串：&#39;&#39;  （注：&#34;&#34; 与 &#39;&#39; 没本质区别）</span>
<span class="n">string3</span> <span class="o">=</span>                       <span class="c1">--多行字符串：[[]]（注：[[ 后可直接换行，不算入多行字符串的回车或换行！）</span>
<span class="s">[[
</span><span class="s">&#34;Lua
</span><span class="s">Script&#34;
</span><span class="s">]]</span>

<span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                        <span class="c1">--打印的信息为：a\\\&#34;\&#39;[[b]c（本例为了说明[[]]内特殊字符不需要书写转义符）</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;string1&#34;</span>    <span class="o">..</span> <span class="n">string1</span><span class="p">)</span>  <span class="c1">--打印的信息为：string1Lua  （使用 .. 拼接功能）</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">string1:</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">string1</span><span class="p">)</span>  <span class="c1">--打印的信息为：&#34;string1:&#34;  Lua</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;string2:&#34;</span>    <span class="p">,</span> <span class="n">string2</span><span class="p">)</span>  <span class="c1">--打印的信息为：string2:    runoob.com</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;string3:&#34;</span>    <span class="p">,</span> <span class="n">string3</span><span class="p">)</span>  <span class="c1">--打印的信息为：string3:    &#34;Lua</span>
                                <span class="c1">--　　　　　　　Script&#34;</span>
                                <span class="c1">--　　　　　　 （空行）</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>说明四</strong>、对于使用<code>[[]]</code>书写的字符串、或者通过文件方式读取的内容，lua 已自动为我们加入了转义符，所以无需关心特殊字符是否要转义。</p>
<table>
<thead>
<tr>
<th style="text-align:left"><div style="width:64px">特殊字符</div></th>
<th style="text-align:left">字符</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>\\</code></td>
<td style="text-align:left">代表一个反斜线字符：\ （可见符）</td>
</tr>
<tr>
<td style="text-align:left"><code>\'</code></td>
<td style="text-align:left">代表一个单引号字符：'  （可见符）</td>
</tr>
<tr>
<td style="text-align:left"><code>\&quot;</code></td>
<td style="text-align:left">代表一个双引号字符：&quot;  （可见符）</td>
</tr>
<tr>
<td style="text-align:left">\a</td>
<td style="text-align:left">响铃</td>
</tr>
<tr>
<td style="text-align:left">\b</td>
<td style="text-align:left">退格</td>
</tr>
<tr>
<td style="text-align:left">\f</td>
<td style="text-align:left">换页</td>
</tr>
<tr>
<td style="text-align:left">\n</td>
<td style="text-align:left">换行</td>
</tr>
<tr>
<td style="text-align:left">\r</td>
<td style="text-align:left">回车</td>
</tr>
<tr>
<td style="text-align:left">\t</td>
<td style="text-align:left">水平制表(HT)（跳到下一个TAB位置）</td>
</tr>
<tr>
<td style="text-align:left">\v</td>
<td style="text-align:left">垂直制表(VT)</td>
</tr>
<tr>
<td style="text-align:left">\0</td>
<td style="text-align:left">空字符</td>
</tr>
<tr>
<td style="text-align:left">\ddd</td>
<td style="text-align:left">3 位八进制数所代表的任意字符（如：<code>\777</code>）</td>
</tr>
<tr>
<td style="text-align:left">\xhh</td>
<td style="text-align:left">2 位十六进制所代表的任意字符（如：<code>\xF5</code>）</td>
</tr>
</tbody>
</table>
</details>  
<details close=""><summary>4、lua 控制</summary>  
<blockquote>
<p><strong>一、循环控制语句：</strong></p>
</blockquote>
<p><strong>说明一</strong>、循环控制语句包括：<code>for do … end</code>、<code>for in do … end</code>、<code>while() do … end</code>、<code>repeat … until()</code>四种语法。循环支持嵌套，可以使用<code>beak</code>或<code>goto</code>（语法：<code>goto label2</code>和<code>::label2::</code>）语句退出循环体。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----【数值for循环】-----</span>
<span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span> <span class="kr">do</span>               <span class="c1">--循环条件为(i=5; i&lt;=10; i+=1)（注1：不能递减！[i]在循环体内只能读！递增值必须为正数!）</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;i = &#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>            <span class="c1">--循环体 do …… end 之间。     （注2：起始值、结束值、递增值为函数时，函数都只调用一次）</span>
<span class="kr">end</span>                             <span class="c1">--第一次循环打印：i =   5      （注3：for条件的变量不会因for循环体内的改动而改变！！！）</span>
                                <span class="c1">--第二次……</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">10</span>
<span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span> <span class="kr">do</span>                  <span class="c1">--共循环10次 （注意：[m]在循环体内变化，不影响 for 条件判断！！！）</span>
	<span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>                    <span class="c1">--打印：1、2、3、…、10</span>
	<span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>                       <span class="c1">--注意：[m]在循环体内变化，不影响 for 条件判断！！！</span>
<span class="kr">end</span>

<span class="c1">-----【泛型for循环】-----</span>
<span class="n">days</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;Sunday&#34;</span><span class="p">,</span><span class="s2">&#34;Monday&#34;</span><span class="p">,</span><span class="s2">&#34;Tuesday&#34;</span><span class="p">,</span><span class="s2">&#34;Wednesday&#34;</span><span class="p">,</span><span class="s2">&#34;Thursday&#34;</span><span class="p">,</span><span class="s2">&#34;Friday&#34;</span><span class="p">,</span><span class="s2">&#34;Saturday&#34;</span><span class="p">}</span>
<span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">ipairs</span><span class="p">(</span><span class="n">days</span><span class="p">)</span> <span class="kr">do</span>      <span class="c1">--使用〖组员〗迭代器（中途遇到组员值为`nil`立即结束）（注1：迭代器 iterator /ɪtə&#39;reɪtə/）</span>
	<span class="n">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>                 <span class="c1">--第一次循环打印：1  Sunday                     （注2：泛型for迭代器函数要求返回格式为:数组键号(k)、组员数值(v)）</span>
<span class="kr">end</span>                             <span class="c1">--第二次循环打印：2  Monday</span>
                                <span class="c1">--第三次……</span>
<span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;hello world from Lua&#34;</span>
<span class="kr">for</span> <span class="n">v</span> <span class="kr">in</span> <span class="n">string.gmatch</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&#34;%a+&#34;</span><span class="p">)</span> <span class="kr">do</span>
	<span class="n">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>                    <span class="c1">--第一次循环打印：hello</span>
<span class="kr">end</span>                             <span class="c1">--第二次循环打印：world</span>
                                <span class="c1">--第三次……</span>

<span class="c1">-----【先判断再循环】-----</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="kr">while</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="kr">do</span>               <span class="c1">--循环条件为(n &lt; 15)</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;n = &#34;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>            <span class="c1">--循环体 do …… end 之间。</span>
	<span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>                   <span class="c1">--[n]在循环体内变化，影响循环条件！</span>
<span class="kr">end</span>

<span class="c1">-----【先循环再判断】-----</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="kr">repeat</span>                          <span class="c1">--循环体 repeat …… until 之间。</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;n = &#34;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
	<span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>                   <span class="c1">--[n]在循环体内变化，影响循环条件！</span>
<span class="kr">until</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">)</span>                  <span class="c1">--结束条件为(n &gt; 15)（注意：这是结束条件！）</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>二、流程控制语句：</strong></p>
</blockquote>
<p><strong>说明二</strong>、流程控制语句包括：<code>if then … elseif then … else … end</code>语法。流程支持嵌套，可以使用<code>goto</code>（语法：<code>goto label2</code>和<code>::label2::</code>）语句退出执行体。其中 Lua 认为<code>false</code>和<code>nil</code>为 <strong>假</strong>，<code>true</code>和<code>非 nil</code>为 <strong>真</strong>（也就是说数值 0 也为真！）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----【一个执行体】-----</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">10</span>
<span class="kr">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">)</span> <span class="kr">then</span>                <span class="c1">--判断条件为(a &lt; 20)</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;a &lt; 20, a = &#34;</span> <span class="o">..</span> <span class="n">a</span><span class="p">)</span>  <span class="c1">--执行体 then …… end 之间。</span>
<span class="kr">end</span>                             <span class="c1">--打印信息：a &lt; 20, a = 10</span>

<span class="c1">-----【两个执行体】-----</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">20</span>
<span class="kr">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">)</span> <span class="kr">then</span>                <span class="c1">--判断条件为(a &lt; 20)</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;a &lt;  20, a = &#34;</span> <span class="o">..</span> <span class="n">a</span><span class="p">)</span> <span class="c1">--执行体 then … else … end 之间。</span>
<span class="kr">else</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;a &gt;= 20, a = &#34;</span> <span class="o">..</span> <span class="n">a</span><span class="p">)</span> <span class="c1">--打印信息：a &gt;= 20, a = 20</span>
<span class="kr">end</span>

<span class="c1">-----【多个执行体】-----</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">100</span>
<span class="kr">if</span>     <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span> <span class="kr">then</span>           <span class="c1">--判断条件为(a == 10)</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;a == 10&#34;</span><span class="p">)</span>
<span class="kr">elseif</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mi">20</span><span class="p">)</span> <span class="kr">then</span>           <span class="c1">--判断条件为(a == 20)</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;a == 20&#34;</span><span class="p">)</span>
<span class="kr">elseif</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mi">30</span><span class="p">)</span> <span class="kr">then</span>           <span class="c1">--判断条件为(a == 30)</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;a == 30&#34;</span><span class="p">)</span>
<span class="kr">else</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;a == ??&#34;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></td></tr></table>
</div>
</div></details>  
<details close=""><summary>5、lua 函数</summary>  
<blockquote>
<p><strong>函数语法</strong>：<code>function name() … end</code>。函数分为全局函数、局部函数（函数前加<code>local</code>关键字即可）。函数入口可以是一个或多个参数，也可以是可变参数；出口可以返回一个参数或多个参数，也可以是可变参数（如：<code>return a</code>、<code>return a,b</code>、<code>return &quot;abcd&quot;</code>、<code>return ...</code>等）。</p>
<hr>
<p><strong>迭代器</strong>（iterator /ɪtə&rsquo;reɪtə/）：是一种可以遍历集合中所有元素的机制，其通过循环语句调用 迭代函数，逐一取出(遍历)符合条件的相关数据。技术特点：迭代函数在第一次被调用时初始化现场，之后调用后返回时会保持现场为下次接续调用准备（有点类似自动步枪，第一发手工上膛(初始化)，之后射一发后会自动为下一发上膛）。关于迭代函数参考网文：<a href="https://zhuanlan.zhihu.com/p/161848869" target="_blank" rel="noopener noreffer">lua 迭代器学习</a>、<a href="https://blog.csdn.net/shimazhuge/article/details/41747445" target="_blank" rel="noopener noreffer">Lua 迭代器与泛型 for</a></p>
<hr>
<p><strong>闭包（closure /&lsquo;kləʊʒər/）</strong>：将一个函数写在另一个函数之内，那么这个位于内部的函数便可以访问外部函数中的局部变量，这项特性称之为词法域。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----【指定名称函数】-----</span>
<span class="kr">function</span> <span class="nf">num_max</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">)</span>             <span class="c1">--指定名称函数为 num_max()!!!!!!!!!!!!</span>
	<span class="kr">if</span> <span class="p">(</span><span class="n">num1</span> <span class="o">&gt;</span> <span class="n">num2</span><span class="p">)</span> <span class="kr">then</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">num1</span>
	<span class="kr">else</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">num2</span>
	<span class="kr">end</span>
	<span class="kr">return</span> <span class="n">result</span>                        <span class="c1">--注：可以返回多个值，每个值以逗号隔开</span>
<span class="kr">end</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;10, 4, max = &#34;</span> <span class="o">..</span> <span class="n">num_max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="c1">--调用 print() 入口处调用函数 num_max()</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;5, 16, max = &#34;</span><span class="p">,</span>   <span class="n">num_max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span> <span class="c1">--调用 print() 入口处调用函数 num_max()</span>

<span class="c1">-----【别名索引函数】-----</span>
<span class="n">p_max</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">)</span>             <span class="c1">--函数传递给变量 p_max !!!!!!!!!!!!!!!!</span>
	<span class="kr">if</span> <span class="p">(</span><span class="n">num1</span> <span class="o">&gt;</span> <span class="n">num2</span><span class="p">)</span> <span class="kr">then</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">num1</span>
	<span class="kr">else</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">num2</span>
	<span class="kr">end</span>
	<span class="kr">return</span> <span class="n">result</span>                        <span class="c1">--注：可以返回多个值，每个值以逗号隔开</span>
<span class="kr">end</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;10, 4, max = &#34;</span> <span class="o">..</span> <span class="n">p_max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>   <span class="c1">--调用 print() 入口处调用函数 p_max()</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;5, 16, max = &#34;</span><span class="p">,</span>   <span class="n">p_max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>   <span class="c1">--调用 print() 入口处调用函数 p_max()</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----【入口为可变参数】-----</span>
<span class="kr">function</span> <span class="nf">add</span><span class="p">(...)</span>                        <span class="c1">--可变参数函数 add(...)</span>
	<span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>  
	<span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="n">ipairs</span><span class="p">{...}</span> <span class="kr">do</span>           <span class="c1">--{...}表示一个由所有变长参数构成的数组</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">v</span>
	<span class="kr">end</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;sum = &#34;</span> <span class="o">..</span> <span class="n">select</span><span class="p">(</span><span class="s2">&#34;#&#34;</span><span class="p">,...))</span>   <span class="c1">-- 打印可变参数的个数</span>
	<span class="n">print</span><span class="p">(</span>            <span class="n">select</span><span class="p">(</span><span class="mi">3</span><span class="p">,...))</span>     <span class="c1">-- 打印第3个到最后一个参数的数值（注：.. 只支持一个数值拼接）</span>
	<span class="kr">return</span> <span class="n">s</span>
<span class="kr">end</span>  
<span class="n">print</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>                    <span class="c1">--有 5 个参数时的调用</span>
<span class="n">print</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>                  <span class="c1">--有 6 个参数时的调用</span>

<span class="c1">-----【入口参数为数组】-----</span>
<span class="kr">function</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>                          <span class="c1">--函数为 add(a)</span>
	<span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>  
	<span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="n">ipairs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="kr">do</span>             <span class="c1">--ipairs(a)用来迭代数组（中途遇到组员值为`nil`立即结束）</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">v</span>
	<span class="kr">end</span>
	<span class="kr">return</span> <span class="n">s</span>
<span class="kr">end</span>  
<span class="n">print</span><span class="p">(</span><span class="n">add</span><span class="p">({</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">}))</span>                  <span class="c1">--参数为数组{3,4,5,6,7}</span>
<span class="n">print</span><span class="p">(</span><span class="n">add</span><span class="p">({</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">}))</span>                <span class="c1">--参数为数组{3,4,5,6,7,8}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----【泛型for迭代函数】-----</span>
<span class="kr">function</span> <span class="nf">iter</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>                      <span class="c1">--迭代器函数[原型]（★无状态迭代器★）---------------------------</span>
	<span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>                            <span class="c1">--★迭代函数的入口要求：1.状态常量(a)、2.控制变量(k)</span>
	<span class="kr">if</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="kr">then</span>
		<span class="kr">return</span> <span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>                   <span class="c1">--★返回数组的典型参数：1.控制变量(k)、2.返回值(v)</span>
	<span class="kr">end</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">myipairs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>                     <span class="c1">--迭代器函数[封装]（★无状态迭代器★）---------------------------</span>
	<span class="kr">return</span> <span class="n">iter</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span>                      <span class="c1">--★迭代器调用格式封装：1.迭代函数(f)、2.状态常量(a)、3.控制变量(k:初始值0)</span>
<span class="kr">end</span>                                      <span class="c1">--组织：f1(a) -&gt; f2(a,k) -&gt; k,v</span>

<span class="n">array</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;aa&#34;</span><span class="p">,</span> <span class="s2">&#34;bb&#34;</span><span class="p">,</span> <span class="s2">&#34;cc&#34;</span><span class="p">,</span> <span class="s2">&#34;dd&#34;</span><span class="p">}</span>
<span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">myipairs</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="kr">do</span>            <span class="c1">--与 ipairs() 一样用途的 myipairs() （泛型for缓存三个参数:迭代函数(f)、状态常量(a:数组)、控制变量(k)。[v]是每次取出的组员值）</span>
   <span class="n">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>                            <span class="c1">--第一次循环打印：1  aa</span>
<span class="kr">end</span>                                      <span class="c1">--第二次……</span>

<span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">iter</span><span class="p">,</span><span class="n">array</span><span class="p">,</span><span class="mi">0</span> <span class="kr">do</span>               <span class="c1">--★迭代器[原型]调用格式：1.迭代函数(f)、2.状态常量(a)、3.控制变量(k:初始值0)</span>
   <span class="n">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>                            <span class="c1">--第一次循环打印：1  aa</span>
<span class="kr">end</span>                                      <span class="c1">--第二次……</span>

<span class="c1">-----【闭包型迭代函数】-----</span>
<span class="kr">function</span> <span class="nf">iter</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>                         <span class="c1">--★函数输入参数：个数/数值自由决定！！！</span>
	<span class="kd">local</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="kd">local</span> <span class="n">c</span> <span class="o">=</span> <span class="o">#</span><span class="n">a</span>                         <span class="c1">--算出组员总数（注意：不是表员总数）</span>
   
	<span class="kr">return</span> <span class="kr">function</span><span class="p">()</span>                    <span class="c1">--★闭包函数（★多状态迭代器★）---------------------------------</span>
		<span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="kr">if</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">c</span> <span class="kr">then</span>
			<span class="kr">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>            <span class="c1">--★函数返回参数：个数/数值自由决定！</span>
		<span class="kr">end</span>
	<span class="kr">end</span>
<span class="kr">end</span>

<span class="n">array</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;aa&#34;</span><span class="p">,</span> <span class="s2">&#34;bb&#34;</span><span class="p">,</span> <span class="s2">&#34;cc&#34;</span><span class="p">,</span> <span class="s2">&#34;dd&#34;</span><span class="p">}</span>
<span class="kr">for</span> <span class="n">c</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">iter</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="kr">do</span>              <span class="c1">--★for调用闭包方法!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
	<span class="n">print</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>                         <span class="c1">--第一次循环打印：4  1  aa</span>
<span class="kr">end</span>                                      <span class="c1">--第二次循环打印：4  2  bb</span>
                                         <span class="c1">--第三次……</span>
<span class="n">p</span><span class="o">=</span><span class="n">iter</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="c1">--★★闭包函数直接返回是一个函数变量，之后函数变量调用返回才是数据（留意其里面有两个return!）</span>
<span class="kr">while</span> <span class="kc">true</span> <span class="kr">do</span>                            <span class="c1">--★while调用闭包方法!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
	<span class="kd">local</span> <span class="n">c</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">()</span>                      <span class="c1">--闭包型迭代函数调用!!!!!!!!!!!!!!!（相当于C语言指针方式调用！不能直接调用！）</span>
	<span class="kr">if</span> <span class="n">c</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="kr">then</span>
		<span class="n">print</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>                     <span class="c1">--第一次循环打印：4  1  aa</span>
	<span class="kr">else</span>                                 <span class="c1">--第二次循环打印：4  2  bb</span>
		<span class="kr">break</span>                            <span class="c1">--第三次……</span>
	<span class="kr">end</span>
<span class="kr">end</span>

<span class="n">p</span><span class="o">=</span><span class="n">iter</span><span class="p">(</span><span class="n">array</span><span class="p">);</span>       <span class="kd">local</span> <span class="n">c</span><span class="p">,</span><span class="n">k</span>           <span class="c1">--★普通方式调用，实现典型计数器!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<span class="n">c</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">p</span><span class="p">();</span> <span class="n">print</span><span class="p">(</span><span class="s2">&#34;counter = &#34;</span><span class="o">..</span><span class="n">k</span><span class="p">)</span>          <span class="c1">--第一次计数，打印结果：counter = 1</span>
<span class="n">c</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">p</span><span class="p">();</span> <span class="n">print</span><span class="p">(</span><span class="s2">&#34;counter = &#34;</span><span class="o">..</span><span class="n">k</span><span class="p">)</span>          <span class="c1">--第二次计数，打印结果：counter = 2</span>
<span class="n">c</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">p</span><span class="p">();</span> <span class="n">print</span><span class="p">(</span><span class="s2">&#34;counter = &#34;</span><span class="o">..</span><span class="n">k</span><span class="p">)</span>          <span class="c1">--第三次计数，打印结果：counter = 3</span>
										 <span class="c1">--  …                           …</span>
<span class="c1">---------------------------------------------------------------------</span>
<span class="c1">--执行效率高到低：无状态迭代器 → 闭包(多状态迭代器) → table(不推荐)</span>
<span class="c1">---------------------------------------------------------------------</span>
</code></pre></td></tr></table>
</div>
</div></details>  
<details close=""><summary>6、lua 模块</summary>  
<blockquote>
<p>主要包括三方面：<br>
1、lua 调用 lua（lua 模块）<br>
2、lua 调用 C（lua 包）<br>
3、C 调用 lua（lua 函数）。<br>
关于 lua 与 c 之前传递参数，lua 使用模拟栈方式实现参数传递，其中<code>-1</code>表示栈顶，<code>1</code>表示栈底，具体可参考网文：<a href="https://blog.csdn.net/arnozhang12/article/details/6848205" target="_blank" rel="noopener noreffer">Lua调用C/C++ → 4.1.堆栈结构解析</a></p>
</blockquote>
<p><strong>一、【lua 模块】之 lua 调用 lua 模块</strong></p>
<ul>
<li>【lua 模块】其实就是单独写的一个lua 脚本文件，它实质就是表，封装到一个 lua 脚本文件的全局表（表名与文件同名），其表员必须是有键名的表员。</li>
<li>lua 模块路径搜索策略：函数<code>require()</code>→ 全局变量<code>package.path</code>→ 环境变量<code>LUA_PATH</code>→<code>package.loadfile</code> → 加载 Lua 脚本文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">----------------------</span>
<span class="c1">----【my.lua】脚本文件</span>
<span class="c1">----------------------</span>
<span class="n">my</span> <span class="o">=</span> <span class="p">{}</span>                                     <span class="c1">--全局数组：my</span>

<span class="n">my.static</span> <span class="o">=</span> <span class="s2">&#34;abc&#34;</span>                           <span class="c1">--全局变量：my.static</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">func1</span><span class="p">()</span>                      <span class="c1">--局部函数：func1()</span>
	<span class="kr">return</span> <span class="s2">&#34;func1()&#34;</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">my</span><span class="p">.</span><span class="nf">func2</span><span class="p">()</span>                         <span class="c1">--全局函数：my.func2()</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;run my.func2()&#34;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">my</span><span class="p">.</span><span class="nf">func3</span><span class="p">()</span>                         <span class="c1">--全局函数：my.func3()</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;run my.func3() -&gt; &#34;</span><span class="o">..</span><span class="n">func1</span><span class="p">())</span>
<span class="kr">end</span>
 
<span class="kr">return</span> <span class="n">my</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">------------------------</span>
<span class="c1">----【test.lua】脚本文件</span>
<span class="c1">------------------------</span>
<span class="c1">--#!/usr/local/bin/lua</span>
<span class="c1">--print(package.path)                         --打印出lua模块加载路径。如果【my.lua】模块无法加载，则需要增加指定加载路径，例如：┐</span>
<span class="c1">--package.path = &#34;./123/?.lua;&#34;..package.path --在加载模块前[临时]加入指定加载路径（即：在 require(&#34;my&#34;) 前）←─────────┘</span>
<span class="c1">--print(package.path)                         --打印出lua模块加载路径。（从打印信息可以看到增加了&#34;./123/?.lua&#34;路径）</span>

<span class="n">require</span><span class="p">(</span><span class="s2">&#34;my&#34;</span><span class="p">)</span>                                 <span class="c1">--加载模块（也可这样写：require &#34;my&#34;）（/rɪ&#39;kwaɪər/）</span>
<span class="kd">local</span> <span class="n">me</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;my&#34;</span><span class="p">)</span>                      <span class="c1">--为模块起别名</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;get my.static: &#34;</span><span class="o">..</span><span class="n">my.static</span><span class="p">)</span>           <span class="c1">--读取模块变量(全局)：my.static，打印信息：get my.static: abc</span>
<span class="n">my.func2</span><span class="p">()</span>                                    <span class="c1">--调用模块函数(全局)：my.func2 ，打印信息：run my.func2()</span>
<span class="n">my.func3</span><span class="p">()</span>                                    <span class="c1">--调用模块函数(全局)：my.func3 ，打印信息：run my.func3() -&gt; func1()</span>
<span class="n">me.func3</span><span class="p">()</span>                                    <span class="c1">--调用模块函数(全局)：my.func3 ，打印信息：run my.func3() -&gt; func1()</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>二、【lua 包】之 lua 调用 c 语言编译库</strong></p>
<ul>
<li>【lua 包】其实就是使用 C/C++ 语言按 lua 标准专为 lua 编写的扩展模块，在 linux 下编译为 so 动态库文件（windows 为 dll），其极大的提高 Lua 的可扩展性和可用性。</li>
<li>lua 包的路径搜索策略：函数<code>require()</code>→ 全局变量<code>package.cpath</code>→ 环境变量<code>LUA_CPATH</code>→<code>package.loadlib</code> → 加载 so 或 dll 库文件</li>
<li>关于 lua 包参考网文：<a href="https://www.cnblogs.com/ghost240/p/3229597.html" target="_blank" rel="noopener noreffer">c 语言的 lua 库编写</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="c1">//----------------------
</span><span class="c1">//--【myc.c】C文件源代码
</span><span class="c1">//----------------------
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;lua.h&#34;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;lualib.h&#34;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;lauxlib.h&#34; //lua作者写错? 为什么不叫&lt;luaxlib.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">L</span><span class="p">)</span>                  <span class="c1">//案例：算出两个数的和-----------
</span><span class="c1"></span><span class="p">{</span>
	<span class="kt">double</span> <span class="n">op1</span> <span class="o">=</span> <span class="n">luaL_checknumber</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>      <span class="c1">//lua入口参数&lt;1&gt;
</span><span class="c1"></span>	<span class="kt">double</span> <span class="n">op2</span> <span class="o">=</span> <span class="n">luaL_checknumber</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>      <span class="c1">//lua入口参数&lt;2&gt;
</span><span class="c1"></span>
	<span class="kt">double</span> <span class="n">op3</span> <span class="o">=</span> <span class="n">op1</span> <span class="o">+</span> <span class="n">op2</span><span class="p">;</span>                   <span class="c1">//本函数运算
</span><span class="c1"></span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">op3</span><span class="p">);</span>                   <span class="c1">//lua出口参数&lt;1&gt;
</span><span class="c1"></span>	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>                                 <span class="c1">//lua出口参数&lt;个数&gt;
</span><span class="c1"></span><span class="p">}</span>
                                              <span class="c1">//向lua注册可用函数--------------
</span><span class="c1"></span><span class="k">static</span> <span class="n">luaL_Reg</span> <span class="n">myfunc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>                  <span class="c1">//函数注册表：
</span><span class="c1"></span>    <span class="p">{</span><span class="s">&#34;add&#34;</span><span class="p">,</span> <span class="n">add</span><span class="p">},</span>                             <span class="c1">//add()
</span><span class="c1"></span>    <span class="p">{</span><span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">}</span>                              <span class="c1">//结束符!!!!
</span><span class="c1"></span><span class="p">};</span>
<span class="kt">int</span> <span class="nf">luaopen_myc</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">L</span><span class="p">)</span>                 <span class="c1">//lua要求注册函数必须为: luaopen_xxx, xxx 就是模块名称(包括编译出来so库文件的名称也必须为xxx)
</span><span class="c1"></span><span class="p">{</span>	                                                           <span class="c1">//本例: luaopen_myc, 编译生成库文件为[myc.so]
</span><span class="c1"></span>    <span class="n">luaL_newlib</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">myfunc</span><span class="p">);</span>                   <span class="c1">//函数注册（告诉lua知道有哪些可使用函数）
</span><span class="c1"></span>    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*-------------获取其它类型入口参数函数-------------
</span><span class="cm">//&#34;lauxlib.h&#34;
</span><span class="cm">luaL_checkany     --检测任何值(可以为 nil)
</span><span class="cm">luaL_checknumber  --检测一个值是否为 number (double),并返回。
</span><span class="cm">luaL_checkint     --检测一个值是否为 number (double),并转换成(int)
</span><span class="cm">luaL_checklong    --检测一个值是否为 number (double),并转换成(long)
</span><span class="cm">luaL_checkinteger --检测一个值是否为 number (double),并转换成 lua_Integer(prtdiff_t)，在我的机子上 prtdiff_t 被定义为(int)
</span><span class="cm">luaL_checkstring  --检测一个值是否为 string,并返回。
</span><span class="cm">luaL_checklstring --检测一个值是否为 string,并将字符串长度传递给[入口参数(指针)]中返回
</span><span class="cm">luaL_checkudata   --检测自定义类型
</span><span class="cm">*/</span>
<span class="cm">/*-------------常用参数压栈函数(C-&gt;lua)-----------------
</span><span class="cm">//&#34;lua.h&#34;
</span><span class="cm">void        (lua_pushnil)     (lua_State *L);
</span><span class="cm">void        (lua_pushnumber)  (lua_State *L, lua_Number  n);
</span><span class="cm">void        (lua_pushinteger) (lua_State *L, lua_Integer n);
</span><span class="cm">const char *(lua_pushlstring) (lua_State *L, const char *s, size_t len);
</span><span class="cm">const char *(lua_pushstring)  (lua_State *L, const char *s);
</span><span class="cm">*/</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">#---------------------------</span>
<span class="c1">#---【myc.so】为编译生成so库</span>
<span class="c1">#---------------------------</span>
gcc -shared -fPIC myc.c -o myc.so             <span class="c1">#直接在命令窗口使用gcc编译生成so库文件，为专给lua调用的模块（lua包）</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">------------------------</span>
<span class="c1">----【test.lua】脚本文件</span>
<span class="c1">------------------------</span>
<span class="c1">--#!/usr/local/bin/lua</span>
<span class="c1">--print(package.cpath)                        --打印出lua模块加载路径，如果【myc.so】模块无法加载，则需要增加指定加载路径，例如：┐</span>
<span class="c1">--package.cpath = &#34;./aa/?.so;&#34;..package.cpath --加载第三方的so库文件（windows系统则是dll库文件） ←───────────────┘</span>
<span class="c1">--print(package.path)                         --打印出lua模块加载路径（从打印信息可以看到增加了&#34;./aa/?.lua&#34;路径）</span>

<span class="n">myc</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;myc&#34;</span><span class="p">)</span>                          <span class="c1">--加载模块（也可这样写：require &#34;myc&#34;）（/rɪ&#39;kwaɪər/）</span>
<span class="n">print</span><span class="p">(</span><span class="n">myc.add</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span>                      <span class="c1">--打印出来的结果：3.0</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>三、【lua 函数】之 c 调用 lua 函数</strong></p>
<ul>
<li>事前准备：由于 lua 源代码默认只编译生成【静态库】，但 c 程序需要调用其【动态库】才可编译运行！所以我们首先需要重新编译及安装 lua 软件。</li>
<li>关于 lua 堆栈操作：只有 c 调用 lua 需要手工 pop 栈，而 lua 调用 c 不需要。</li>
<li>关于 lua 堆栈网文：<a href="https://blog.csdn.net/zhuzhuyule/article/details/41086745" target="_blank" rel="noopener noreffer">Lua 调用原理展示（lua 的堆栈）</a>、<a href="https://blog.csdn.net/ai5945fei/article/details/107839295" target="_blank" rel="noopener noreffer">网文2</a>、<a href="https://www.cnblogs.com/sevenyuan/p/4511808.html" target="_blank" rel="noopener noreffer">网文3</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">#-------------------------------------------------------</span>
<span class="c1">#【1】修改 ~/lua-5.4.3/Makefile（用文本编辑工具修改）</span>
<span class="c1">#-------------------------------------------------------</span>
<span class="c1"># 将&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
<span class="nv">TO_LIB</span><span class="o">=</span> liblua.a
<span class="c1"># 修改为</span>
<span class="nv">TO_LIB</span><span class="o">=</span> liblua.a liblua.so  <span class="c1">###表示同时编译静态库和动态库</span>

<span class="c1">#-------------------------------------------------------</span>
<span class="c1">#【2】修改 ~/lua-5.4.3/src/Makefile（用文本编辑工具修改）</span>
<span class="c1">#-------------------------------------------------------</span>
<span class="c1"># 将&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
<span class="nv">CFLAGS</span><span class="o">=</span> -O2 -Wall -Wextra -DLUA_COMPAT_5_3 <span class="k">$(</span>SYSCFLAGS<span class="k">)</span> <span class="k">$(</span>MYCFLAGS<span class="k">)</span>
<span class="c1"># 修改为</span>
<span class="nv">CFLAGS</span><span class="o">=</span> -O2 -Wall -Wextra -DLUA_COMPAT_5_3 <span class="k">$(</span>SYSCFLAGS<span class="k">)</span> <span class="k">$(</span>MYCFLAGS<span class="k">)</span> -fPIC <span class="c1">###增加编译动态库选项</span>

<span class="c1"># 在&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
<span class="nv">LUA_A</span><span class="o">=</span>  liblua.a
<span class="c1"># 下行增加 </span>
<span class="nv">LUA_SO</span><span class="o">=</span> liblua.so <span class="c1">###表示新建一个目标，要编译出lua动态库，编译出来的动态库文件名字为:liblua.so</span>

<span class="c1"># 将&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
<span class="nv">ALL_T</span><span class="o">=</span> <span class="k">$(</span>LUA_A<span class="k">)</span> <span class="k">$(</span>LUA_T<span class="k">)</span> <span class="k">$(</span>LUAC_T<span class="k">)</span>
<span class="c1"># 修改为</span>
<span class="nv">ALL_T</span><span class="o">=</span> <span class="k">$(</span>LUA_A<span class="k">)</span> <span class="k">$(</span>LUA_T<span class="k">)</span> <span class="k">$(</span>LUAC_T<span class="k">)</span> <span class="k">$(</span>LUA_SO<span class="k">)</span> <span class="c1">###同时生成动态库</span>

<span class="c1"># 在&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
<span class="k">$(</span>LUA_A<span class="k">)</span>: <span class="k">$(</span>BASE_O<span class="k">)</span>
	<span class="k">$(</span>AR<span class="k">)</span> <span class="nv">$@</span> <span class="k">$(</span>BASE_O<span class="k">)</span>
	<span class="k">$(</span>RANLIB<span class="k">)</span> <span class="nv">$@</span>
<span class="c1"># 下行增加 （###同时生成动态库，注意第二行前头须是Tab空格）</span>
<span class="k">$(</span>LUA_SO<span class="k">)</span>: <span class="k">$(</span>CORE_O<span class="k">)</span> <span class="k">$(</span>LIB_O<span class="k">)</span>
	<span class="k">$(</span>CC<span class="k">)</span> -o <span class="nv">$@</span> -shared <span class="nv">$?</span> -ldl -lm

<span class="c1">########################################################</span>
<span class="c1">#【3】重新编译lua生成动态库（在命令窗口进入~/lua-5.4.3）</span>
<span class="c1">########################################################</span>
make clean              <span class="c1">#清除（清除之前编译的中间文件，否则可能编译出错！）</span>
make all <span class="nb">test</span>           <span class="c1">#编译</span>
sudo make install       <span class="c1">#安装（安装到 /usr/local/bin/：lua(解释器)、luac(编译器)，及 /usr/local/lib/：liblua.a(静态库)、liblua.so(动态库)）</span>
sudo gedit /etc/profile <span class="c1">#修改环境变量：使用文件编辑工具打开 /etc/profile（或~/.bashrc），在其最后添加一行（增加环境变量）：</span>
                        <span class="c1">#              export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib/liblua.so</span>
<span class="nb">source</span> /etc/profile     <span class="c1">#生效环境变量。</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">------------------------</span>
<span class="c1">----【call.lua】脚本文件</span>
<span class="c1">------------------------</span>
<span class="kr">function</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">z</span>
	<span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>                        <span class="c1">--计算两个数的和</span>
	<span class="kr">return</span> <span class="n">z</span><span class="p">,</span> <span class="s2">&#34;lua&#34;</span>                  <span class="c1">--返回“和”，及“lua”标识符（返回两个参数）</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">dec</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">z</span>
	<span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span>                        <span class="c1">--计算两个数的差</span>
	<span class="kr">return</span> <span class="n">z</span><span class="p">,</span> <span class="s2">&#34;lua&#34;</span>                  <span class="c1">--返回“差”，及“lua”标识符（返回两个参数）</span>
<span class="kr">end</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="c1">//----------------------
</span><span class="c1">//--【run.c】C文件源代码
</span><span class="c1">//----------------------
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;lua.h&#34;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;lualib.h&#34;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;lauxlib.h&#34; //lua作者写错? 为什么不叫&lt;luaxlib.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="kt">double</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
	<span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> 
	<span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">2.1</span><span class="p">;</span>
	<span class="n">lua_State</span> <span class="o">*</span><span class="n">L</span><span class="p">;</span>                    <span class="c1">//声明Lua对象指针
</span><span class="c1"></span>	<span class="c1">//int f0;
</span><span class="c1"></span>
	<span class="c1">//首先：打开lua环境-----------------------------------------------------------------------------------
</span><span class="c1"></span>	<span class="n">L</span> <span class="o">=</span> <span class="n">luaL_newstate</span><span class="p">();</span>             <span class="c1">//1.初始lua对象指针
</span><span class="c1"></span>	<span class="n">luaL_openlibs</span><span class="p">(</span><span class="n">L</span><span class="p">);</span>                <span class="c1">//2.打开Lua的高级库 [io,string,math,table]等
</span><span class="c1"></span>
	<span class="c1">//--------------------------------
</span><span class="c1"></span>	<span class="c1">//加载lua脚本文件，执行lua中的函数
</span><span class="c1"></span>	<span class="c1">//--------------------------------
</span><span class="c1"></span>	<span class="n">luaL_dofile</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="s">&#34;call.lua&#34;</span><span class="p">);</span>      <span class="c1">//0.加载lua脚本文件（返回0表示正确）（紧接其后可加 lua_settop(L, 0) 确保栈底是空的）
</span><span class="c1"></span>	<span class="n">lua_getglobal</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="s">&#34;add&#34;</span><span class="p">);</span>         <span class="c1">//1.通过名字获取lua函数&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
</span><span class="c1"></span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>            <span class="c1">//2.压入第一个入口参数（Lua与C/C++之间都是通过栈来通信的）
</span><span class="c1"></span>	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>            <span class="c1">//  压入第二个入口参数（Lua与C/C++之间都是通过栈来通信的）
</span><span class="c1"></span>
	<span class="k">if</span> <span class="p">((</span><span class="n">lua_pcall</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//3.调用lua函数，告知有2个参数，2个返回值，最后0表示不提供错误处理函数（注:lua_call()入口没有错误函数,其它完全一样）
</span><span class="c1"></span>	<span class="o">&amp;&amp;</span>  <span class="p">(</span><span class="n">lua_isnumber</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>   <span class="c1">//4.判断返回值是否合法(是否为 number -&gt; double)(-1表示栈顶元素，1表示栈底，…)
</span><span class="c1"></span>	<span class="p">{</span>
		<span class="n">z</span> <span class="o">=</span> <span class="n">lua_tonumber</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>      <span class="c1">//5.获取第一个参数返回值(-1表示栈顶元素，1表示栈底，…)(lua_pcall()已将入口参数删除,所以栈底就是第一个返回参数!)
</span><span class="c1"></span>		<span class="n">printf</span><span class="p">(</span><span class="s">&#34;add() return: %f,%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">lua_tostring</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&#34;[error] running function: %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="s">&#34;add&#34;</span><span class="p">);</span> <span class="cm">/*
</span><span class="cm">		printf(&#34;[error] function return: %s\n&#34;, lua_tostring(L, 1)); */</span>
	<span class="p">}</span>

	<span class="cm">/*调用lua脚本的 dec() 函数
</span><span class="cm">	f0 = lua_gettop(L);              //x0.获取当前堆栈元素数量
</span><span class="cm">	lua_getglobal(L, &#34;dec&#34;);         //x1.通过名字获取lua函数&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
</span><span class="cm">
</span><span class="cm">	lua_pushnumber(L, x);            //x2.压入第一个入口参数（Lua与C/C++之间都是通过栈来通信的）
</span><span class="cm">	lua_pushnumber(L, y);            //   压入第二个入口参数（Lua与C/C++之间都是通过栈来通信的）
</span><span class="cm">
</span><span class="cm">	if ((lua_pcall(L, 2, 2, 0) == 0) //x3.调用lua函数，告知有2个参数，2个返回值，最后0表示不提供错误处理函数（注:lua_call()入口没有错误函数,其它完全一样）
</span><span class="cm">	&amp;&amp;  (lua_isnumber(L, f0+1) != 0))//x4.判断返回值是否合法(是否为 number -&gt; double)(-1表示栈顶元素，1表示栈底，…)
</span><span class="cm">	{
</span><span class="cm">		z = lua_tonumber(L, f0+1);   //x5.获取第一个参数返回值(-1表示栈顶元素，1表示栈底，…)(lua_pcall()已将入口参数删除,所以栈底就是第一个返回参数!)
</span><span class="cm">		printf(&#34;dec() return: %f,%s\n&#34;, z, lua_tostring(L, f0+2));
</span><span class="cm">	}
</span><span class="cm">	else
</span><span class="cm">	{
</span><span class="cm">		printf(&#34;[error] running function: %s\n&#34;, &#34;dec&#34;);
</span><span class="cm">	}
</span><span class="cm">	if ((f0 = lua_gettop(L) - f0) &gt; 0)
</span><span class="cm">	{
</span><span class="cm">		lua_pop(L, f0);              //x6.删除[dec]函数堆栈所有元素&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
</span><span class="cm">	}*/</span>

	<span class="n">lua_pop</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>                  <span class="c1">//6.删除Lua当前堆栈所有元素&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
</span><span class="c1"></span>
	<span class="c1">//最后：关闭lua环境-----------------------------------------------------------------------------------
</span><span class="c1"></span>	<span class="n">lua_close</span><span class="p">(</span><span class="n">L</span><span class="p">);</span>

	<span class="n">L</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/*-------------常用参数获取并转换函数(C-&gt;lua)-----------------
</span><span class="cm">//&#34;lua.h&#34;
</span><span class="cm">lua_tonumber   --获取返回值，将转换为 number (double)
</span><span class="cm">lua_tointeger  --
</span><span class="cm">lua_tostring   --获取返回值，将转换为 string  (返回的是指针)
</span><span class="cm">
</span><span class="cm">函数原型：
</span><span class="cm">lua_Number   (lua_tonumberx)  (lua_State *L, int idx, int *isnum);
</span><span class="cm">lua_Integer  (lua_tointegerx) (lua_State *L, int idx, int *isnum);
</span><span class="cm">const char  *(lua_tolstring)  (lua_State *L, int idx, size_t *len);
</span><span class="cm">int          (lua_toboolean)  (lua_State *L, int idx);
</span><span class="cm">*/</span>
<span class="cm">/*-------------其他一些栈操作函数(C-&gt;lua)---------------------
</span><span class="cm">int   lua_gettop    (lua_State *L);          //返回栈顶索引（即栈长度）  
</span><span class="cm">void  lua_settop    (lua_State *L, int idx); //                
</span><span class="cm">void  lua_pushvalue (lua_State *L, int idx); //将idx索引上的值的副本压入栈顶  
</span><span class="cm">void  lua_remove    (lua_State *L, int idx); //移除idx索引上的值  
</span><span class="cm">void  lua_insert    (lua_State *L, int idx); //弹出栈顶元素，并插入索引idx位置  
</span><span class="cm">void  lua_replace   (lua_State *L, int idx); //弹出栈顶元素，并替换索引idx位置的值
</span><span class="cm">*/</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">#----------------------</span>
<span class="c1">#-- 在命令窗口编译c程序</span>
<span class="c1">#----------------------</span>
gcc run.c -o run -llua               <span class="c1">#编译c程序，注意要加链接lua动态库：-llua</span>
./run                                <span class="c1">#运行c程序。最后结果打印：add() return: 3.100000,lua</span>
</code></pre></td></tr></table>
</div>
</div></details>  
<details close=""><summary>7、lua 元表</summary>  
<blockquote>
<p>Lua 提供了元表（MetaTable /&lsquo;metə/&lsquo;teɪbl/），允许我们改变 table 的行为，每个行为关联了对应的元方法。例如表：<code>tb = {}</code>，当<code>tb[1] = &quot;abc&quot;</code>时，Lua 默认的行为就是新建一个键值，但如果使用元表的元方法可以改变这句表达式的行为，例如自动在值前面增加前缀<code>&quot;my-&quot;</code>字符（具体如何改变行为，学习后面知识点），则打印键值<code>print(tb[1])</code>信息为<code>&quot;my-abc&quot;</code>而非<code>&quot;abc&quot;</code>，这就是元方法改变 table 的行为。还有 lua 没定义表的一些操作，需要我们来实现。例如：<code>tab1 + tab2</code>表示两个表相加，这句表达式意思是拼接两个表还是两个表所有键值相加？这就需要我们通过元方法来定义这句表达式实际行为。<br>
关于元表参考网文：<a href="https://www.cnblogs.com/blueberryzzz/p/8947446.html" target="_blank" rel="noopener noreffer">lua 元表详解</a></p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">两个重要的函数</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">setmetatable(table, metatable)</td>
<td style="text-align:left">对指定 table 设置元表（metatable）</td>
</tr>
<tr>
<td style="text-align:left">getmetatable(table)</td>
<td style="text-align:left">返回对象的元表（metatable）</td>
</tr>
</tbody>
</table>
<hr>
<table>
<thead>
<tr>
<th style="text-align:left"><div style="width:80px">元方法</div></th>
<th style="text-align:center"><div style="width:48px">表达式</div></th>
<th style="text-align:left">表现</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">__index</td>
<td style="text-align:center">=</td>
<td style="text-align:left">基表没有的键的【元方法读】索引到【读元表】，其它情形的【元方法读写】表现为【读写基表】</td>
</tr>
<tr>
<td style="text-align:left">__newindex</td>
<td style="text-align:center">=</td>
<td style="text-align:left">基表没有的键的【元方法写(增)】索引到【写(增)元表】，其它情形的【元方法读写】表现为【读写基表】</td>
</tr>
<tr>
<td style="text-align:left">__index<br> __newindex</td>
<td style="text-align:center">=</td>
<td style="text-align:left">当这两个元方法定义为同一个元表，表现为同时读写(增)基表和元表</td>
</tr>
<tr>
<td style="text-align:left">__call</td>
<td style="text-align:center"></td>
<td style="text-align:left">当函数调用（如：<code>tab(a,b,c)</code>中的<code>tab</code>原来是表，转化后则是个函数）</td>
</tr>
<tr>
<td style="text-align:left">__tostring</td>
<td style="text-align:center"></td>
<td style="text-align:left">转化为字符串（如：<code>print(tab)</code>中的<code>tab</code>原来是表，转化后则是字符串）</td>
</tr>
<tr>
<td style="text-align:left">__add</td>
<td style="text-align:center">+</td>
<td style="text-align:left">自定义两个表相加<code>tab + tabx</code>的行为</td>
</tr>
<tr>
<td style="text-align:left">__sub</td>
<td style="text-align:center">-</td>
<td style="text-align:left">自定义两个表相减<code>tab - tabx</code>的行为</td>
</tr>
<tr>
<td style="text-align:left">__mul</td>
<td style="text-align:center">*</td>
<td style="text-align:left">自定义两个表相乘<code>tab * tabx</code>的行为</td>
</tr>
<tr>
<td style="text-align:left">__div</td>
<td style="text-align:center">/</td>
<td style="text-align:left">自定义两个表相除<code>tab / tabx</code>的行为</td>
</tr>
<tr>
<td style="text-align:left">__mod</td>
<td style="text-align:center">%</td>
<td style="text-align:left">自定义两个表相余<code>tab % tabx</code>的行为</td>
</tr>
<tr>
<td style="text-align:left">__unm</td>
<td style="text-align:center">-</td>
<td style="text-align:left">自定义表取反<code>-tab</code>的行为</td>
</tr>
<tr>
<td style="text-align:left">__concat</td>
<td style="text-align:center">..</td>
<td style="text-align:left">自定义两个表连接<code>tab .. tabx</code>的行为</td>
</tr>
<tr>
<td style="text-align:left">__eq</td>
<td style="text-align:center">==</td>
<td style="text-align:left">自定义两个表比较相等<code>tab == tabx</code>的行为</td>
</tr>
<tr>
<td style="text-align:left">__lt</td>
<td style="text-align:center">&lt;</td>
<td style="text-align:left">自定义两个表比较小于<code>tab &lt; tabx</code>的行为</td>
</tr>
<tr>
<td style="text-align:left">__le</td>
<td style="text-align:center">&lt;=</td>
<td style="text-align:left">自定义两个表比较小于相等<code>tab &lt;= tabx</code>的行为</td>
</tr>
</tbody>
</table>
<p><strong>一、默认元方法设置元表</strong>（默认元方法是无法查询及修改元表的）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="n">tab</span>  <span class="o">=</span> <span class="p">{}</span>                     <span class="c1">--基表</span>
<span class="n">mtab</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span>                  <span class="c1">--元表</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">setmetatable</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">mtab</span><span class="p">)</span>  <span class="c1">--典型格式：把 mtab 设为 tab(及tb) 的元表</span>
<span class="c1">--tb = setmetatable({},{1,2}) --精简格式：为 tb 设置元表，与上面一样的，因为上面的 tab、mtab 代表两个数组 {}、{1,2}</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mtab</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>         <span class="c1">--打印结果：nil  1 （默认元方法是无法查询及修改元表的!!!!!!）</span>
<span class="n">tb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">444</span>  <span class="n">mtab</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mtab</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>         <span class="c1">--打印结果：444  5 （默认元方法是无法查询及修改元表的!!!!!!）</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>二、<code>__index</code>元方法</strong>（基表没有的键的【元方法读】索引到【读元表】，其它情形的【元方法读写】表现为【读写基表】）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----------------</span>
<span class="c1">--『直接初始方式』</span>
<span class="c1">-----------------</span>
<span class="n">tab</span>  <span class="o">=</span> <span class="p">{}</span>                                   <span class="c1">--基表</span>
<span class="n">mtab</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="o">=</span> <span class="mi">3</span><span class="p">}</span>                              <span class="c1">--元表</span>
<span class="n">pmtab</span> <span class="o">=</span> <span class="p">{</span><span class="n">__index</span> <span class="o">=</span> <span class="n">mtab</span><span class="p">}</span>                    <span class="c1">--元表索引◆</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">setmetatable</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">pmtab</span><span class="p">)</span>               <span class="c1">--典型格式：把 mtab 设为 tab(及tb) 的元表</span>
<span class="c1">--tb = setmetatable(tab, {__index={k = 3}}) --另一格式：为 tab(及tb) 设置元表，与上面一样的!（★★注:后面的例子将统一使用典型格式进行表达★★）</span>
<span class="n">print</span><span class="p">(</span><span class="n">pmtab.k</span><span class="p">,</span> <span class="n">mtab.k</span><span class="p">)</span>                      <span class="c1">--打印结果：nil 3 （注：pmtab 是元表索引，没有这个k键，所以是 nil）</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.k</span><span class="p">,</span> <span class="n">mtab.k</span><span class="p">)</span>                         <span class="c1">--打印结果：3   3 （注：基表没有的键都索引到元表，但一旦键有此键时【元方法读写】表现为【读写基表】）</span>
<span class="n">tb.k</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.k</span><span class="p">,</span> <span class="n">mtab.k</span><span class="p">)</span>                         <span class="c1">--打印结果：4   3 （注：基表建有此键后【元方法读写】表现为【读写基表】，因为此时基表已存在这个键，所以不会索引到元表） </span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.k</span><span class="p">,</span> <span class="n">tab.k</span><span class="p">)</span>                          <span class="c1">--打印结果：4   4 （注：tb 与 tab 是等同的）</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----------------</span>
<span class="c1">--『函数初始方式』</span>
<span class="c1">-----------------</span>
<span class="n">index_key2</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>                 <span class="c1">--索引到元表获取（元方法）★★★★★★★★★★★★★★★★★★</span>
	<span class="kr">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&#34;key2&#34;</span> <span class="kr">then</span>                     <span class="c1">--注意：__index 要求函数入口为：(表、键)★★★★★★★★★★★</span>
		<span class="kr">return</span> <span class="s2">&#34;v2&#34;</span>                         <span class="c1">--              要求函数出口为：(键值)  ★★★★★★★★★★★</span>
	<span class="kr">else</span>                                    <span class="c1">--★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★</span>
		<span class="kr">return</span> <span class="kc">nil</span>
	<span class="kr">end</span>
<span class="kr">end</span>
<span class="n">tab</span>  <span class="o">=</span> <span class="p">{</span><span class="n">key1</span> <span class="o">=</span> <span class="s2">&#34;v1&#34;</span><span class="p">}</span>                        <span class="c1">--基表</span>
<span class="n">pmtab</span> <span class="o">=</span> <span class="p">{</span><span class="n">__index</span> <span class="o">=</span> <span class="n">index_key2</span><span class="p">}</span>              <span class="c1">--元表索引◆</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">setmetatable</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">pmtab</span><span class="p">)</span>               <span class="c1">--典型格式：为 tab(及tb) 设置元表</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.key1</span><span class="p">,</span> <span class="n">tb.key2</span><span class="p">)</span>                     <span class="c1">--打印结果：v1  v2 （基表中`tb.key2`还没改写，所以由元方法获取，则值是&#34;v2&#34;）</span>
<span class="n">tb.key1</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">tb.key2</span> <span class="o">=</span> <span class="mi">22</span>                                <span class="c1">--这里对`tb.key2`进行改写，则此时基表创建了这个键，所以不会索引到元表，下面打印的值为&#34;22&#34;</span>
<span class="n">tb.key3</span> <span class="o">=</span> <span class="mi">33</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.key1</span><span class="p">,</span> <span class="n">tb.key2</span><span class="p">,</span> <span class="n">tb.key3</span><span class="p">)</span>            <span class="c1">--打印结果：11  22  33</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>三、<code>__newindex</code>元方法</strong>（基表没有的键的【元方法写(增)】索引到【写(增)元表】，其它情形的【元方法读写】表现为【读写基表】）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----------------</span>
<span class="c1">--『直接修改方式』</span>
<span class="c1">-----------------</span>
<span class="n">tab</span>  <span class="o">=</span> <span class="p">{</span><span class="n">key1</span> <span class="o">=</span> <span class="s2">&#34;v1&#34;</span><span class="p">}</span>                        <span class="c1">--基表</span>
<span class="n">mtab</span> <span class="o">=</span> <span class="p">{</span><span class="n">key1</span> <span class="o">=</span> <span class="s2">&#34;11&#34;</span><span class="p">,</span> <span class="n">key2</span> <span class="o">=</span> <span class="s2">&#34;v2&#34;</span><span class="p">}</span>           <span class="c1">--元表</span>
<span class="n">pmtab</span> <span class="o">=</span> <span class="p">{</span><span class="n">__newindex</span> <span class="o">=</span> <span class="n">mtab</span><span class="p">}</span>                 <span class="c1">--元表索引◆</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">setmetatable</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">pmtab</span><span class="p">)</span>               <span class="c1">--典型格式：把 mtab 设为 tab(及tb) 的元表</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.key1</span><span class="p">,</span> <span class="n">tb.key2</span><span class="p">)</span>                     <span class="c1">--打印结果：v1   nil （注：查询不了元表）</span>
<span class="n">tb.key2</span> <span class="o">=</span> <span class="mi">222</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.key2</span><span class="p">,</span> <span class="n">mtab.key2</span><span class="p">)</span>                   <span class="c1">--打印结果：nil  222 （注：可以修改元表，但不能元方法读取）</span>
<span class="n">tb.key3</span> <span class="o">=</span> <span class="mi">333</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.key3</span><span class="p">,</span> <span class="n">mtab.key3</span><span class="p">)</span>                   <span class="c1">--打印结果：nil  333 （注：可以为元表新增键，但不能元方法读取）</span>
<span class="n">tb.key1</span> <span class="o">=</span> <span class="s2">&#34;v11&#34;</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.key1</span><span class="p">,</span> <span class="n">mtab.key1</span><span class="p">)</span>                   <span class="c1">--打印结果：v11  11</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----------------</span>
<span class="c1">--『函数修改方式』</span>
<span class="c1">-----------------</span>
<span class="n">pmtab</span> <span class="o">=</span> <span class="p">{}</span>                                  <span class="c1">--初始写(增)元表（元方法）★★★★★★★★★★★★★★★★★★</span>
<span class="n">pmtab.__newindex</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>        <span class="c1">--注意：__newindex 要求函数入口为：(表、键、键值) ★★★★★★</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;....run....&#34;</span><span class="p">)</span>                    <span class="c1">--                 要求函数出口为：(可有可无) ★★★★★★★★</span>
	                                        <span class="c1">--★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★</span>
	<span class="n">rawset</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&#34;m-&#34;</span><span class="o">..</span><span class="n">v</span><span class="p">)</span>                   <span class="c1">--绕过元方法限制，为t[k]赋值为v，并可读取，即是可读可写!!!!!!!</span>
<span class="kr">end</span>
<span class="n">tab</span>  <span class="o">=</span> <span class="p">{</span><span class="n">key1</span> <span class="o">=</span> <span class="s2">&#34;v1&#34;</span><span class="p">}</span>                        <span class="c1">--基表</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">setmetatable</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">pmtab</span><span class="p">)</span>               <span class="c1">--典型格式：为 tab(及tb) 设置元表</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.key1</span><span class="p">,</span>  <span class="n">tb.key2</span><span class="p">)</span>                    <span class="c1">--打印结果：v1   nil</span>
<span class="n">tb.key1</span> <span class="o">=</span> <span class="s2">&#34;v11&#34;</span> <span class="n">tb.key2</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.key1</span><span class="p">,</span>  <span class="n">tb.key2</span><span class="p">)</span>                    <span class="c1">--打印结果：v11  m-2 （在元方法里绕过限制，直接新增表键，【初始写(增)基表】时自动加个&#34;m-&#34;前缀）</span>
<span class="n">tb.key1</span> <span class="o">=</span> <span class="s2">&#34;vvv&#34;</span> <span class="n">tb.key2</span> <span class="o">=</span> <span class="mi">222</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.key1</span><span class="p">,</span>  <span class="n">tb.key2</span><span class="p">)</span>                    <span class="c1">--打印结果：vvv  222 （此时基表已存在这个&#39;key2&#39;键，所以第二次及之后就是【读写(增)基表】）</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>四、<code>__index</code> <code>__newindex</code>元方法两个应用案例</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">----------------</span>
<span class="c1">--表只读但不能写</span>
<span class="c1">----------------</span>
<span class="kd">local</span> <span class="kr">function</span> <span class="nf">readOnly</span><span class="p">(</span><span class="n">mtb</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">tb</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="kd">local</span> <span class="n">mt</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">__index</span> <span class="o">=</span> <span class="n">mtb</span><span class="p">,</span>
		<span class="n">__newindex</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>      <span class="c1">--注意入口为 (t, k, v)</span>
			<span class="n">error</span><span class="p">(</span><span class="s2">&#34;别修改我！我是只读的！&#34;</span><span class="p">)</span>
		<span class="kr">end</span>
	<span class="p">}</span>
	<span class="n">setmetatable</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="n">mt</span><span class="p">)</span>
	<span class="kr">return</span> <span class="n">tb</span>
<span class="kr">end</span>
<span class="kd">local</span> <span class="n">week</span> <span class="o">=</span> <span class="n">readOnly</span><span class="p">({</span><span class="s2">&#34;周一&#34;</span><span class="p">,</span> <span class="s2">&#34;周二&#34;</span><span class="p">,</span> <span class="s2">&#34;周三&#34;</span><span class="p">,</span> <span class="s2">&#34;周四&#34;</span><span class="p">,</span> <span class="s2">&#34;周五&#34;</span><span class="p">,</span> <span class="s2">&#34;周六&#34;</span><span class="p">,</span> <span class="s2">&#34;周日&#34;</span><span class="p">});</span>
<span class="n">print</span><span class="p">(</span><span class="n">week</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>                              <span class="c1">--打印结果：周二</span>
<span class="n">week</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;2&#34;</span>                               <span class="c1">--因为表只读，当修改表时会打印出错调试信息，及脚本停止运行</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">----------------</span>
<span class="c1">--同时读写两个表</span>
<span class="c1">----------------</span>
<span class="n">tab</span>  <span class="o">=</span> <span class="p">{</span><span class="n">key1</span> <span class="o">=</span> <span class="s2">&#34;v1&#34;</span><span class="p">}</span>                        <span class="c1">--基表</span>
<span class="n">mtab</span> <span class="o">=</span> <span class="p">{</span><span class="n">key1</span> <span class="o">=</span> <span class="s2">&#34;11&#34;</span><span class="p">,</span> <span class="n">key2</span> <span class="o">=</span> <span class="s2">&#34;v2&#34;</span><span class="p">}</span>           <span class="c1">--元表</span>
<span class="n">pmtab</span> <span class="o">=</span> <span class="p">{</span><span class="n">__index</span> <span class="o">=</span> <span class="n">mtab</span><span class="p">,</span> <span class="n">__newindex</span> <span class="o">=</span> <span class="n">mtab</span><span class="p">}</span> <span class="c1">--元表索引◆</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">setmetatable</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">pmtab</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.key1</span><span class="p">,</span> <span class="n">tb.key2</span><span class="p">)</span>                     <span class="c1">--打印结果：v1  v2</span>
<span class="n">tb.key2</span> <span class="o">=</span> <span class="mi">22</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.key2</span><span class="p">,</span> <span class="n">mtab.key2</span><span class="p">)</span>                   <span class="c1">--打印结果：22  22 （这个表键两个表已关联，则同时修改）</span>
<span class="n">tb.key1</span> <span class="o">=</span> <span class="n">vv</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb.key1</span><span class="p">,</span> <span class="n">mtab.key1</span><span class="p">)</span>                   <span class="c1">--打印结果：vv  11 （这个表键无法关联，只能修改基表）</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>五、<code>rawget(t,k)</code> <code>rawset(t,k,v)</code>绕过<code>__index</code> <code>__newindex</code>元方法的限制</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-------------------------------------------------------------------------------</span>
<span class="c1">--`rawget(t,k)`直接读取【基表】中的实际值，而不索引到元表的`__index`元方法读取。</span>
<span class="c1">-------------------------------------------------------------------------------</span>
<span class="n">xx</span> <span class="o">=</span> <span class="p">{</span><span class="n">k1</span> <span class="o">=</span> <span class="s2">&#34;vv1&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
<span class="kd">local</span> <span class="n">mt</span> <span class="o">=</span> <span class="p">{</span><span class="n">__index</span> <span class="o">=</span> <span class="n">xx</span><span class="p">}</span>
<span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">setmetatable</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mt</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">t.k1</span><span class="p">,</span> <span class="n">rawget</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s2">&#34;k1&#34;</span><span class="p">))</span>                <span class="c1">--打印结果：vv1  nil      （`t.k1`没改写前都是索引到元表值为`vv1`，其实际是`nil`）</span>
<span class="n">t.k1</span> <span class="o">=</span> <span class="mi">111</span>
<span class="n">print</span><span class="p">(</span><span class="n">t.k1</span><span class="p">,</span> <span class="n">rawget</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s2">&#34;k1&#34;</span><span class="p">),</span> <span class="n">xx.k1</span><span class="p">)</span>          <span class="c1">--打印结果：111  111  vv1 （`t.k1`因为已经改写(基表建有这个键)，则不再索引到元表，读写都是自己的键值）</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">------------------------------------------------------------------------------------------</span>
<span class="c1">--`rawset(t,k,v)`直接改写(增)【基表】中的键值，而不索引到元表的`__newindex`元方法改写(增)。</span>
<span class="c1">------------------------------------------------------------------------------------------</span>
<span class="n">xx</span> <span class="o">=</span> <span class="p">{</span><span class="n">k1</span> <span class="o">=</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span> <span class="n">k2</span> <span class="o">=</span> <span class="s2">&#34;v2&#34;</span><span class="p">}</span>
<span class="n">t</span>  <span class="o">=</span> <span class="p">{</span><span class="n">k1</span> <span class="o">=</span> <span class="s2">&#34;11&#34;</span><span class="p">}</span>
<span class="n">mt</span> <span class="o">=</span> <span class="p">{</span><span class="n">__newindex</span> <span class="o">=</span> <span class="n">xx</span><span class="p">}</span>
<span class="n">print</span><span class="p">(</span><span class="n">t.k2</span><span class="p">,</span> <span class="n">xx.k2</span><span class="p">)</span>                          <span class="c1">--打印结果：nil  v2  （没建立元方法前`t.k2`与`xx.k2`的实际值）</span>
<span class="n">setmetatable</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mt</span><span class="p">)</span>
<span class="n">t.k2</span> <span class="o">=</span> <span class="s2">&#34;vv2&#34;</span>
<span class="n">print</span><span class="p">(</span><span class="n">t.k2</span><span class="p">,</span> <span class="n">xx.k2</span><span class="p">)</span>                          <span class="c1">--打印结果：nil  vv2 （元方法改写`t.k2`实际是索引至改写元表`xx.k2`）</span>
<span class="n">rawset</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s2">&#34;k2&#34;</span><span class="p">,</span> <span class="s2">&#34;22&#34;</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">t.k2</span><span class="p">,</span> <span class="n">xx.k2</span><span class="p">)</span>                          <span class="c1">--打印结果：22   vv2 （绕过元方法，直接改写`t.k2`，所以`xx.k2`没变）</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>六、<code>__call</code>元方法</strong>（使用元方法把 table 转化为函数使用）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="n">call_concat</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">,...)</span>               <span class="c1">--表转化为函数（元方法）★★★★★★★★★★★★★★★★★★★</span>
	<span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;(&#34;</span>                           <span class="c1">--补充：__call  要求函数入口为：(表、可变参数)★★★★★★★★</span>
	<span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">({...})</span> <span class="kr">do</span>              <span class="c1">--              要求函数出口为：(可有可无)★★★★★★★★★★</span>
		<span class="kr">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span>                       <span class="c1">--★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★</span>
			<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">..</span><span class="s2">&#34;,&#34;</span>                      <span class="c1">--拼接入口参数为一串字符,使用“,”分隔开</span>
		<span class="kr">end</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">..</span><span class="n">v</span>                            <span class="c1">--拼接入口参数为一串字符</span>
	<span class="kr">end</span>
	<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">..</span><span class="s2">&#34;)&#34;</span>
	<span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="kr">end</span>
<span class="n">tab</span>  <span class="o">=</span> <span class="p">{}</span>                                   <span class="c1">--基表</span>
<span class="n">pmtab</span> <span class="o">=</span> <span class="p">{</span><span class="n">__call</span> <span class="o">=</span> <span class="n">call_concat</span><span class="p">}</span>              <span class="c1">--元表索引◆</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">setmetatable</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">pmtab</span><span class="p">)</span>               <span class="c1">--典型格式：把 mtab 设为 tab(及tb) 的元表</span>
<span class="n">tb</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>                                   <span class="c1">--运行结果：(1,2,3)</span>
<span class="n">tb</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="s2">&#34;b&#34;</span><span class="p">,</span><span class="s2">&#34;c&#34;</span><span class="p">,</span><span class="s2">&#34;d&#34;</span><span class="p">)</span>                         <span class="c1">--运行结果：(a,b,c,d)</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>七、<code>__tostring</code>元方法</strong>（使用元方法把 table 转化为字符串）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">mt</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">mt.__tostring</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>                 <span class="c1">--表转化为字符串（元方法）★★★★★★★★★★★★★★★★★★</span>
	<span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;{&#34;</span>                           <span class="c1">--补充：__tostring  要求函数入口为：(表)★★★★★★★★★★★</span>
	<span class="kr">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>                  <span class="c1">--                  要求函数出口为：(可有可无)★★★★★★★★</span>
		<span class="kr">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span>                       <span class="c1">--★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★</span>
			<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">..</span><span class="s2">&#34;,&#34;</span>                      <span class="c1">--拼接表员键值为一串字符,使用“,”分隔开</span>
		<span class="kr">end</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">..</span><span class="n">v</span>                            <span class="c1">--拼接表员键值为一串字符</span>
	<span class="kr">end</span>
	<span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">..</span><span class="s2">&#34;}&#34;</span>
	<span class="kr">return</span> <span class="n">s</span>
<span class="kr">end</span>
<span class="n">tb</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb</span><span class="p">)</span>                                   <span class="c1">--打印结果：table: 0x24456f0</span>
<span class="n">setmetatable</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="n">mt</span><span class="p">)</span>                        <span class="c1">--将tb的元表设为mt</span>
<span class="n">print</span><span class="p">(</span><span class="n">tb</span><span class="p">)</span>                                   <span class="c1">--打印结果：{1,2,3}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>八、<code>__add</code>元方法</strong>（自定义两个表相加【完全自定义】，只针对数组数据，否则可能会影响结果！）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----------------</span>
<span class="c1">--两个表相加-拼接</span>
<span class="c1">-----------------</span>
<span class="n">add_concat</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">tb1</span><span class="p">,</span> <span class="n">tb2</span><span class="p">)</span>             <span class="c1">--两表拼接操作（元方法）★★★★★★★★★★★★★★★★★★★</span>
	<span class="kd">local</span> <span class="n">temp</span> <span class="o">=</span> <span class="p">{}</span>                         <span class="c1">--补充：__add 要求函数入口为：(表1、表2)★★★★★★★★★★★</span>
	<span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">tb1</span><span class="p">)</span> <span class="kr">do</span>                <span class="c1">--            要求函数出口为：(表)★★★★★★★★★★★★★★</span>
		<span class="n">table.insert</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>                <span class="c1">--★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★</span>
	<span class="kr">end</span>
	<span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">tb2</span><span class="p">)</span> <span class="kr">do</span>                <span class="c1">--pairs()迭代表员（中途遇到任何键值为`nil`都跳过）</span>
		<span class="n">table.insert</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
	<span class="kr">end</span>
	<span class="kr">return</span> <span class="n">temp</span>
<span class="kr">end</span>
<span class="n">tab</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;a&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="s2">&#34;b&#34;</span><span class="p">,</span> <span class="s2">&#34;c&#34;</span><span class="p">}</span>                  <span class="c1">--基表</span>
<span class="n">pmtab</span> <span class="o">=</span> <span class="p">{</span><span class="n">__add</span> <span class="o">=</span> <span class="n">add_concat</span><span class="p">}</span>                <span class="c1">--元表索引◆</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">setmetatable</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">pmtab</span><span class="p">)</span>

<span class="n">tb_n</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;dd&#34;</span><span class="p">,</span> <span class="n">k1</span> <span class="o">=</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span> <span class="s2">&#34;ee&#34;</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="s2">&#34;ff&#34;</span><span class="p">}</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">tb</span> <span class="o">+</span> <span class="n">tb_n</span>                              <span class="c1">--两个表相加!!!!!</span>
<span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;{&#34;</span>
<span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">tb</span><span class="p">)</span> <span class="kr">do</span>
	<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">..</span><span class="n">v</span><span class="o">..</span><span class="s2">&#34;, &#34;</span>                          <span class="c1">--拼接表员键值为一串字符,使用“, ”分隔开</span>
<span class="kr">end</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">..</span><span class="s2">&#34;}&#34;</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&#34;, }&#34;</span><span class="p">,</span> <span class="s2">&#34;}&#34;</span><span class="p">)</span>              <span class="c1">--字符串最后面的“, }”替换为“}”</span>
<span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                                    <span class="c1">--打印结果：{a, b, c, dd, ee, ff, v1}</span>
</code></pre></td></tr></table>
</div>
</div></details>  
<details close=""><summary>8、lua 对象</summary>  
<blockquote>
<p>lua 本身没有类功能，它的类功能是通过元表来实现的。类的函数调用通过 obj:function 方式，但类的成员赋值又是通过 obj.var 方式来实现的。<br>
<a href="https://blog.csdn.net/weicaijiang/article/details/78068079" target="_blank" rel="noopener noreffer">lua 中面向对象实现探索</a>-<a href="https://blog.csdn.net/mywcyfl/article/details/37706085" target="_blank" rel="noopener noreffer">原文</a>、<a href="https://blog.csdn.net/SerenaHaven/article/details/85247990" target="_blank" rel="noopener noreffer">Lua中的面向对象</a></p>
</blockquote>
<p>一、首先要了解一下<code>.</code>与<code>:</code>在表员函数中的应用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">tt</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">}</span>
<span class="c1">--函数定义--</span>
<span class="kr">function</span> <span class="nc">tt</span><span class="p">:</span><span class="nf">func1</span><span class="p">(</span>    <span class="p">)</span> <span class="n">self.b</span> <span class="o">=</span> <span class="mi">5</span> <span class="kr">return</span> <span class="n">self.b</span> <span class="kr">end</span>  <span class="c1">--这两个函数是完成相同的</span>
<span class="kr">function</span> <span class="nc">tt</span><span class="p">.</span><span class="nf">func2</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="n">self.b</span> <span class="o">=</span> <span class="mi">5</span> <span class="kr">return</span> <span class="n">self.b</span> <span class="kr">end</span>  <span class="c1">--这两个函数是完成相同的</span>
<span class="c1">--函数调用--</span>
<span class="n">print</span><span class="p">(</span><span class="n">tt</span><span class="p">:</span><span class="n">func1</span><span class="p">())</span>                                     <span class="c1">--这两个函数调用是相同的，打印结果：5</span>
<span class="n">print</span><span class="p">(</span><span class="n">tt.func2</span><span class="p">(</span><span class="n">tt</span><span class="p">))</span>                                   <span class="c1">--这两个函数调用是相同的，打印结果：5</span>
</code></pre></td></tr></table>
</div>
</div><p>二、coco2d-x coco2d-x 游戏引擎官方给出的 class 实现（<a href="https://cocos2d-x.org/download" target="_blank" rel="noopener noreffer">官方</a>）：<br>
待续……</p>
<ol>
<li>优点：</li>
<li>缺点：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-- Create an class.</span>
<span class="kr">function</span> <span class="nf">class</span><span class="p">(</span><span class="n">classname</span><span class="p">,</span> <span class="n">super</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">superType</span> <span class="o">=</span> <span class="n">type</span><span class="p">(</span><span class="n">super</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">cls</span>

    <span class="kr">if</span> <span class="n">superType</span> <span class="o">~=</span> <span class="s2">&#34;function&#34;</span> <span class="ow">and</span> <span class="n">superType</span> <span class="o">~=</span> <span class="s2">&#34;table&#34;</span> <span class="kr">then</span>
        <span class="n">superType</span> <span class="o">=</span> <span class="kc">nil</span>
        <span class="n">super</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">superType</span> <span class="o">==</span> <span class="s2">&#34;function&#34;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">super</span> <span class="ow">and</span> <span class="n">super.__ctype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="kr">then</span>
        <span class="c1">-- inherited from native C++ Object</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="kr">if</span> <span class="n">superType</span> <span class="o">==</span> <span class="s2">&#34;table&#34;</span> <span class="kr">then</span>
            <span class="c1">-- copy fields from super</span>
            <span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">super</span><span class="p">)</span> <span class="kr">do</span> <span class="n">cls</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="kr">end</span>
            <span class="n">cls.__create</span> <span class="o">=</span> <span class="n">super.__create</span>
            <span class="n">cls.super</span>    <span class="o">=</span> <span class="n">super</span>
        <span class="kr">else</span>
            <span class="n">cls.__create</span> <span class="o">=</span> <span class="n">super</span>
        <span class="kr">end</span>

        <span class="n">cls.ctor</span>    <span class="o">=</span> <span class="kr">function</span><span class="p">()</span> <span class="kr">end</span>
        <span class="n">cls.__cname</span> <span class="o">=</span> <span class="n">classname</span>
        <span class="n">cls.__ctype</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="kr">function</span> <span class="nc">cls</span><span class="p">.</span><span class="nf">new</span><span class="p">(...)</span>
            <span class="kd">local</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">cls.__create</span><span class="p">(...)</span>
            <span class="c1">-- copy fields from class to native object</span>
            <span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span> <span class="kr">do</span> <span class="n">instance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="kr">end</span>
            <span class="n">instance.class</span> <span class="o">=</span> <span class="n">cls</span>
            <span class="n">instance</span><span class="p">:</span><span class="n">ctor</span><span class="p">(...)</span>
            <span class="kr">return</span> <span class="n">instance</span>
        <span class="kr">end</span>

    <span class="kr">else</span>
        <span class="c1">-- inherited from Lua Object</span>
        <span class="kr">if</span> <span class="n">super</span> <span class="kr">then</span>
            <span class="n">cls</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">super</span><span class="p">)</span>
            <span class="n">cls.super</span> <span class="o">=</span> <span class="n">super</span>
        <span class="kr">else</span>
            <span class="n">cls</span> <span class="o">=</span> <span class="p">{</span><span class="n">ctor</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span> <span class="kr">end</span><span class="p">}</span>
        <span class="kr">end</span>

        <span class="n">cls.__cname</span> <span class="o">=</span> <span class="n">classname</span>
        <span class="n">cls.__ctype</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1">-- lua</span>
        <span class="n">cls.__index</span> <span class="o">=</span> <span class="n">cls</span>

        <span class="kr">function</span> <span class="nc">cls</span><span class="p">.</span><span class="nf">new</span><span class="p">(...)</span>
            <span class="kd">local</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">setmetatable</span><span class="p">({},</span> <span class="n">cls</span><span class="p">)</span>
            <span class="n">instance.class</span> <span class="o">=</span> <span class="n">cls</span>
            <span class="n">instance</span><span class="p">:</span><span class="n">ctor</span><span class="p">(...)</span>
            <span class="kr">return</span> <span class="n">instance</span>
        <span class="kr">end</span>
    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">cls</span>
<span class="kr">end</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">---------【使用方法】---------</span>
<span class="c1">--cls = class(&#34;类名&#34;,&#34;父类&#34;) --&gt; 定义一个类 </span>
<span class="c1">--cls:ctor()                 --&gt; 初始化函数，在创建实例的时候会自动调用</span>
<span class="c1">--obj = cls.new()            --&gt; 创建实例</span>

<span class="c1">---------【创建基类】---------</span>
<span class="n">hero</span> <span class="o">=</span> <span class="n">class</span><span class="p">(</span><span class="s2">&#34;hero&#34;</span><span class="p">)</span>         <span class="c1">--定义一个基类</span>

<span class="kr">function</span> <span class="nc">hero</span><span class="p">:</span><span class="nf">ctor</span><span class="p">()</span>         <span class="c1">--重写初始函数</span>
	<span class="n">self.name</span> <span class="o">=</span> <span class="s2">&#34;小明&#34;</span>       <span class="c1">--添加成员</span>
	<span class="n">self.age</span>  <span class="o">=</span> <span class="mi">20</span>           <span class="c1">--添加成员</span>
<span class="kr">end</span>

<span class="n">herox</span> <span class="o">=</span> <span class="n">hero.new</span><span class="p">()</span>           <span class="c1">--创建`hero`类的实例对象</span>

<span class="n">print</span><span class="p">(</span><span class="s2">&#34;name: &#34;</span><span class="o">..</span><span class="n">herox.name</span><span class="p">)</span>  <span class="c1">--打印结果：name: 小明</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;arg : &#34;</span><span class="o">..</span><span class="n">herox.age</span><span class="p">)</span>   <span class="c1">--打印结果：arg : 20</span>

<span class="c1">--具体使用方法参考：https://blog.51cto.com/shahdza/1566513</span>
</code></pre></td></tr></table>
</div>
</div><p>三、云风（吴云洋）大佬给出的 class 实现（<a href="https://blog.codingnow.com/cloud/LuaOO" target="_blank" rel="noopener noreffer">网址</a>）：<br>
待续……</p>
<ol>
<li>优点：</li>
<li>缺点：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">_class</span><span class="o">=</span><span class="p">{}</span>
 
<span class="kr">function</span> <span class="nf">class</span><span class="p">(</span><span class="n">super</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">class_type</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">class_type.ctor</span><span class="o">=</span><span class="kc">false</span>
	<span class="n">class_type.super</span><span class="o">=</span><span class="n">super</span>
	<span class="n">class_type.new</span><span class="o">=</span><span class="kr">function</span><span class="p">(...)</span> 
			<span class="kd">local</span> <span class="n">obj</span><span class="o">=</span><span class="p">{}</span>
			<span class="kr">do</span>
				<span class="kd">local</span> <span class="n">create</span>
				<span class="n">create</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">c</span><span class="p">,...)</span>
					<span class="kr">if</span> <span class="n">c.super</span> <span class="kr">then</span>
						<span class="n">create</span><span class="p">(</span><span class="n">c.super</span><span class="p">,...)</span>
					<span class="kr">end</span>
					<span class="kr">if</span> <span class="n">c.ctor</span> <span class="kr">then</span>
						<span class="n">c.ctor</span><span class="p">(</span><span class="n">obj</span><span class="p">,...)</span>
					<span class="kr">end</span>
				<span class="kr">end</span>
 
				<span class="n">create</span><span class="p">(</span><span class="n">class_type</span><span class="p">,...)</span>
			<span class="kr">end</span>
			<span class="n">setmetatable</span><span class="p">(</span><span class="n">obj</span><span class="p">,{</span> <span class="n">__index</span><span class="o">=</span><span class="n">_class</span><span class="p">[</span><span class="n">class_type</span><span class="p">]</span> <span class="p">})</span>
			<span class="kr">return</span> <span class="n">obj</span>
		<span class="kr">end</span>
	<span class="kd">local</span> <span class="n">vtbl</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">_class</span><span class="p">[</span><span class="n">class_type</span><span class="p">]</span><span class="o">=</span><span class="n">vtbl</span>
 
	<span class="n">setmetatable</span><span class="p">(</span><span class="n">class_type</span><span class="p">,{</span><span class="n">__newindex</span><span class="o">=</span>
		<span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
			<span class="n">vtbl</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">v</span>
		<span class="kr">end</span>
	<span class="p">})</span>
 
	<span class="kr">if</span> <span class="n">super</span> <span class="kr">then</span>
		<span class="n">setmetatable</span><span class="p">(</span><span class="n">vtbl</span><span class="p">,{</span><span class="n">__index</span><span class="o">=</span>
			<span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
				<span class="kd">local</span> <span class="n">ret</span><span class="o">=</span><span class="n">_class</span><span class="p">[</span><span class="n">super</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
				<span class="n">vtbl</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">ret</span>
				<span class="kr">return</span> <span class="n">ret</span>
			<span class="kr">end</span>
		<span class="p">})</span>
	<span class="kr">end</span>
 
	<span class="kr">return</span> <span class="n">class_type</span>
<span class="kr">end</span>
</code></pre></td></tr></table>
</div>
</div></details>  
<details close=""><summary>9、lua 协程</summary>  
<blockquote>
<p><strong>线程（thread /θred/）：</strong>一个 CPU 同一时刻只能运行一段代码，但利用线程技术实现表面上看多个线程为同时执行，表象上实现并发技术，它由操作系统后台根据相应算法以隐性的方式进行切换调度。<br>
<strong>协程（coroutine /&lsquo;kəʊruːˌtiːn/）：</strong>协程的一段代码完全由主程序触发才运行，运行后再通知主程序；下一段代码以相同规则运行及通知，如此类推运行多段的代码。如果主程序根据自已的应用要求以显性的方式切换调度多个协程多段代码运行，就相当于实现了多协程并发运行。这种方式的协程以固定的调度方式并发运行，而线程则是以不确定（随机）的调度方式并发运行！<br>
关于协程参考网文：<a href="https://blog.csdn.net/mango9126/article/details/79292466" target="_blank" rel="noopener noreffer">Lua中的协程Coroutine</a></p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:left"><div style="width:144px">协程函数</div></th>
<th style="text-align:left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">coroutine.create()</td>
<td style="text-align:left">将某函数创建为一个协程</td>
</tr>
<tr>
<td style="text-align:left">coroutine.resume()</td>
<td style="text-align:left">主程序触发协程运行一段代码</td>
</tr>
<tr>
<td style="text-align:left">coroutine.yield()</td>
<td style="text-align:left">协程运行一段代码后通知主程序</td>
</tr>
<tr>
<td style="text-align:left">coroutine.status()</td>
<td style="text-align:left">查看指定协程的状态：dead（死亡），suspended（挂起），running（运行）</td>
</tr>
<tr>
<td style="text-align:left">coroutine.running()</td>
<td style="text-align:left">判断当前代码是否由主程序运行：true（主程序运行），false（协程运行）</td>
</tr>
<tr>
<td style="text-align:left">coroutine.wrap ()</td>
<td style="text-align:left">同<code>coroutine.create()</code>，但其返回是一个操作函数来代替<code>coroutine.resume()</code>的使用，它并不是在保护模式下执行的，若执行崩溃会直接向外抛出</td>
</tr>
</tbody>
</table>
<p>协程的创建、触发与通知相关执行逻辑及参数传递：<br>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="../img/20211221_02_08_01.jpg"
        data-srcset="../img/20211221_02_08_01.jpg, ../img/20211221_02_08_01.jpg 1.5x, ../img/20211221_02_08_01.jpg 2x"
        data-sizes="auto"
        alt="../img/20211221_02_08_01.jpg"
        title="协程逻辑" /><br>
注：status 值主要为 true、false（出错）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">----------------</span>
<span class="c1">--单个协程的运行</span>
<span class="c1">----------------</span>
<span class="n">co</span> <span class="o">=</span> <span class="n">coroutine.create</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">in1</span><span class="p">,</span> <span class="n">in11</span><span class="p">)</span>                               <span class="c1">--将某函数创建为一个协程:co</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;1.coroutine  in:&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="n">in1</span><span class="p">,</span> <span class="n">in11</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">in2</span><span class="p">,</span> <span class="n">in22</span><span class="p">,</span> <span class="n">in222</span> <span class="o">=</span> <span class="n">coroutine.yield</span><span class="p">(</span><span class="s2">&#34;out1&#34;</span><span class="p">,</span> <span class="s2">&#34;out11&#34;</span><span class="p">)</span>           <span class="c1">--协程运行第&lt;1&gt;段代码后通知主程序</span>

	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;2.coroutine  in:&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="n">in2</span><span class="p">,</span> <span class="n">in22</span><span class="p">,</span> <span class="n">in222</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">in3</span><span class="p">,</span> <span class="n">in33</span>         <span class="o">=</span> <span class="n">coroutine.yield</span><span class="p">(</span><span class="s2">&#34;out2&#34;</span><span class="p">,</span> <span class="s2">&#34;out22&#34;</span><span class="p">)</span>          <span class="c1">--协程运行第&lt;2&gt;段代码后通知主程序</span>

	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;3.coroutine  in:&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="n">in3</span><span class="p">,</span> <span class="n">in33</span><span class="p">)</span>
	<span class="kr">return</span> <span class="s2">&#34;out3&#34;</span><span class="p">,</span> <span class="s2">&#34;out33&#34;</span><span class="p">,</span> <span class="s2">&#34;out333333&#34;</span>                                 <span class="c1">--协程运行第&lt;3&gt;段代码后通知主程序</span>
<span class="kr">end</span><span class="p">)</span>

<span class="n">print</span><span class="p">(</span><span class="s2">&#34;1.coroutine out:&#34;</span><span class="p">,</span> <span class="n">coroutine.resume</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="s2">&#34;in1&#34;</span><span class="p">,</span> <span class="s2">&#34;in11&#34;</span><span class="p">))</span>          <span class="c1">--主程序触发协程运行一段代码</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;------------------------------------------------------------&#34;</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;2.coroutine out:&#34;</span><span class="p">,</span> <span class="n">coroutine.resume</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="s2">&#34;in2&#34;</span><span class="p">,</span> <span class="s2">&#34;in22&#34;</span><span class="p">,</span> <span class="s2">&#34;in222&#34;</span><span class="p">))</span> <span class="c1">--主程序触发协程运行一段代码</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;------------------------------------------------------------&#34;</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;3.coroutine out:&#34;</span><span class="p">,</span> <span class="n">coroutine.resume</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="s2">&#34;in3&#34;</span><span class="p">))</span>                  <span class="c1">--主程序触发协程运行一段代码</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;------------------------------------------------------------&#34;</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;4.coroutine out:&#34;</span><span class="p">,</span> <span class="n">coroutine.resume</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="s2">&#34;in4&#34;</span><span class="p">))</span>                  <span class="c1">--主程序触发协程运行一段代码</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;------------------------------------------------------------&#34;</span><span class="p">)</span>

<span class="cm">--[[ 打印结果：
</span><span class="cm">1.coroutine  in:            in1     in11
</span><span class="cm">1.coroutine out:    true    out1    out11
</span><span class="cm">------------------------------------------------------------
</span><span class="cm">2.coroutine  in:            in2     in22     in222
</span><span class="cm">2.coroutine out:    true    out2    out22
</span><span class="cm">------------------------------------------------------------
</span><span class="cm">3.coroutine  in:            in3     nil                      --&gt;注释：第三次触发时，只传递了一个参数，所以协程获取第二个参数为nil
</span><span class="cm">3.coroutine out:    true    out3    out33    out333333
</span><span class="cm">------------------------------------------------------------
</span><span class="cm">4.coroutine out:    false   cannot resume dead coroutine     --&gt;注释：协同程序已退出，所以 coroutine.resume() 返回 false
</span><span class="cm">------------------------------------------------------------
</span><span class="cm">--]]</span>
</code></pre></td></tr></table>
</div>
</div></details>  
<details close=""><summary>10、lua 之 table 库</summary>  
<blockquote>
<p><strong>一、操作函数：</strong></p>
</blockquote>
<p><strong>说明一</strong>、关于<code>table.xxxx()</code>的操作，要求表中元素不应有<code>nil</code>的〖组员〗存在，否则会出错！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="n">array</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">=</span><span class="s2">&#34;fff&#34;</span><span class="p">,</span> <span class="s2">&#34;bbb&#34;</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">nil</span><span class="p">,</span> <span class="s2">&#34;aaa&#34;</span><span class="p">}</span>
<span class="o">#</span><span class="n">array</span>                                    <span class="c1">--【计算】计算表(array)中组员个数，但如果存在`nil`的组员，计算会可能出错！！！！！</span>
<span class="n">table.remove</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="p">])</span>                  <span class="c1">--【移除】从数组移除组员。扩展参数[n]表示第几个组员位置(不写时表示移除最后一个组员)</span>
<span class="n">table.insert</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>           <span class="c1">--【插入】向数组插入组员。扩展参数[n]表示第几个组员位置(不写时表示在尾组员后面插入)</span>
<span class="n">table.sort</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>                         <span class="c1">--【排序】排序所有的组员。注意：不支持对存在组员为`nil`的数组操作</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">table.concat</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;sc&#34;</span><span class="p">],</span> <span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="p">[</span><span class="n">m</span><span class="p">])</span> <span class="c1">--【连接】截取并连接组员。扩展参数[sc]表示插入相隔字符，[n]指定起始组员(不写时表全部组员)，[m]指定结束组员(不写时表最后一个组员)</span>

<span class="c1">--rawset(array,k,v)                       --更改表中指定键对应的值，返回表的指针        （类同：array[k] = v）</span>
<span class="c1">--rawget(array,k)                         --获取表中指定键对应的值，当键不存在时返回`nil`（类同：v = array[k]）</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>二、应用例子：</strong></p>
</blockquote>
<p><strong>说明二</strong>、所有的<code>table.xxxx()</code>函数只针对〖组员〗的操作，但不会影响也不受【表员】影响！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----【数组操作】-----</span>
<span class="n">array</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">=</span><span class="s2">&#34;fff&#34;</span><span class="p">,</span> <span class="s2">&#34;ccc&#34;</span><span class="p">,</span> <span class="s2">&#34;bbb&#34;</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">nil</span><span class="p">,</span> <span class="s2">&#34;aaa&#34;</span><span class="p">}</span>

<span class="c1">--连接--</span>
<span class="n">print</span><span class="p">(</span><span class="n">table.concat</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>               <span class="c1">--打印所【连接】的组员：cccbbbaaa   （截取所有组员）</span>
<span class="n">print</span><span class="p">(</span><span class="n">table.concat</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">))</span>           <span class="c1">--打印所【连接】的组员：ccc,bbb,aaa （截取所有组员,使用逗号隔开）</span>
<span class="n">print</span><span class="p">(</span><span class="n">table.concat</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>         <span class="c1">--打印所【连接】的组员：bbb,aaa     （截取第2到最后一个组号,使用逗号隔开）</span>
<span class="n">print</span><span class="p">(</span><span class="n">table.concat</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="s2">&#34;, &#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>      <span class="c1">--打印所【连接】的组员：bbb, aaa    （截取第2到3个组号,使用逗号+空格隔开）</span>

<span class="c1">--排序--</span>
<span class="n">table.sort</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>                        <span class="c1">--对所有组员【排序】</span>
<span class="n">print</span><span class="p">(</span><span class="n">table.concat</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">))</span>           <span class="c1">--打印操作后的所有组员：aaa,bbb,ccc （截取所有组员,使用逗号隔开）</span>

<span class="c1">--插入--</span>
<span class="n">table.insert</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="s2">&#34;ddd&#34;</span><span class="p">)</span>                <span class="c1">--在其尾部【插入】组员</span>
<span class="n">print</span><span class="p">(</span><span class="n">table.concat</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">))</span>           <span class="c1">--打印操作后的所有组员：aaa,bbb,ccc,ddd</span>
<span class="n">table.insert</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s2">&#34;zzz&#34;</span><span class="p">)</span>              <span class="c1">--指定位置【插入】组员              （★一般可选参数靠右,而本函数在中间!★）</span>
<span class="n">print</span><span class="p">(</span><span class="n">table.concat</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">))</span>           <span class="c1">--打印操作后的所有组员：aaa,zzz,bbb,ccc,ddd</span>
<span class="c1">--table.insert(tab2, 2, {&#34;11&#34;, 22})      --二维数组插入例子：在第二行插入一行的内容 {&#34;11&#34;, 22}</span>
<span class="c1">--table.insert(tab2[1], 2, &#34;aa&#34;)         --二维数组插入例子：在第一行第二列插入内容 &#34;aa&#34;</span>

<span class="c1">--移除--</span>
<span class="n">table.remove</span> <span class="p">(</span><span class="n">array</span><span class="p">)</span>                     <span class="c1">--在其尾部【移除】组员</span>
<span class="n">print</span><span class="p">(</span><span class="n">table.concat</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">))</span>           <span class="c1">--打印操作后的所有组员：aaa,zzz,bbb,ccc</span>
<span class="n">table.remove</span> <span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>                   <span class="c1">--指定位置【移除】组员</span>
<span class="n">print</span><span class="p">(</span><span class="n">table.concat</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">))</span>           <span class="c1">--打印操作后的所有组员：aaa,bbb,ccc</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>说明三</strong>、关于我对【表员】和〖组员〗的定义：有或无《键名》的元素都称为【表员】，没有《键名》的元素称为〖组员〗。关于数组与表区别：数组其实就是一个有序的表。两个重要迭代函数如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="n">tab</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="s2">&#34;a&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="kc">nil</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&#34;c&#34;</span><span class="p">}</span>

<span class="c1">---〖组员迭代函数〗---</span>
<span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">ipairs</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span> <span class="kr">do</span>                <span class="c1">--ipairs()迭代组员（中途遇到组员值为`nil`立即结束）</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;k=&#34;</span><span class="o">..</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>                    <span class="c1">--打印结果：k=1  1</span>
<span class="kr">end</span>                                      <span class="c1">--打印结果：k=2  2</span>
                                         <span class="c1">--打印结果：k=3  3</span>
<span class="c1">---【表员迭代函数】---                   </span>
<span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span> <span class="kr">do</span>                 <span class="c1">--pairs()迭代表员（中途遇到任何键值为`nil`都跳过）</span>
    <span class="n">print</span><span class="p">(</span><span class="s2">&#34;k=&#34;</span><span class="o">..</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>                    <span class="c1">--打印结果：k=1  1</span>
<span class="kr">end</span>                                      <span class="c1">--打印结果：k=2  2</span>
                                         <span class="c1">--打印结果：k=3  3</span>
                                         <span class="c1">--打印结果：k=5  4</span>
                                         <span class="c1">--打印结果：k=c  c</span>
                                         <span class="c1">--打印结果：k=a  a</span>
<span class="c1">---【表转为字符串】--- </span>
<span class="kr">function</span> <span class="nf">tab_to_string</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;{&#34;</span>
	<span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span> <span class="kr">do</span>             <span class="c1">--使用【表员】迭代器（中途遇到任何键值为`nil`都跳过）</span>
		<span class="kr">if</span> <span class="n">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;number&#34;</span> <span class="kr">then</span>
			<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">..</span><span class="n">v</span>                     <span class="c1">--拼接〖组员〗的键值为一串字符</span>
		<span class="kr">else</span>
			<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">..</span><span class="n">k</span><span class="o">..</span><span class="s2">&#34;=&#34;</span><span class="o">..</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">..</span><span class="n">v</span><span class="o">..</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">&#34;</span> <span class="c1">--拼接【表员】及键值为一串字符</span>
		<span class="kr">end</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">..</span><span class="s2">&#34;,&#34;</span>                       <span class="c1">--每个元素使用“,”分隔开</span>
	<span class="kr">end</span>
	<span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">..</span><span class="s2">&#34;}&#34;</span>
	<span class="n">s</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&#34;,}&#34;</span><span class="p">,</span> <span class="s2">&#34;}&#34;</span><span class="p">)</span>        <span class="c1">--去掉最后一个元素后面的“,”号</span>
	<span class="kr">return</span> <span class="n">s</span>
<span class="kr">end</span>

<span class="n">print</span><span class="p">(</span><span class="n">tab_to_string</span><span class="p">(</span><span class="n">tab</span><span class="p">))</span>                <span class="c1">--打印结果：{1,2,3,4,a=&#34;a&#34;,c=&#34;c&#34;}</span>
</code></pre></td></tr></table>
</div>
</div></details>  
<details close=""><summary>11、lua 之 string 库</summary>  
<blockquote>
<p><strong>一、基本语法：</strong></p>
</blockquote>
<p><strong>说明一</strong>、字符串语法包括<code>&quot;&quot;</code> <code>''</code> <code>[[]]</code>，其中<code>[[]]</code>中书写的特殊字符不需要转义。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-----【字符串】-------</span>
<span class="n">s</span> <span class="o">=</span> <span class="s">[[a\\\&#34;\&#39;[[b]c]]</span>            <span class="c1">--多行字符串：其语法不支持转义符，不支持连续多个“]”字符，但支持单个或隔开的“]”字符。</span>
<span class="n">string1</span> <span class="o">=</span> <span class="s2">&#34;Lua&#34;</span>                 <span class="c1">--单行字符串：&#34;&#34;  （注：&#34;&#34; 与 &#39;&#39; 没本质区别）</span>
<span class="n">string2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&#34;</span><span class="s1">runoob.com</span><span class="se">\&#34;</span><span class="s1">&#39;</span>      <span class="c1">--单行字符串：&#39;&#39;  （注：&#34;&#34; 与 &#39;&#39; 没本质区别）</span>
<span class="n">string3</span> <span class="o">=</span>                       <span class="c1">--多行字符串：[[]]（注：[[ 后可直接换行，不算入多行字符串的回车或换行！）</span>
<span class="s">[[
</span><span class="s">&#34;Lua
</span><span class="s">Script&#34;
</span><span class="s">]]</span>

<span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                        <span class="c1">--打印的信息为：a\\\&#34;\&#39;[[b]c（本例为了说明[[]]内特殊字符不需要书写转义符）</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;string1&#34;</span>    <span class="o">..</span> <span class="n">string1</span><span class="p">)</span>  <span class="c1">--打印的信息为：string1Lua  （使用 .. 拼接功能）</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">string1:</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">string1</span><span class="p">)</span>  <span class="c1">--打印的信息为：&#34;string1:&#34;  Lua</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;string2:&#34;</span>    <span class="p">,</span> <span class="n">string2</span><span class="p">)</span>  <span class="c1">--打印的信息为：string2:    runoob.com</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;string3:&#34;</span>    <span class="p">,</span> <span class="n">string3</span><span class="p">)</span>  <span class="c1">--打印的信息为：string3:    &#34;Lua</span>
                                <span class="c1">--　　　　　　　Script&#34;</span>
                                <span class="c1">--　　　　　　 （空行）</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>二、操作函数：</strong></p>
</blockquote>
<p><strong>说明二</strong>、字符操作包括 转换、查找、截取、替换、格式化。其中<code>string.find()</code>和<code>string.match()</code>两函数会返回<code>nil</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">--字符串相关转换--</span>
<span class="n">string.len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                   <span class="c1">--字符串(s)的长度</span>
<span class="n">string.rep</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>                <span class="c1">--字符串(s)重复(n)复制</span>
<span class="n">string.upper</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                 <span class="c1">--字符串(s)转换为大写</span>
<span class="n">string.lower</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                 <span class="c1">--字符串(s)转换为小写</span>
<span class="n">string.reverse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>               <span class="c1">--字符串(s)左右反转</span>
<span class="n">string.byte</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="n">j</span><span class="p">])</span>        <span class="c1">--字符串(s)转换为数值，默认转换第一个字符。可扩展参数[i]或[i][j]，没写[i]默认为`1`，没写[j]默认等于[i]</span>
<span class="n">string.char</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span> <span class="p">[</span><span class="n">num2</span><span class="p">],...)</span>   <span class="c1">--数值(num)转换为字符，单数值范围(0~255)，可多个数值(num2,num3,...)</span>
<span class="n">string.dump</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="p">[</span><span class="n">strip</span><span class="p">])</span>        <span class="c1">--动态方式将函数(fn)代码打包为二进制格式并另存为文件(lua代码块)，需要文件操作函数 io.write() 保存文件 和 io.read() 读取文件配合，</span>
                                <span class="c1">--将读取到文件的内容通过 load() 恢复为函数(变量)，也可使用 loadfile(filename) 一步读出并恢复，恢复后得到函数句柄就可以操作此函数了。应用场景一般为向另一台设备传送操作函数。</span>
<span class="c1">--字符串位置查找--</span>
<span class="n">string.find</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="n">j</span><span class="p">])</span>    <span class="c1">--在字符串(s)中查找(ws)，返回(ws)的头个和尾个字符位置(否则为`nil`)，默认转换全部字符。可扩展参数[i]或[i][j]为查找(s)的开始与结束位置，没写[i]默认为`1`，没写[j]默认`-1`</span>
                                <span class="c1">--例：print(string.find(&#34;aa bb ca b&#34;, &#34;a b&#34;)) 结果：2  4     （解析：在字符串中查找第一个&#34;a b&#34;所在位置）</span>
<span class="c1">--字符串位置截取--</span>
<span class="n">string.sub</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="n">j</span><span class="p">])</span>           <span class="c1">--在字符串(s)中截取，返回截取的字符串(否则为空&#34;&#34;)，默认从(i)开始截取全部。可扩展参数[j]，没写[j]默认`-1`。高级应用:(i)还可以是通配符。</span>
                                <span class="c1">--例：print(string.sub(&#34;www.163.com&#34;, 4, -1)) 结果：.163.com （解析：从字符串第4个字符开始截取后面全部字符）</span>
<span class="c1">--字符串查找替换--</span>
<span class="n">string.gsub</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="p">[</span><span class="n">max</span><span class="p">])</span>   <span class="c1">--字符串(s)中的(ws)替换为(zs)，返回替换后字符串，默认全部替换。可扩展参数[max]为最多替换次数，没写[max]全部替换</span>
                                <span class="c1">--例：print(string.gsub(&#34;lua!aul&#34;,&#34;%a&#34; ,&#34;=&#34;)) 结果：===!===  （解析：将字符串中字母替换为&#39;=&#39;符号）</span>
<span class="c1">--字符串查找截取--</span>
<span class="n">string.match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span>        <span class="c1">--在字符串(s)中查找截取(ws)，返回截取的字符串(否则为`nil`)，默认查找全部。可扩展参数[i]为从(s)第几个字符开始查，没写[i]默认`1`</span>
                                <span class="c1">--例：print(string.match(&#34;ab.txt&#34;, &#34;%.%w+$&#34;)) 结果：.txt     （解析：截取字符中结尾为扩展名的扩展名字段）</span>
<span class="c1">--字符串迭代截取--</span>
<span class="n">string.gmatch</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ws</span><span class="p">)</span>            <span class="c1">--字符串(s)中迭代查找截取(ws)，需要 for 循环语句配合</span>
                                <span class="c1">--例：for s in string.gmatch(&#34;a,b c&#34;, &#34;%a+&#34;) do print(s) end （解析：类似 match()，只是查到第一个后，可接续查第二个……）</span>
<span class="c1">--字符格式化转换--</span>
<span class="n">string.format</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="p">[</span><span class="n">s2</span><span class="p">],...)</span> <span class="c1">--字符串(fs)格式化，(s1)第一个格式化值（可数字可字符(串)）。可扩展参数[s2]……，第二个……格式化值</span>
                                <span class="c1">--例：print(string.format(&#34;%5.3s&#34;, &#34;monday&#34;))  结果：  mon   （解析：截取前面3个字符并以5位右对齐方式显示）</span>
<span class="err">特别备注：</span>
<span class="n">s</span><span class="p">:</span>  <span class="err">为普通字符串</span> <span class="o">+</span> <span class="err">转义符</span><span class="p">(</span><span class="err">\\</span><span class="p">,</span> <span class="err">\</span><span class="s1">&#39;, </span><span class="se">\&#34;</span><span class="s1">)
</span><span class="s1">ws: 为普通字符串 + 通配符 + 转义符(</span><span class="se">\\</span><span class="s1">, </span><span class="se">\&#39;</span><span class="s1">, </span><span class="se">\&#34;</span><span class="s1">, %(, %), %[, %], %%, %$, %^, %., %?, %*, %+, %-)
</span><span class="s1">fs: 为普通字符串 + 格式符 + 转义符(</span><span class="se">\\</span><span class="s1">, </span><span class="se">\&#39;</span><span class="s1">, </span><span class="se">\&#34;</span><span class="s1">, %%)
</span><span class="s1">zs: 为普通字符串 + 捕获符 + 转义符(</span><span class="se">\\</span><span class="s1">, </span><span class="se">\&#39;</span><span class="s1">, </span><span class="se">\&#34;</span><span class="s1">, %%)（备注：为什么有 %% 转义，因为 %1 代表第一个捕获物，%2…）
</span><span class="s1">
</span><span class="s1">特别注释：
</span><span class="s1">如果普通字符串变量用到通配字符串或格式化字符串的函数参数中时，
</span><span class="s1">必须自行编写处理函数对几个特殊字符增加转义符（如：`%`转义是`%%`），
</span><span class="s1">例如编写函数：`string_ss_to_ws(ss)`和`string_ss_to_fs(ss)`
</span></code></pre></td></tr></table>
</div>
</div><details close=""><summary>──点击展开例子──</summary>  
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">--字符串转换--</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;163.&#34;</span><span class="o">..</span><span class="s2">&#34;com&#34;</span><span class="p">)</span>                     <span class="c1">--打印的结果：163.com     （--字符串【拼接】--）</span>
<span class="n">print</span><span class="p">(</span><span class="s2">&#34;163.&#34;</span><span class="p">,</span> <span class="s2">&#34;com&#34;</span><span class="p">)</span>                     <span class="c1">--打印的结果：163.   com  （--字符串【拼接】--）（使用Tab分隔）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.len</span><span class="p">(</span><span class="s2">&#34;abc&#34;</span><span class="p">))</span>                 <span class="c1">--打印的结果：3           （--字符串【长度】--）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.upper</span><span class="p">(</span><span class="s2">&#34;Lua abC&#34;</span><span class="p">))</span>           <span class="c1">--打印的结果：LUA ABC     （--转换为【大写】--）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.lower</span><span class="p">(</span><span class="s2">&#34;Lua abC&#34;</span><span class="p">))</span>           <span class="c1">--打印的结果：lua abc     （--转换为【小写】--）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.reverse</span><span class="p">(</span><span class="s2">&#34;Lua&#34;</span><span class="p">))</span>             <span class="c1">--打印的结果：auL         （--字符串【反转】--）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.char</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>         <span class="c1">--打印的结果：abcd        （--[数值]转[字符]--）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.byte</span><span class="p">(</span><span class="s2">&#34;abcd&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>          <span class="c1">--打印的结果：97,98,99,100（--[字符]转[数值]--）（转换全部的字符）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.byte</span><span class="p">(</span><span class="s2">&#34;abcd&#34;</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>             <span class="c1">--打印的结果：100         （--[字符]转[数值]--）（转换第四个字符）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.byte</span><span class="p">(</span><span class="s2">&#34;abcd&#34;</span><span class="p">))</span>               <span class="c1">--打印的结果：97          （--[字符]转[数值]--）（转换第一个字符）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.rep</span><span class="p">(</span><span class="s2">&#34;abcd&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>              <span class="c1">--打印的结果：abcdabcd    （--字符串【拷贝】--）（拷贝两次）</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">--字符串查找--</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.find</span><span class="p">(</span><span class="s2">&#34;hello lua Lua is Lua&#34;</span><span class="p">,</span> <span class="s2">&#34;Lua&#34;</span><span class="p">))</span>        <span class="c1">--打印的结果：11  13 （整块字符串查找，返回查找字符串位置-起始及结束位置(注：换行符或回车符也计入位置)）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.find</span><span class="p">(</span><span class="s2">&#34;hello lua Lua is Lua&#34;</span><span class="p">,</span> <span class="s2">&#34;Lua&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="c1">--打印的结果：11  13 （同上）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.find</span><span class="p">(</span><span class="s2">&#34;hello lua Lua is Lua&#34;</span><span class="p">,</span> <span class="s2">&#34;Lua&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>     <span class="c1">--打印的结果：11  13 （同上）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.find</span><span class="p">(</span><span class="s2">&#34;hello lua Lua is Lua&#34;</span><span class="p">,</span> <span class="s2">&#34;Lua&#34;</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>    <span class="c1">--打印的结果：18  20 （从第14个字符开始查找整块字符串，返回查找字符串位置-起始及结束位置）</span>

<span class="c1">--字符串截取--</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.sub</span><span class="p">(</span><span class="s2">&#34;www.163.com&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>     <span class="c1">--打印的结果：.163.   （--字符串【截取】--）（截取第4~8个字符）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.sub</span><span class="p">(</span><span class="s2">&#34;www.163.com&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>    <span class="c1">--打印的结果：.163.com（--字符串【截取】--）（截取第4~最后个字符）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.sub</span><span class="p">(</span><span class="s2">&#34;www.163.com&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>        <span class="c1">--打印的结果：.163.com（同上）</span>

<span class="n">tb</span> <span class="o">=</span> <span class="s2">&#34;Today is 11/28/2021 abc&#34;</span>
<span class="n">s</span><span class="p">,</span><span class="n">e</span> <span class="o">=</span> <span class="n">string.find</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span><span class="s2">&#34;%d%d/%d%d/%d%d%d%d&#34;</span><span class="p">)</span> <span class="c1">--查找日期格式字符串，送到变量 s,e</span>
<span class="kr">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span> <span class="kr">then</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;return nil&#34;</span><span class="p">)</span>                    <span class="c1">--注意：查找不到时，不能【截取】操作，否则 lua 运行抛出异常!!!</span>
<span class="kr">else</span>
	<span class="n">print</span><span class="p">(</span><span class="n">string.sub</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>            <span class="c1">--打印的结果：11/28/2021</span>
<span class="kr">end</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">--字符串查找替换--</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;abc%abc&#34;</span><span class="p">,</span> <span class="s2">&#34;%%&#34;</span><span class="p">,</span> <span class="s2">&#34;%%z&#34;</span><span class="p">))</span> <span class="c1">--打印的结果：abc%zabc   1 （结果为&#34;%&#34;替换为&#34;%z&#34;后字符串，及替换了1次）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;aAaaa&#34;</span><span class="p">,</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="s2">&#34;z&#34;</span><span class="p">));</span>       <span class="c1">--打印的结果：zAzzz  4     （结果为&#34;a&#34;替换为&#34;z&#34; 后字符串，及替换了4次）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;aAaaa&#34;</span><span class="p">,</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="s2">&#34;z&#34;</span><span class="p">,</span><span class="mi">3</span><span class="p">));</span>     <span class="c1">--打印的结果：zAzza  3     （结果为&#34;a&#34;替换为&#34;z&#34; 后字符串，及替换了3次）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;o, 2-Lua!&#34;</span><span class="p">,</span> <span class="s2">&#34;%A&#34;</span><span class="p">,</span> <span class="s2">&#34;.&#34;</span><span class="p">))</span> <span class="c1">--打印的结果：o....Lua.  5 （结果为&#34;非字母&#34;替换为&#34;.&#34;后字符串，及替换了5次）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;o, 2-Lua!&#34;</span><span class="p">,</span> <span class="s2">&#34;.&#34;</span><span class="p">,</span> <span class="s2">&#34;a&#34;</span><span class="p">))</span>  <span class="c1">--打印的结果：aaaaaaaaa  9 （任意字符替换为&#34;a&#34;后字符串，及替换了9次）</span>

<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;hello!lua&#34;</span><span class="p">,</span><span class="s2">&#34;%a&#34;</span> <span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span>  <span class="c1">--打印的结果：=====!===            8 （优先匹配 1 个字母）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;hello!lua&#34;</span><span class="p">,</span><span class="s2">&#34;%a?&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span>  <span class="c1">--打印的结果：=====!===            8 （从左到右优先匹配  1 个，否则最后匹配  0 个）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;hello!lua&#34;</span><span class="p">,</span><span class="s2">&#34;%a+&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span>  <span class="c1">--打印的结果：=!=                  2 （从左到右优先匹配最多个，否则最后匹配  1 个）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;hello!lua&#34;</span><span class="p">,</span><span class="s2">&#34;%a*&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span>  <span class="c1">--打印的结果：=!=                  2 （从左到右优先匹配最多个，否则最后匹配  0 个）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;hello!lua&#34;</span><span class="p">,</span><span class="s2">&#34;%a-&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span>  <span class="c1">--打印的结果：=h=e=l=l=o=!=l=u=a=  10（从左到右优先匹配  0 个，否则尽量匹配最少个）&lt;- 不合常规的用法,实际不要这样用</span>

<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;a()b(c)d(ef)g((hij))&#34;</span><span class="p">,</span><span class="s2">&#34;%(%a?%)&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span> <span class="c1">--打印的结果：a=b=d(ef)g((hij))  2 （从左到右优先匹配  1 个，否则最后匹配  0 个）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;a()b(c)d(ef)g((hij))&#34;</span><span class="p">,</span><span class="s2">&#34;%(%a+%)&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span> <span class="c1">--打印的结果：a()b=d=g(=)        3 （从左到右优先匹配最多个，否则最后匹配  1 个）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;a()b(c)d(ef)g((hij))&#34;</span><span class="p">,</span><span class="s2">&#34;%(%a*%)&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span> <span class="c1">--打印的结果：a=b=d=g(=)         4 （从左到右优先匹配最多个，否则最后匹配  0 个）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;a()b(c)d(ef)g((hij))&#34;</span><span class="p">,</span><span class="s2">&#34;%(%a-%)&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span> <span class="c1">--打印的结果：a=b=d=g(=)         4 （从左到右优先匹配  0 个，否则尽量匹配最少个）</span>

<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;a()b(c)d(ef)g((hij))&#34;</span><span class="p">,</span><span class="s2">&#34;%(.?%)&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span>  <span class="c1">--打印的结果：a=b=d(ef)g((hij))  2 （从左到右优先匹配  1 个，否则最后匹配  0 个）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;a()b(c)d(ef)g((hij))&#34;</span><span class="p">,</span><span class="s2">&#34;%(.+%)&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span>  <span class="c1">--打印的结果：a=                 1 （从左到右优先匹配最多个，否则最后匹配  1 个）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;a()b(c)d(ef)g((hij))&#34;</span><span class="p">,</span><span class="s2">&#34;%(.*%)&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span>  <span class="c1">--打印的结果：a=                 1 （从左到右优先匹配最多个，否则最后匹配  0 个）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;a()b(c)d(ef)g((hij))&#34;</span><span class="p">,</span><span class="s2">&#34;%(.-%)&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span>  <span class="c1">--打印的结果：a=b=d=g=)          4 （从左到右优先匹配  0 个，否则尽量匹配最少个）</span>

<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;home = $HOME, user = $USER&#34;</span><span class="p">,</span> <span class="s2">&#34;%$(%w+)&#34;</span><span class="p">,</span> <span class="n">os.getenv</span><span class="p">))</span>     <span class="c1">--打印的结果：home = /home/o2ospring, user = o2ospring 2</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;aa bb cc dd ee ff gg hh&#34;</span><span class="p">,</span> <span class="s2">&#34;(%w+)%s*(%w+)&#34;</span><span class="p">,</span> <span class="s2">&#34;%2 %1&#34;</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">--打印的结果：bb aa dd cc ff ee hh gg 2</span>
										   
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;a()&#34;</span><span class="p">,</span><span class="s2">&#34;%(.+%)&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span>     <span class="c1">--打印的结果：a()  0</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="s2">&#34;a()&#34;</span><span class="p">,</span><span class="s2">&#34;%(.*%)&#34;</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">))</span>     <span class="c1">--打印的结果：a=   1</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&#34;[%c]+$&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">..</span><span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span>   <span class="c1">--假设[v]是从文件读出的一行文本，本行命令表示将一行文本的结束符替换为&#34;回车+换行&#34;（即为 windows 格式）</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&#34;^aaa&#34;</span><span class="p">,</span> <span class="s2">&#34;bbb&#34;</span><span class="p">)</span>          <span class="c1">--假设[v]是从文件读出的一行文本，本行命令表示将一行文本的行首为&#34;aaa&#34;替换为&#34;bbb&#34;</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">string_ss_to_ws</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>         <span class="c1">--普通字符串变量用到通配字符串的转换函数</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%%&#34;</span><span class="p">,</span> <span class="s2">&#34;%%%%&#34;</span><span class="p">)</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%(&#34;</span><span class="p">,</span> <span class="s2">&#34;%%(&#34;</span><span class="p">)</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%)&#34;</span><span class="p">,</span> <span class="s2">&#34;%%)&#34;</span><span class="p">)</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%[&#34;</span><span class="p">,</span> <span class="s2">&#34;%%[&#34;</span><span class="p">)</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%]&#34;</span><span class="p">,</span> <span class="s2">&#34;%%]&#34;</span><span class="p">)</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%$&#34;</span><span class="p">,</span> <span class="s2">&#34;%%$&#34;</span><span class="p">)</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%^&#34;</span><span class="p">,</span> <span class="s2">&#34;%%^&#34;</span><span class="p">)</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%.&#34;</span><span class="p">,</span> <span class="s2">&#34;%%.&#34;</span><span class="p">)</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%?&#34;</span><span class="p">,</span> <span class="s2">&#34;%%?&#34;</span><span class="p">)</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%*&#34;</span><span class="p">,</span> <span class="s2">&#34;%%*&#34;</span><span class="p">)</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%+&#34;</span><span class="p">,</span> <span class="s2">&#34;%%+&#34;</span><span class="p">)</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%-&#34;</span><span class="p">,</span> <span class="s2">&#34;%%-&#34;</span><span class="p">)</span>
	<span class="kr">return</span> <span class="n">ss</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">string_ss_to_zs</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>         <span class="c1">--普通字符串变量用到捕获字符串的转换函数</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%%&#34;</span><span class="p">,</span> <span class="s2">&#34;%%%%&#34;</span><span class="p">)</span>
	<span class="kr">return</span> <span class="n">ss</span>
<span class="kr">end</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">--字符串查找截取--</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.match</span><span class="p">(</span><span class="s2">&#34;a 2 bb 3 cc&#34;</span><span class="p">,</span> <span class="s2">&#34;%d+ %a+&#34;</span><span class="p">))</span>    <span class="c1">--打印的结果：2 bb（&#34;%d+ %a+&#34;表示匹配数字段+空格+字符段）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.match</span><span class="p">(</span><span class="s2">&#34;a 2 bb 3 cc&#34;</span><span class="p">,</span> <span class="s2">&#34;%d+ %a+&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="c1">--打印的结果：3 cc（同上，但从第4个字符开始查找）</span>

<span class="c1">--字符迭代查找截取--</span>
<span class="kr">for</span> <span class="n">s</span> <span class="kr">in</span> <span class="n">string.gmatch</span><span class="p">(</span><span class="s2">&#34;This,is Lua&#34;</span><span class="p">,</span> <span class="s2">&#34;%a+&#34;</span><span class="p">)</span> <span class="kr">do</span>  <span class="c1">--（&#34;%a+&#34;表示匹配多个字符，&#34;%a&#34;则是匹配单个字符）</span>
	<span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                                     <span class="c1">--打印的结果：This（共三行内容，无空格）</span>
<span class="kr">end</span>                                              <span class="c1">--            is  （共三行内容，无空格）</span>
                                                 <span class="c1">--            Lua （共三行内容，无空格）</span>

<span class="kr">for</span> <span class="n">s</span> <span class="kr">in</span> <span class="n">string.gmatch</span><span class="p">(</span><span class="s2">&#34;This,is Lua&#34;</span><span class="p">,</span> <span class="s2">&#34;%a%a&#34;</span><span class="p">)</span> <span class="kr">do</span> <span class="c1">--（&#34;%a%a&#34;表示匹配两个字符）</span>
	<span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                                     <span class="c1">--打印的结果：Th  （共四行内容，无空格）</span>
<span class="kr">end</span>                                              <span class="c1">--            is  （共四行内容，无空格）</span>
                                                 <span class="c1">--            is  （共四行内容，无空格）</span>
                                                 <span class="c1">--            Lu  （共四行内容，无空格）</span>

<span class="kr">for</span> <span class="n">s</span> <span class="kr">in</span> <span class="n">string.gmatch</span><span class="p">(</span><span class="s2">&#34;This,is Lua&#34;</span><span class="p">,</span> <span class="s2">&#34;%a+,&#34;</span><span class="p">)</span> <span class="kr">do</span> <span class="c1">--（&#34;%a+,&#34;表示匹配多个字符及逗号）</span>
	<span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                                     <span class="c1">--打印的结果：This,</span>
<span class="kr">end</span>

<span class="n">array</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;from=world, to=Lua&#34;</span>
<span class="kr">for</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span> <span class="kr">in</span> <span class="n">string.gmatch</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&#34;(%w+)=(%w+)&#34;</span><span class="p">)</span> <span class="kr">do</span>    <span class="c1">--注意 () 的用途! 简单理解为匹配的字符串中只截取括号里的字符串(有多少对括号就返回多少个参数值）</span>
    <span class="n">array</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
    <span class="n">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>                                     <span class="c1">--第一次循环打印：from                   第二次循环打印：to</span>
    <span class="n">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>                                     <span class="c1">--第一次循环打印：world                  第二次循环打印：Lua</span>
    <span class="n">print</span><span class="p">(</span><span class="s2">&#34;array[</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">..</span><span class="n">n</span><span class="o">..</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">]=</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">..</span><span class="n">m</span><span class="o">..</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="p">)</span>      <span class="c1">--第一次循环打印：array[&#34;from&#34;]=&#34;world&#34;  第二次循环打印：array[&#34;to&#34;]=&#34;Lua&#34;</span>
<span class="kr">end</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">--字符格式化--</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;the value is:%d&#34;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="c1">--打印的结果：the value is:8</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;%5.3f&#34;</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>           <span class="c1">--打印的结果：13.00</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;%2s&#34;</span><span class="p">,</span> <span class="s2">&#34;monday&#34;</span><span class="p">))</span>      <span class="c1">--打印的结果：monday    （结果前面没有空格）（截取全部字符并以2位右对齐显示）（★自动扩展6位显示★）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;%10s&#34;</span><span class="p">,</span> <span class="s2">&#34;monday&#34;</span><span class="p">))</span>     <span class="c1">--打印的结果：    monday（结果前面四个空格）（截取全部字符并以10位右对齐显示）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;%5.3s&#34;</span><span class="p">,</span> <span class="s2">&#34;monday&#34;</span><span class="p">))</span>    <span class="c1">--打印的结果：  mon     （结果前面两个空格）（截取前面3个字符并以5位右对齐显示）</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;%-5.3s&#34;</span><span class="p">,</span> <span class="s2">&#34;monday&#34;</span><span class="p">))</span>   <span class="c1">--打印的结果：mon       （结果后面两个空格）（截取前面3个字符并以5位左对齐显示）</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">string_ss_to_fs</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>         <span class="c1">--普通字符串变量用到格式化字符串的转换函数</span>
	<span class="n">ss</span> <span class="o">=</span> <span class="n">string.gsub</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="s2">&#34;%%&#34;</span><span class="p">,</span> <span class="s2">&#34;%%%%&#34;</span><span class="p">)</span>
	<span class="kr">return</span> <span class="n">ss</span>
<span class="kr">end</span>
</code></pre></td></tr></table>
</div>
</div></details>  
<hr>
<p><strong>说明三</strong>、对于使用<code>[[]]</code>书写的字符串、或者通过文件方式读取的内容，lua 已自动为我们加入了转义符，所以无需关心特殊字符是否要转义。</p>
<table>
<thead>
<tr>
<th style="text-align:left"><div style="width:80px">特殊字符</div></th>
<th style="text-align:left">字符</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>\\</code></td>
<td style="text-align:left">代表一个反斜线字符：\ （可见符）</td>
</tr>
<tr>
<td style="text-align:left"><code>\'</code></td>
<td style="text-align:left">代表一个单引号字符：&rsquo;  （可见符）</td>
</tr>
<tr>
<td style="text-align:left"><code>\&quot;</code></td>
<td style="text-align:left">代表一个双引号字符：&quot;  （可见符）</td>
</tr>
<tr>
<td style="text-align:left">\a</td>
<td style="text-align:left">响铃</td>
</tr>
<tr>
<td style="text-align:left">\b</td>
<td style="text-align:left">退格</td>
</tr>
<tr>
<td style="text-align:left">\f</td>
<td style="text-align:left">换页</td>
</tr>
<tr>
<td style="text-align:left">\n</td>
<td style="text-align:left">换行</td>
</tr>
<tr>
<td style="text-align:left">\r</td>
<td style="text-align:left">回车</td>
</tr>
<tr>
<td style="text-align:left">\t</td>
<td style="text-align:left">水平制表(HT)（跳到下一个TAB位置）</td>
</tr>
<tr>
<td style="text-align:left">\v</td>
<td style="text-align:left">垂直制表(VT)</td>
</tr>
<tr>
<td style="text-align:left">\0</td>
<td style="text-align:left">空字符</td>
</tr>
<tr>
<td style="text-align:left">\ddd</td>
<td style="text-align:left">3 位八进制数所代表的任意字符（如：<code>\777</code>）</td>
</tr>
<tr>
<td style="text-align:left">\xhh</td>
<td style="text-align:left">2 位十六进制所代表的任意字符（如：<code>\xF5</code>）</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>说明四</strong>、关于通配字符串，在普通字符串基本上，增加通配符（如：%a、%c 等）和 增多 12 个转义符（如：<code>%%</code>、<code>%-</code> 等）规则。特别说明：匹配规则有 70% 类同正则表达式，更多知识请移步《<a href="../20220527" rel="">正则表达式语法</a>》！</p>
<table>
<thead>
<tr>
<th style="text-align:left"><div style="width:80px">通配符</div></th>
<th style="text-align:left">含义 （下面改大写表示非，例如：%A 表示非字母的字符）</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>%(</code> <code>%)</code> <br><code>%[</code> <code>%]</code> <br><code>%^</code> <code>%$</code> <br><code>%*</code> <code>%+</code> <br><code>%?</code> <code>%-</code> <br><code>%.</code> <code>%%</code></td>
<td style="text-align:left">匹配中一些特殊字符需要用%来转义，主要为 12 个特殊字符：<code>( ) [ ] ^ $ * + ? - . %</code></td>
</tr>
<tr>
<td style="text-align:left">%a</td>
<td style="text-align:left">与任何字母配对</td>
</tr>
<tr>
<td style="text-align:left">%u</td>
<td style="text-align:left">与任何大写字母配对</td>
</tr>
<tr>
<td style="text-align:left">%l</td>
<td style="text-align:left">与任何小写字母配对</td>
</tr>
<tr>
<td style="text-align:left">%d</td>
<td style="text-align:left">与任何数字配对</td>
</tr>
<tr>
<td style="text-align:left">%w</td>
<td style="text-align:left">与任何字母 / 数字配对</td>
</tr>
<tr>
<td style="text-align:left">%x</td>
<td style="text-align:left">与任何十六进制数配对</td>
</tr>
<tr>
<td style="text-align:left">%p</td>
<td style="text-align:left">与任何标点符配对（包括：<code>( ) [ ] % $ ^ . ? * + -</code>）</td>
</tr>
<tr>
<td style="text-align:left">%s</td>
<td style="text-align:left">与任何空白符配对（例如：空格）（注意包括<code>Tab键</code>）</td>
</tr>
<tr>
<td style="text-align:left">%c</td>
<td style="text-align:left">与任何控制符配对（例如：\n）（注意包括<code>Tab键</code>）</td>
</tr>
<tr>
<td style="text-align:left">%z</td>
<td style="text-align:left">与任何代表 0 的字符配对</td>
</tr>
<tr>
<td style="text-align:left">%bxy</td>
<td style="text-align:left">这里的 x 和 y 是两个明确的字符。<br>1、当 x ≤ y 表示起始符为 x 与 结束字符为 y 的字符串以最少个优先匹配；<br>2、当 x ＞ y 表示起始符为 y 与 结束字符为 x 的字符串以最多个优先匹配。<br>3、补充：x y 匹配的中间可以有标点符</td>
</tr>
<tr>
<td style="text-align:left">[字符类]</td>
<td style="text-align:left">与任何有包含在 [ ] 中的字符配对，即可以自定义字符类。例如 %x 其实就是 [0-9a-fA-F]</td>
</tr>
<tr>
<td style="text-align:left">[^字符类]</td>
<td style="text-align:left">与任何不包含在 [ ] 中的字符配对，即可以自定义字符类。</td>
</tr>
<tr>
<td style="text-align:left">( )</td>
<td style="text-align:left">用小括号括起一个子模式，这些子模式被称为捕获物。例如：<code>(a*(.)%w(%s*))</code>，<code>%1</code>代表第一个捕获物<code>a*(.)%w(%s*)</code>，<code>%2</code>代表第二个捕获物<code>.</code>，<code>%3</code>代表第三个捕获物<code>%s*</code></td>
</tr>
<tr>
<td style="text-align:left">^</td>
<td style="text-align:left">以指定字符为【开头】（例如：<code>^[%s]+</code>表示有空格开头的字符串）</td>
</tr>
<tr>
<td style="text-align:left">$</td>
<td style="text-align:left">以指定字符为【结尾】（例如：<code>[%s]+$</code>表示有空格结尾的字符串），同时也用来表示系统变量（例如：<code>$HOME</code>为用户家目录系统变量）</td>
</tr>
<tr>
<td style="text-align:left">* 修饰符</td>
<td style="text-align:left">匹配前面一个通配符<strong><code>n～0</code></strong>个（<strong>从左到右优先匹配最多个，否则最后匹配  0 个</strong>）<br>典型应用：&quot;%s*&quot; 匹配空白 或 &ldquo;.<em>&rdquo; 任意字符。例如：&quot;%(%s</em>%)&quot; 括号间空或多个空白(如:空格)</td>
</tr>
<tr>
<td style="text-align:left">+ 修饰符</td>
<td style="text-align:left">匹配前面一个通配符<strong><code>n～1</code></strong>个（<strong>从左到右优先匹配最多个，否则最后匹配  1 个</strong>）<br>普通例子：&quot;%a+&quot; 匹配连接多个字母</td>
</tr>
<tr>
<td style="text-align:left">? 修饰符</td>
<td style="text-align:left">匹配前面一个通配符<strong><code>1～0</code></strong>个（<strong>从左到右优先匹配  1 个，否则最后匹配  0 个</strong>）<br>典型应用：&quot;%s?&quot; 匹配空白 或 &ldquo;.?&rdquo; 任意字符。例如：&quot;%(%s?%)&quot; 括号间空或一个空白(如:空格)</td>
</tr>
<tr>
<td style="text-align:left">- 修饰符</td>
<td style="text-align:left">匹配前面一个通配符<strong><code>0～n</code></strong>个（<strong>从左到右优先匹配  0 个，否则尽量匹配最少个</strong>）<br>典型应用：&quot;%s-&quot; 匹配空白 或 &ldquo;.-&rdquo; 任意字符。例如：&quot;%(%s-%)&quot; 括号间空或多个空白(如:空格)</td>
</tr>
<tr>
<td style="text-align:left">.</td>
<td style="text-align:left">与任何字符配对（特别，不需要 % 转义符）</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>说明五</strong>、关于格式化字符串，在普通字符串基础上，增加格式化符（如：%d、%f 等）和 增多 1 个转义符（即：<code>%%</code>）规则。</p>
<table>
<thead>
<tr>
<th style="text-align:left"><div style="width:80px">格式化符</div></th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>%%</code></td>
<td style="text-align:left">格式化中特殊字符“%”需要用<code>%</code>来转义</td>
</tr>
<tr>
<td style="text-align:left">%c</td>
<td style="text-align:left">接受一个数字, 并将其转化为ASCII码表中对应的字符</td>
</tr>
<tr>
<td style="text-align:left">%d, %i</td>
<td style="text-align:left">接受一个数字并将其转化为有符号的整数格式</td>
</tr>
<tr>
<td style="text-align:left">%o</td>
<td style="text-align:left">接受一个数字并将其转化为八进制数格式</td>
</tr>
<tr>
<td style="text-align:left">%u</td>
<td style="text-align:left">接受一个数字并将其转化为无符号整数格式</td>
</tr>
<tr>
<td style="text-align:left">%x</td>
<td style="text-align:left">接受一个数字并将其转化为十六进制数格式, 使用小写字母</td>
</tr>
<tr>
<td style="text-align:left">%X</td>
<td style="text-align:left">接受一个数字并将其转化为十六进制数格式, 使用大写字母</td>
</tr>
<tr>
<td style="text-align:left">%e</td>
<td style="text-align:left">接受一个数字并将其转化为科学记数法格式, 使用小写字母e</td>
</tr>
<tr>
<td style="text-align:left">%E</td>
<td style="text-align:left">接受一个数字并将其转化为科学记数法格式, 使用大写字母E</td>
</tr>
<tr>
<td style="text-align:left">%f</td>
<td style="text-align:left">接受一个数字并将其转化为浮点数格式</td>
</tr>
<tr>
<td style="text-align:left">%g(%G)</td>
<td style="text-align:left">接受一个数字并将其转化为%e(%E, 对应%G)及%f中较短的一种格式</td>
</tr>
<tr>
<td style="text-align:left">%q</td>
<td style="text-align:left">接受一个字符串并将其转化为可安全被Lua编译器读入的格式</td>
</tr>
<tr>
<td style="text-align:left">%s</td>
<td style="text-align:left">接受一个字符串并按照给定的参数格式化该字符串</td>
</tr>
<tr>
<td style="text-align:left">%2x</td>
<td style="text-align:left">输出2位十六进制整数(小写)&hellip;.</td>
</tr>
<tr>
<td style="text-align:left">%2X</td>
<td style="text-align:left">输出2位十六进制整数(大写)&hellip;.</td>
</tr>
<tr>
<td style="text-align:left">%+d</td>
<td style="text-align:left">让正数显示正号（默认情况下只有负数显示符号）</td>
</tr>
<tr>
<td style="text-align:left">%2d</td>
<td style="text-align:left">输出2位有符号十进整数, 不足2位时[前面]补空格(即:右对齐) &hellip;.其它数据格式类同</td>
</tr>
<tr>
<td style="text-align:left">%-2d</td>
<td style="text-align:left">输出2位有符号十进整数, 不足2位时[后面]补空格(即:左对齐) &hellip;.其它数据格式类同</td>
</tr>
<tr>
<td style="text-align:left">%02d</td>
<td style="text-align:left">输出2位有符号十进整数, 不足2位时[自动]补0  &hellip;&hellip;&hellip;&hellip;&hellip;..其它数据格式类同</td>
</tr>
<tr>
<td style="text-align:left">%8.3f</td>
<td style="text-align:left">输出宽度为8(包含小数点)，小数点后面是三位。 12.34 → &quot;  12.340&quot;</td>
</tr>
<tr>
<td style="text-align:left">%08.03f</td>
<td style="text-align:left">输出宽度为8(包含小数点)，小数点后面是三位。 12.34 → &ldquo;0012.340&rdquo;</td>
</tr>
<tr>
<td style="text-align:left">%-5.3s</td>
<td style="text-align:left">输出宽度为5位字符（左对齐+右边补空格）来显示截取的3位字符。</td>
</tr>
</tbody>
</table>
<p>参考网文：<a href="https://www.cnblogs.com/chenny7/p/4054370.html" target="_blank" rel="noopener noreffer">Lua 之 string 库</a>、<a href="https://www.cnblogs.com/whiteyun/archive/2009/09/02/1541043.html" target="_blank" rel="noopener noreffer">Lua 模式匹配</a>、<a href="https://blog.csdn.net/thlzjfefe/article/details/114798819" target="_blank" rel="noopener noreffer">Lua 正则表达式匹配</a>、<a href="https://zhuanlan.zhihu.com/p/74329344" target="_blank" rel="noopener noreffer">Lua 字符串处理</a></p>
<hr>
</details>  
<details close=""><summary>12、lua 之 io 库</summary>  
<blockquote>
<p><strong>一、知识要点：</strong></p>
</blockquote>
<p>lua 对文件读操作，可以任意移动光标读取内容；但对文件写操作，只能以覆盖或追加方式写入内容，简单说就是不能直接编辑文件内容。问题来了，如何改写文件内容？【方法一】：读取一行文件内容，再写入到另一空白文件，如果中途要改写内容，则在写入前先修改缓冲内容再写入，最后所有内容写入后替换原文件(名)。【方法二】：将文件读到数组中，每行为一组员，在读/写过程中修改内容或全部读完后再修改内容，最后以覆盖方式写入文件，要求文件较小或内存足够大。估计文件编辑工具应该都是使用方法二来实现文本编辑功能。</p>
<blockquote>
<p><strong>二、操作函数：</strong></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="n">file</span> <span class="o">=</span> <span class="n">io.open</span><span class="p">(</span><span class="s2">&#34;filename&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;mode&#34;</span><span class="p">])</span>  <span class="c1">--打开文件&gt;&gt;&gt;&gt;&gt;，返回(file)句柄（否则为`nil`）。可扩展参数[mode]表示只读、只写文件……</span>
<span class="n">file</span><span class="p">:</span><span class="n">seek</span><span class="p">([</span><span class="s2">&#34;mode&#34;</span><span class="p">,</span> <span class="n">n</span><span class="p">])</span>                <span class="c1">--设置读光标位置。可扩展参数[mode]表示当前位置、文件头位置、文件尾位置开始算起的偏移位置[n]</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">file</span><span class="p">:</span><span class="n">read</span><span class="p">([</span><span class="s2">&#34;mode&#34;</span><span class="p">])</span>               <span class="c1">--读取文件的内容。可扩展参数[mode]表示当前位置往后读几个字符、或读到行尾、或读到文件尾</span>
<span class="n">file</span><span class="p">:</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;text&#34;</span><span class="p">)</span>                    <span class="c1">--在文尾写入内容。写光标的位置用户不能修改，由open()和write()函数自动设置</span>
<span class="n">file</span><span class="p">:</span><span class="n">flush</span><span class="p">()</span>                          <span class="c1">--将写入内容存盘。</span>
<span class="n">file</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>                          <span class="c1">--关闭文件&lt;&lt;&lt;&lt;&lt;。</span>
<span class="n">io.lines</span><span class="p">(</span><span class="s2">&#34;filename&#34;</span><span class="p">)</span>                  <span class="c1">--迭代地读取文件。需要 for 循环语句配合，【例如】：for v in io.lines(&#34;./my.lua&#34;) do print(v) end</span>

<span class="c1">--tostring(number)                    --将数字(数值)转为字符，方便保存到文件。</span>
<span class="c1">--tonumber(&#34;number&#34;)                  --将字符转为数字(数值)，可用于从文件读出的文本参数转为数字进行处理。</span>
<span class="c1">--os.rename(&#34;old_name&#34;, &#34;new_name&#34;)   --将文件重命名，操作成功返回：true（否则：nil 及相关错误信息）【例如】：os.rename(&#34;./f/abc.txt&#34;, &#34;./f/123.txt&#34;)</span>
<span class="c1">--os.remove(&#34;file_name&#34;)              --删除一个文件，操作成功返回：true（否则：nil 及相关错误信息）补充：受到文件操作权限影响！</span>
</code></pre></td></tr></table>
</div>
</div><details close=""><summary>──点击展开例子──</summary>  
<p>一、简单模式（simple model）读写操作函数无须指出句柄：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">------------------</span>
<span class="c1">--打开文件读写操作</span>
<span class="c1">------------------</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">io.open</span><span class="p">(</span><span class="s2">&#34;my.lua&#34;</span><span class="p">,</span> <span class="s2">&#34;a+&#34;</span><span class="p">)</span> <span class="c1">--打开文件&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>

<span class="kd">local</span> <span class="n">i_file</span> <span class="o">=</span> <span class="n">io.input</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>  <span class="c1">--【准备读】------------------------------</span>
	<span class="n">print</span><span class="p">(</span><span class="n">io.read</span><span class="p">())</span>           <span class="c1">--读出第一行内容（默认入口参数&#34;*l&#34;）</span>
	<span class="n">print</span><span class="p">(</span><span class="n">io.read</span><span class="p">(</span><span class="s2">&#34;*l&#34;</span><span class="p">))</span>       <span class="c1">--读出第二行内容</span>
	<span class="n">print</span><span class="p">(</span><span class="n">io.read</span><span class="p">())</span>           <span class="c1">--读出第三行内容</span>
	<span class="kr">for</span> <span class="n">v</span> <span class="kr">in</span> <span class="n">io.lines</span><span class="p">()</span> <span class="kr">do</span>     <span class="c1">--从第四行内容开始读 （io.lines 没有带参数）</span>
		<span class="n">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>               <span class="c1">--打印第四、五、…行内容</span>
	<span class="kr">end</span>                        <span class="c1">--读完不关闭文件（因为 io.lines 没有带参数）</span>

<span class="kd">local</span> <span class="n">o_file</span> <span class="o">=</span> <span class="n">io.output</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="c1">--【准备写】------------------------------</span>
	<span class="n">io.write</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">--text1&#34;</span><span class="p">)</span>    <span class="c1">--文件未尾写入一行内容</span>
	<span class="n">io.write</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">--text2&#34;</span><span class="p">)</span>    <span class="c1">--文件未尾再写入一行内容</span>
	<span class="n">io.flush</span><span class="p">()</span>                 <span class="c1">--将写入的内容存入磁盘(否则数据可能会丢失)</span>

<span class="n">io.close</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>                 <span class="c1">--关闭文件&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>

<span class="c1">------------------</span>
<span class="c1">--直接迭代读取内容</span>
<span class="c1">------------------</span>
<span class="kr">for</span> <span class="n">v</span> <span class="kr">in</span> <span class="n">io.lines</span><span class="p">(</span><span class="s2">&#34;./my.lua&#34;</span><span class="p">)</span> <span class="kr">do</span>
	<span class="n">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>                   <span class="c1">--打印出通过迭代读取文件内容（注：一次读一行内容）</span>
<span class="kr">end</span>                            <span class="c1">--读完后自动关闭文件（注: io.lines 带参数才会自动关闭文件）</span>
</code></pre></td></tr></table>
</div>
</div><p>二、完全模式（complete model）使用句柄对文件进行操作：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">------------------</span>
<span class="c1">--打开文件读写操作</span>
<span class="c1">------------------</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">io.open</span><span class="p">(</span><span class="s2">&#34;my.lua&#34;</span><span class="p">,</span> <span class="s2">&#34;a+&#34;</span><span class="p">)</span> <span class="c1">--打开文件&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>

	<span class="n">print</span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="n">read</span><span class="p">())</span>         <span class="c1">--读出第一行内容</span>
	<span class="n">print</span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="n">read</span><span class="p">(</span><span class="s2">&#34;*l&#34;</span><span class="p">))</span>     <span class="c1">--读出第二行内容</span>
	<span class="kr">for</span> <span class="n">v</span> <span class="kr">in</span> <span class="n">file</span><span class="p">:</span><span class="n">lines</span><span class="p">()</span> <span class="kr">do</span>   <span class="c1">--从第三行内容开始读 （file:lines 没有带参数）</span>
		<span class="n">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>               <span class="c1">--打印第三行内容</span>
		<span class="kr">break</span>                  <span class="c1">--退出,因只读1行</span>
	<span class="kr">end</span>                        <span class="c1">--读完不关闭文件（因为 file:lines 没有带参数）</span>

	<span class="n">file</span><span class="p">:</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">--text1&#34;</span><span class="p">)</span>  <span class="c1">--文件未尾写入一行内容</span>
	<span class="n">file</span><span class="p">:</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">--text2&#34;</span><span class="p">)</span>  <span class="c1">--文件未尾再写入一行内容</span>
	<span class="n">file</span><span class="p">:</span><span class="n">flush</span><span class="p">()</span>               <span class="c1">--将写入的内容存入磁盘(否则数据可能会丢失)</span>

	<span class="n">file</span><span class="p">:</span><span class="n">seek</span><span class="p">(</span><span class="s2">&#34;end&#34;</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>       <span class="c1">--设置光标位置:文件倒数第5个位置，</span>
	<span class="n">file</span><span class="p">:</span><span class="n">read</span><span class="p">()</span>                <span class="c1">--            再读取一行剩余内容。</span>

<span class="n">file</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>                   <span class="c1">--关闭文件&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
<span class="c1">--io.close(file)               --或者此句</span>

<span class="c1">------------------</span>
<span class="c1">--判断文件是否存在</span>
<span class="c1">------------------</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">io.open</span><span class="p">(</span><span class="s2">&#34;my.lua&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span>  <span class="c1">--打开文件&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>

<span class="kr">if</span> <span class="n">file</span> <span class="kr">then</span>                   <span class="c1">--&#34;r&#34;或&#34;r+&#34;模式必须要判断文件是否存在</span>
	<span class="kd">local</span> <span class="n">size</span> <span class="o">=</span> <span class="kc">false</span>
	<span class="n">size</span> <span class="o">=</span> <span class="n">file</span><span class="p">:</span><span class="n">seek</span><span class="p">(</span><span class="s2">&#34;end&#34;</span><span class="p">)</span>    <span class="c1">--读出文件大小</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;file size = &#34;</span><span class="o">..</span><span class="n">size</span><span class="p">)</span>

<span class="n">file</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>                   <span class="c1">--关闭文件&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
<span class="kr">else</span>
	<span class="n">print</span><span class="p">(</span><span class="s2">&#34;No file found!&#34;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></td></tr></table>
</div>
</div></details>  
<hr>
<p><strong>说明一</strong>、io.open(file, [&ldquo;mode&rdquo;]) 参数：</p>
<table>
<thead>
<tr>
<th style="text-align:center"><div style="width:96px">参数</div></th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>&quot;r&quot;</code></td>
<td style="text-align:left">以只读+存在方式打开文件，该文件必须存在，否则返回<code>nil</code>。（默认的打开方式）（也常用于判断文件是否存在）</td>
</tr>
<tr>
<td style="text-align:center"><code>&quot;w&quot;</code></td>
<td style="text-align:left">以只写+清空方式打开文件，若文件不存在则建立该文件（注：写光标不可移动）</td>
</tr>
<tr>
<td style="text-align:center"><code>&quot;a&quot;</code></td>
<td style="text-align:left">以只写+追加方式打开文件，若文件不存在则建立该文件（注：写光标不可移动）</td>
</tr>
<tr>
<td style="text-align:center"><code>&quot;r+&quot;</code></td>
<td style="text-align:left">以读写+覆盖方式打开文件，该文件必须存在，否则返回<code>nil</code>。（注：写光标可以用<code>seek</code>移动）</td>
</tr>
<tr>
<td style="text-align:center"><code>&quot;w+&quot;</code></td>
<td style="text-align:left">以读写+清空方式打开文件，若文件不存在则建立该文件（注：写光标不可移动）</td>
</tr>
<tr>
<td style="text-align:center"><code>&quot;a+&quot;</code></td>
<td style="text-align:left">以读写+追加方式打开文件，若文件不存在则建立该文件（注：写光标不可移动）</td>
</tr>
<tr>
<td style="text-align:center">补充</td>
<td style="text-align:left">1. 除追加方式写光标在文件末尾外，其它方式的读写光标都默认在文件开头处。<br>2. <code>&quot;r&quot; &quot;r+&quot;</code>必须要判断文件有存在后才可操作，否则运行会出错！</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>说明二</strong>、file:read([&ldquo;mode&rdquo;])、io.read([&ldquo;mode&rdquo;]) 参数：</p>
<table>
<thead>
<tr>
<th style="text-align:center"><div style="width:96px">参数</div></th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>&quot;*l&quot;</code></td>
<td style="text-align:left">读出当前光标到行尾的内容，之后光标跳至下一行首（<code>默认参数，可以不写</code>）</td>
</tr>
<tr>
<td style="text-align:center"><code>&quot;*a&quot;</code></td>
<td style="text-align:left">读出当前光标到最后一行的内容（再&quot;*a&quot;模式读就会返回<code>空白</code>，非<code>nil</code>）</td>
</tr>
<tr>
<td style="text-align:center"><code>&quot;*n&quot;</code></td>
<td style="text-align:left">读出当前光标为连续数字的内容及光标移到数字后一个字符（不会跳过回车换行符），否则返回<code>nil</code>并且光标右移一位</td>
</tr>
<tr>
<td style="text-align:center"><code>数字</code></td>
<td style="text-align:left">读出当前光标及之后共 n 个字符（其回车符+换行符共算两个字符），光标跳至 n 个字符之后</td>
</tr>
<tr>
<td style="text-align:center">补充</td>
<td style="text-align:left">只要光标在文件末尾，再读就会返回<code>nil</code>（但&quot;*a&quot;模式读返回<code>空</code>除外）</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>说明三</strong>、file:seek([&ldquo;mode&rdquo;, n]) 参数：</p>
<table>
<thead>
<tr>
<th style="text-align:center"><div style="width:96px">参数</div></th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>&quot;cur&quot;, n</code></td>
<td style="text-align:left">从当前位置开始，<code>n</code>可正负数，表示光标移到前或后的第<code>n</code>个字符处（n 可以为 0）</td>
</tr>
<tr>
<td style="text-align:center"><code>&quot;set&quot;, n</code></td>
<td style="text-align:left">从文件前头开始，<code>n</code>须为正数，表示光标移到文件前头开始的第<code>n</code>个字符处（n ≥ 0）</td>
</tr>
<tr>
<td style="text-align:center"><code>&quot;end&quot;, n</code></td>
<td style="text-align:left">从文件末尾开始，<code>n</code>须为负数，表示光标移到文件末尾开始的第<code>n</code>个字符处（n ≤ 0）</td>
</tr>
</tbody>
</table>
</details>  
<details close=""><summary>13、lua 之 os 库</summary>  
<blockquote>
<p><strong>一、操作函数：</strong></p>
</blockquote>
<p><strong>说明一</strong>、lua 提供了简单的跟操作系统有关的功能操作，还提供了直接运行系统命令，可扩展其应用功能。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">--文件操作--</span>
<span class="n">os.rename</span><span class="p">(</span><span class="s2">&#34;old_name&#34;</span><span class="p">,</span> <span class="s2">&#34;new_name&#34;</span><span class="p">)</span>  <span class="c1">--将文件重命名，操作成功返回：true（否则：nil 及相关错误信息）【例如】：os.rename(&#34;./f/abc.txt&#34;, &#34;./f/123.txt&#34;)</span>
<span class="n">os.remove</span><span class="p">(</span><span class="s2">&#34;file_name&#34;</span><span class="p">)</span>             <span class="c1">--删除一个文件，操作成功返回：true（否则：nil 及相关错误信息）补充：受到文件操作权限影响！</span>

<span class="c1">--系统控制--</span>
<span class="n">os.getenv</span><span class="p">(</span><span class="s2">&#34;os_variable&#34;</span><span class="p">)</span>           <span class="c1">--获取系统环境变量，操作成功返回环境变量值[字符串]（否则：nil）【例如】：os.getenv(&#34;HOME&#34;)) 返回：/home/xiaoming</span>
<span class="n">os.execute</span><span class="p">(</span><span class="s2">&#34;cmd_string&#34;</span><span class="p">)</span>           <span class="c1">--运行系统字符命令，操作成功返回：true（否则：nil）【例如】：os.execute(&#34;ls -l&#34;) 列出文件(夹)信息后返回：true</span>
<span class="n">os.exit</span><span class="p">(</span><span class="n">num_value</span><span class="p">)</span>                 <span class="c1">--退出当前lau程序，并返回状态值（默认值：0）【例如】：os.exit(0) 退出 lau 程序</span>

<span class="c1">--时间操作--</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">os.time</span><span class="p">([</span><span class="n">day_time_tb</span><span class="p">])</span>         <span class="c1">--获取系统当前时间戳，可用扩展参数[day_time_tb]指定日期时间的时间戳。【例如】：os.time() 返回：1641384000。[day_time_tb]表格例子：{year=2020, month=12, day=31, hour=5, min=6, sec=7, isdst=false}（isdst是否为夏令时)）</span>
<span class="n">os.difftime</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>                <span class="c1">--计算两时间戳的差值</span>
<span class="n">os.date</span><span class="p">([</span><span class="s2">&#34;fmt&#34;</span><span class="p">],</span> <span class="p">[</span><span class="n">t</span><span class="p">])</span>              <span class="c1">--获取当前的日期时间，可用扩展参数[fmt]格式化返回的日期时间，[t]指定时间戳的日期时间。【例如】：os.date() 返回：Wed Jan  5 21:57:19 2022。｛[fmt]：%a 星期几简写(如:Wed)；%Y……｝</span>
<span class="n">os.clock</span><span class="p">()</span>                         <span class="c1">--获取CPU运行时间戳，常用于计算一段代码运行的时间。【例如】：os.clock() 返回：0.00091</span>
</code></pre></td></tr></table>
</div>
</div><details close=""><summary>──点击展开例子──</summary>  
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">------------------</span>
<span class="c1">--更改文件名称</span>
<span class="c1">------------------</span>
<span class="n">print</span><span class="p">(</span><span class="n">os.rename</span><span class="p">(</span><span class="s2">&#34;./oldname.lua&#34;</span><span class="p">,</span> <span class="s2">&#34;./newname.lua&#34;</span><span class="p">))</span> <span class="c1">--如果操作成功则打印：true （否则：nil 及相关错误信息）</span>

<span class="c1">------------------</span>
<span class="c1">--删除文件(夹)</span>
<span class="c1">------------------</span>
<span class="n">print</span><span class="p">(</span><span class="n">os.remove</span><span class="p">(</span><span class="s2">&#34;./aaa.lua&#34;</span><span class="p">))</span>                      <span class="c1">--如果操作成功则打印：true （否则：nil 及相关错误信息）</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">------------------</span>
<span class="c1">--获取系统环境变量</span>
<span class="c1">------------------</span>
<span class="n">print</span><span class="p">(</span><span class="n">os.getenv</span><span class="p">(</span><span class="s2">&#34;HOME&#34;</span><span class="p">))</span>    <span class="c1">--打印结果：/home/xiaoming</span>
<span class="n">print</span><span class="p">(</span><span class="n">os.getenv</span><span class="p">(</span><span class="s2">&#34;ROOT&#34;</span><span class="p">))</span>    <span class="c1">--打印结果：nil （不存在此环境变量）</span>
<span class="cm">--[[
</span><span class="cm">  获取系统哪种环境变量，与系统直接有关，
</span><span class="cm">  例如：linux 系统，&#34;HOME&#34;表获取家目录。
</span><span class="cm">--]]</span>

<span class="c1">------------------</span>
<span class="c1">--运行一条系统命令</span>
<span class="c1">------------------</span>
<span class="n">os.execute</span><span class="p">(</span><span class="s2">&#34;mkdir ./tmp/d&#34;</span><span class="p">)</span> <span class="c1">--运行系统命令：创建一个文件夹 （备注：正确返回true，否则返回nil）</span>
<span class="n">os.execute</span><span class="p">(</span><span class="s2">&#34;touch ./tmp/f&#34;</span><span class="p">)</span> <span class="c1">--运行系统命令：创建一个文件</span>
<span class="n">os.execute</span><span class="p">(</span><span class="s2">&#34;rm ./xxxx.lua&#34;</span><span class="p">)</span> <span class="c1">--运行系统命令：删除一个文件</span>

<span class="c1">------------------</span>
<span class="c1">--退出当前lau程序</span>
<span class="c1">------------------</span>
<span class="n">os.exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                  <span class="c1">--退出当前lau程序，并返回状态值（默认值：0）</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">----------------</span>
<span class="c1">--获取日期时间戳</span>
<span class="c1">----------------</span>
<span class="n">print</span><span class="p">(</span><span class="n">os.time</span><span class="p">())</span>                                           <span class="c1">--获取系统当前时间戳：1641384000</span>
<span class="n">print</span><span class="p">(</span><span class="n">os.time</span><span class="p">{</span><span class="n">year</span><span class="o">=</span><span class="mi">2022</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">5</span><span class="p">})</span>                  <span class="c1">--获取指定日期时间戳：1641355200</span>
<span class="n">print</span><span class="p">(</span><span class="n">os.time</span><span class="p">{</span><span class="n">year</span><span class="o">=</span><span class="mi">2022</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">min</span><span class="o">=</span><span class="mi">32</span><span class="p">})</span> <span class="c1">--获取指定日期时间戳：1641389520</span>

<span class="kd">local</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">os.time</span><span class="p">({</span><span class="n">year</span><span class="o">=</span><span class="mi">2022</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">5</span><span class="p">})</span>
<span class="kd">local</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">os.time</span><span class="p">({</span><span class="n">year</span><span class="o">=</span><span class="mi">2022</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">min</span><span class="o">=</span><span class="mi">32</span><span class="p">})</span>
<span class="n">print</span><span class="p">(</span><span class="n">os.difftime</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">t1</span><span class="p">))</span>                                 <span class="c1">--获取两个时间戳的差值：34320.0</span>
<span class="cm">--[[
</span><span class="cm">  1.{year=年, month=月, day=日, hour=时, min=分, sec=秒, isdst=夏令时}
</span><span class="cm">  2.其中 year、month、day 三个字段是必须的，其它字段默认取 12:00:00
</span><span class="cm">  3.isdst 为布尔值，true 表示夏令时
</span><span class="cm">--]]</span>

<span class="c1">----------------</span>
<span class="c1">--格式化日期时间</span>
<span class="c1">----------------</span>
<span class="n">print</span><span class="p">(</span><span class="n">os.date</span><span class="p">())</span>                       <span class="c1">--打印结果：Wed Jan  5 21:57:19 2022</span>
<span class="n">print</span><span class="p">(</span><span class="n">os.date</span><span class="p">(</span><span class="s2">&#34;today is %A, in %B&#34;</span><span class="p">))</span>   <span class="c1">--打印结果：today is Wednesday, in January</span>
<span class="n">print</span><span class="p">(</span><span class="n">os.date</span><span class="p">(</span><span class="s2">&#34;%x&#34;</span><span class="p">,</span> <span class="n">os.time</span><span class="p">()))</span>        <span class="c1">--打印结果：01/05/22</span>

<span class="n">tb</span> <span class="o">=</span> <span class="n">os.date</span><span class="p">(</span><span class="s2">&#34;*t&#34;</span><span class="p">)</span>                     <span class="c1">--打印结果：sec    41     （秒）</span>
<span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">tb</span><span class="p">)</span> <span class="kr">do</span>                <span class="c1">--打印结果：year   2022   （年）</span>
    <span class="n">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>                         <span class="c1">--打印结果：isdst  false  （非夏令时）</span>
<span class="kr">end</span>                                    <span class="c1">--打印结果：day    5      （日）</span>
                                       <span class="c1">--打印结果：yday   5</span>
                                       <span class="c1">--打印结果：hour   14     （时）</span>
                                       <span class="c1">--打印结果：wday   4      （周三）</span>
                                       <span class="c1">--打印结果：month  1      （月）</span>
                                       <span class="c1">--打印结果：min    48     （分）</span>
<span class="c1">------------------</span>
<span class="c1">--CPU时间戳</span>
<span class="c1">------------------</span>
<span class="kd">local</span> <span class="n">x</span> <span class="o">=</span> <span class="n">os.clock</span><span class="p">()</span>
<span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
<span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="o">^</span><span class="mi">7</span> <span class="kr">do</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">i</span> <span class="kr">end</span>
<span class="n">print</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>                                        <span class="c1">--打印结果：number  0.002064</span>
<span class="n">print</span><span class="p">(</span><span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;run time: %.2f</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">os.clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span> <span class="c1">--打印整段代码运行时间：run time: 0.07 （秒）</span>
</code></pre></td></tr></table>
</div>
</div></details>  
<hr>
<p><strong>说明二</strong>、关于日期时间显示方式，可以通过格式化参数制定显示格式。</p>
<table>
<thead>
<tr>
<th style="text-align:center">格式</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%a</td>
<td style="text-align:left">星期简写，如：Wed</td>
</tr>
<tr>
<td style="text-align:center">%A</td>
<td style="text-align:left">星期全称，如：Wednesday</td>
</tr>
<tr>
<td style="text-align:center">%b</td>
<td style="text-align:left">月份简写，如：Sep</td>
</tr>
<tr>
<td style="text-align:center">%B</td>
<td style="text-align:left">月份全称，如：September</td>
</tr>
<tr>
<td style="text-align:center">%c</td>
<td style="text-align:left">日期和时间，如：01/05/22 13:43:08</td>
</tr>
<tr>
<td style="text-align:center">%d</td>
<td style="text-align:left">一个月中的第几天，01-31</td>
</tr>
<tr>
<td style="text-align:center">%H</td>
<td style="text-align:left">24小时制中的小时数，00-23</td>
</tr>
<tr>
<td style="text-align:center">%I</td>
<td style="text-align:left">12小时制中的小时数，01-12</td>
</tr>
<tr>
<td style="text-align:center">%j</td>
<td style="text-align:left">一年中的第几天，001-366</td>
</tr>
<tr>
<td style="text-align:center">%M</td>
<td style="text-align:left">分钟数，00-59</td>
</tr>
<tr>
<td style="text-align:center">%m</td>
<td style="text-align:left">月份数，01-12</td>
</tr>
<tr>
<td style="text-align:center">%p</td>
<td style="text-align:left">上午(am)或下午(pm)</td>
</tr>
<tr>
<td style="text-align:center">%S</td>
<td style="text-align:left">秒数，00-59</td>
</tr>
<tr>
<td style="text-align:center">%w</td>
<td style="text-align:left">一星期中的第几天，0-6</td>
</tr>
<tr>
<td style="text-align:center">%x</td>
<td style="text-align:left">日期，如：09/16/22</td>
</tr>
<tr>
<td style="text-align:center">%X</td>
<td style="text-align:left">时间，如：13:47:20</td>
</tr>
<tr>
<td style="text-align:center">%y</td>
<td style="text-align:left">两位数的年份，如：22</td>
</tr>
<tr>
<td style="text-align:center">%Y</td>
<td style="text-align:left">完整的年份，如：2022</td>
</tr>
<tr>
<td style="text-align:center">%%</td>
<td style="text-align:left">字符%</td>
</tr>
</tbody>
</table>
<p>参考网文：<a href="https://www.cnblogs.com/chenny7/p/4056976.html" target="_blank" rel="noopener noreffer">Lua 之 os 库</a></p>
<hr>
</details>  
<details close=""><summary>14、lua 之 math 库</summary>  
<blockquote>
<p><strong>一、操作函数：</strong></p>
</blockquote>
<p>注意：使用<code>math.random</code>之前要调用<code>math.randomseed(os.time())</code>设置随机数种子一次（当然中途可以多次修改随机数种子），否则得不出你想要的结果！</p>
<table>
<thead>
<tr>
<th style="text-align:left">公式</th>
<th style="text-align:left">公式描述</th>
<th style="text-align:left">计算例子</th>
<th style="text-align:left">计算结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">pi</td>
<td style="text-align:left">圆周率常量</td>
<td style="text-align:left">print(math.pi)</td>
<td style="text-align:left">3.1415926535898</td>
</tr>
<tr>
<td style="text-align:left">abs</td>
<td style="text-align:left">取绝对值</td>
<td style="text-align:left">math.abs(-15)</td>
<td style="text-align:left">15</td>
</tr>
<tr>
<td style="text-align:left">ceil</td>
<td style="text-align:left">向上取整</td>
<td style="text-align:left">math.ceil(5.8)</td>
<td style="text-align:left">6</td>
</tr>
<tr>
<td style="text-align:left">floor</td>
<td style="text-align:left">向下取整</td>
<td style="text-align:left">math.floor(5.6)</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left">max</td>
<td style="text-align:left">取参数最大值</td>
<td style="text-align:left">math.max(2.71,100,-98,23)</td>
<td style="text-align:left">100</td>
</tr>
<tr>
<td style="text-align:left">min</td>
<td style="text-align:left">取参数最小值</td>
<td style="text-align:left">math.min(2.71,100,-98,23)</td>
<td style="text-align:left">-98</td>
</tr>
<tr>
<td style="text-align:left">modf</td>
<td style="text-align:left">取整数和小数部分</td>
<td style="text-align:left">math.modf(15.98)</td>
<td style="text-align:left">15　98</td>
</tr>
<tr>
<td style="text-align:left">randomseed</td>
<td style="text-align:left">设置随机数种子</td>
<td style="text-align:left">math.randomseed(os.time())</td>
<td style="text-align:left">在使用<code>math.random</code>函数之前必用本函数设置随机数种子</td>
</tr>
<tr>
<td style="text-align:left">random</td>
<td style="text-align:left">获取随机数</td>
<td style="text-align:left">math.random(1,100)<br>math.random(100)</td>
<td style="text-align:left">获取1-100的随机数</td>
</tr>
<tr>
<td style="text-align:left">fmod（mod）</td>
<td style="text-align:left">取模运算</td>
<td style="text-align:left">math.fmod(14,5)</td>
<td style="text-align:left">4</td>
</tr>
<tr>
<td style="text-align:left">sin</td>
<td style="text-align:left">正弦函数</td>
<td style="text-align:left">math.sin(math.rad(30))</td>
<td style="text-align:left">0.5</td>
</tr>
<tr>
<td style="text-align:left">cos</td>
<td style="text-align:left">余弦函数</td>
<td style="text-align:left">math.cos(0.5)</td>
<td style="text-align:left">0.87758256</td>
</tr>
<tr>
<td style="text-align:left">tan</td>
<td style="text-align:left">正切函数</td>
<td style="text-align:left">math.tan(0.5)</td>
<td style="text-align:left">0.5463024</td>
</tr>
<tr>
<td style="text-align:left">asin</td>
<td style="text-align:left">反正弦函数</td>
<td style="text-align:left">math.asin(0.5)</td>
<td style="text-align:left">0.52359877</td>
</tr>
<tr>
<td style="text-align:left">acos</td>
<td style="text-align:left">反余弦函数</td>
<td style="text-align:left">math.acos(0.5)</td>
<td style="text-align:left">1.04719755</td>
</tr>
<tr>
<td style="text-align:left">atan</td>
<td style="text-align:left">反正切函数</td>
<td style="text-align:left">math.atan(0.5)</td>
<td style="text-align:left">0.463647609</td>
</tr>
<tr>
<td style="text-align:left">atan2</td>
<td style="text-align:left">x/y的反正切值</td>
<td style="text-align:left">math.atan2(90.0,45.0)</td>
<td style="text-align:left">1.10714871</td>
</tr>
<tr>
<td style="text-align:left">sinh</td>
<td style="text-align:left">双曲线正弦函数</td>
<td style="text-align:left">math.sinh(0.5)</td>
<td style="text-align:left">0.5210953</td>
</tr>
<tr>
<td style="text-align:left">cosh</td>
<td style="text-align:left">双曲线余弦函数</td>
<td style="text-align:left">math.cosh(0.5)</td>
<td style="text-align:left">1.276259652</td>
</tr>
<tr>
<td style="text-align:left">tanh</td>
<td style="text-align:left">双曲线正切函数</td>
<td style="text-align:left">math.tanh(0.5)</td>
<td style="text-align:left">0.46211715</td>
</tr>
<tr>
<td style="text-align:left">deg</td>
<td style="text-align:left">弧度转角度</td>
<td style="text-align:left">math.deg(math.pi)</td>
<td style="text-align:left">180</td>
</tr>
<tr>
<td style="text-align:left">rad</td>
<td style="text-align:left">角度转弧度</td>
<td style="text-align:left">math.rad(180)</td>
<td style="text-align:left">3.14159265358</td>
</tr>
<tr>
<td style="text-align:left">frexp</td>
<td style="text-align:left">分解v=x*(2的n次方)</td>
<td style="text-align:left">math.frexp(10.0)</td>
<td style="text-align:left">0.625　4</td>
</tr>
<tr>
<td style="text-align:left">ldexp</td>
<td style="text-align:left">计算v*(2的n次方)</td>
<td style="text-align:left">math.ldexp(10.0,3)</td>
<td style="text-align:left">80=10*(2^3)</td>
</tr>
<tr>
<td style="text-align:left">exp</td>
<td style="text-align:left">计算以e的x次方</td>
<td style="text-align:left">math.exp(2)</td>
<td style="text-align:left">2.718281828</td>
</tr>
<tr>
<td style="text-align:left">pow</td>
<td style="text-align:left">计算以x的y次方</td>
<td style="text-align:left">math.pow(2,5)</td>
<td style="text-align:left">32</td>
</tr>
<tr>
<td style="text-align:left">sqrt</td>
<td style="text-align:left">开平方</td>
<td style="text-align:left">math.sqrt(16)</td>
<td style="text-align:left">4</td>
</tr>
<tr>
<td style="text-align:left">log10</td>
<td style="text-align:left">计算以10为基数的对数</td>
<td style="text-align:left">math.log10(100)</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">log</td>
<td style="text-align:left">计算一个数的自然对数</td>
<td style="text-align:left">math.log(2.71)</td>
<td style="text-align:left">0.9969</td>
</tr>
</tbody>
</table>
</details>  
<details close=""><summary>15、lua 调试</summary>  
<blockquote>
<p><strong>一、操作函数：</strong></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="n">print</span><span class="p">(...)</span>                           <span class="c1">--【打印】打印函数</span>
<span class="n">assert</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;message&#34;</span><span class="p">])</span>               <span class="c1">--【断言】断言函数，当(v)值为假（nil 或 false）时输出[message]信息，如果不指出则默认输出信息：&#34;assertion failed!&#34; </span>
<span class="n">error</span><span class="p">(</span><span class="s2">&#34;message&#34;</span><span class="p">,</span> <span class="p">[</span><span class="n">level</span><span class="p">])</span>            <span class="c1">--【错误】错误函数，输出错误信息后强制结束lua运行，扩展参数[level]指出错误信息的深度级别(默认值:1)</span>
<span class="n">debug.debug</span><span class="p">()</span>                        <span class="c1">--【交互】进入交互，相当于暂停程序，此时可输入诸如`print()`查看一些变量的值，当输入`cont`后退出交互模式并继续运行程序</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>二、应用例子：</strong></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">--函数入口参数断言--</span>
<span class="kd">local</span> <span class="kr">function</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
	<span class="n">assert</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;number&#34;</span><span class="p">,</span> <span class="s2">&#34;[a] It&#39;s not a number&#34;</span><span class="p">)</span>
	<span class="n">assert</span><span class="p">(</span><span class="n">type</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;number&#34;</span><span class="p">,</span> <span class="s2">&#34;[b] It&#39;s not a number&#34;</span><span class="p">)</span>
	<span class="kr">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="kr">end</span>

<span class="n">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&#34;5&#34;</span><span class="p">)</span>      <span class="c1">--打印的错误信息：</span>
                  <span class="c1">--lua: test.lua:4: [b] It&#39;s not a number</span>
                  <span class="c1">--stack traceback:</span>
                  <span class="c1">--        [C]: in function &#39;assert&#39;</span>
                  <span class="c1">--        test.lua:4: in local &#39;add&#39;</span>
                  <span class="c1">--        test.lua:7: in main chunk</span>
                  <span class="c1">--        [C]: in ?</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">--运行过程抛出错误--</span>
<span class="kd">local</span> <span class="kr">function</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
	<span class="kr">if</span> <span class="n">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&#34;number&#34;</span> <span class="kr">then</span>
		<span class="n">error</span><span class="p">(</span><span class="s2">&#34;[a] It&#39;s not a number&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="kr">end</span>
	<span class="kr">if</span> <span class="n">type</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&#34;number&#34;</span> <span class="kr">then</span>
		<span class="n">error</span><span class="p">(</span><span class="s2">&#34;[b] It&#39;s not a number&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="kr">end</span>
	<span class="kr">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="kr">end</span>

<span class="n">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&#34;5&#34;</span><span class="p">)</span>      <span class="c1">--打印的错误信息：</span>
                  <span class="c1">--lua: test.lua:7: [b] It&#39;s not a number</span>
                  <span class="c1">--stack traceback:</span>
                  <span class="c1">--        [C]: in function &#39;error&#39;</span>
                  <span class="c1">--        test.lua:7: in local &#39;add&#39;</span>
                  <span class="c1">--        test.lua:11: in main chunk</span>
                  <span class="c1">--        [C]: in ?</span>
<span class="err">错误信息的深度：</span>
<span class="n">error</span><span class="p">(</span><span class="s2">&#34;message&#34;</span><span class="p">,</span> <span class="p">[</span><span class="n">level</span><span class="p">])</span>
<span class="n">Level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">:</span> <span class="err">不添加错误位置信息</span>
<span class="n">Level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span> <span class="err">指出调用错误位置</span><span class="p">(</span><span class="err">文件</span><span class="o">+</span><span class="err">行号</span><span class="p">)</span><span class="err">（默认）</span>
<span class="n">Level</span> <span class="o">=</span> <span class="mi">2</span><span class="p">:</span> <span class="err">同上，但比上面多一层级调用信息</span>
<span class="n">Level</span> <span class="o">=</span> <span class="err">……</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<details close=""><summary>待续……</summary>  
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="n">debug.debug</span><span class="p">()</span>
<span class="n">debug.gethook</span><span class="p">([</span><span class="n">thread</span><span class="p">])</span>
<span class="n">debug.getinfo</span><span class="p">([</span><span class="n">thread</span><span class="p">],</span> <span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="n">what</span><span class="p">])</span>
<span class="n">debug.getlocal</span><span class="p">([</span><span class="n">thread</span><span class="p">],</span> <span class="n">f</span><span class="p">,</span> <span class="kd">local</span><span class="p">)</span>
<span class="n">debug.getmetatable</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="n">debug.getregistry</span><span class="p">()</span>
<span class="n">debug.getupvalue</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">up</span><span class="p">)</span>
<span class="n">debug.getuservalue</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
<span class="n">debug.sethook</span><span class="p">([</span><span class="n">thread</span><span class="p">],</span> <span class="n">hook</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="p">[</span><span class="n">count</span><span class="p">])</span>
<span class="n">debug.setlocal</span><span class="p">([</span><span class="n">thread</span><span class="p">],</span> <span class="n">level</span><span class="p">,</span> <span class="kd">local</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="n">debug.setmetatable</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
<span class="n">debug.setupvalue</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="n">debug.setuservalue</span><span class="p">(</span><span class="n">udata</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="n">debug.traceback</span><span class="p">([</span><span class="n">thread</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">,</span> <span class="p">[</span><span class="n">level</span><span class="p">]])</span>
<span class="n">debug.upvalueid</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">debug.upvaluejoin</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></details>  
<hr>
</details>  
<details close=""><summary>16、lua 垃圾回收</summary>  
<p>待续……</p>
</details>  
<h3 id="lua-数据库">Lua 数据库</h3>
<p>待续……</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2022-04-27</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://o2ospring.github.io/20211221/" data-title="lua 脚本基本语法" data-hashtags="lua,linux 工具/应用"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://o2ospring.github.io/20211221/" data-hashtag="lua"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://o2ospring.github.io/20211221/" data-title="lua 脚本基本语法"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://o2ospring.github.io/20211221/" data-title="lua 脚本基本语法"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://o2ospring.github.io/20211221/" data-title="lua 脚本基本语法"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/lua/">lua</a>,&nbsp;<a href="/tags/linux-%E5%B7%A5%E5%85%B7/%E5%BA%94%E7%94%A8/">linux 工具/应用</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/20210627/" class="prev" rel="prev" title="attribute-at 编译属性-指定地址"><i class="fas fa-angle-left fa-fw"></i>attribute-at 编译属性-指定地址</a>
            <a href="/20220123/" class="next" rel="next" title="网站 node 包管理器 npm">网站 node 包管理器 npm<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.92.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2018 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">o2ospring</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><script type="text/javascript" src="/lib/valine/Valine.min.js"></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/algoliasearch/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":100},"comment":{"valine":{"appId":"7V3yo7ajOCbagfd7KIdmkAiw-gzGzoHsz","appKey":"IpKMeGrJVzTvAAkTiXEMiElK","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"zh-cn","pageSize":10,"placeholder":"你的评论 ...","recordIP":true,"visitor":true}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"algoliaAppID":"AU15Z1TOUX","algoliaIndex":"o2ospring_blog_index","algoliaSearchKey":"79710701e46d916e0897c7b7dfe0a497","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
